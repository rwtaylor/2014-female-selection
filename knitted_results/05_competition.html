<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
body {max-width:600px; padding:10px;}
  </style>
</head>
<body>
<nav id="TOC">
<ul>
<li><a href="#competition-and-selection">Competition and Selection</a><ul>
<li><a href="#accounting-for-behavioral-measurement-uncertainty">Accounting for behavioral measurement uncertainty</a><ul>
<li><a href="#correlations-between-selection-gradients-and-competition">Correlations between selection gradients and competition</a><ul>
<li><a href="#aggression-and-competition">Aggression and Competition</a></li>
<li><a href="#activity-and-competition">Activity and Competition</a></li>
<li><a href="#docility-and-competition">Docility and Competition</a></li>
</ul></li>
<li><a href="#effect-of-competition-on-linear-selection-glmms">Effect of competition on linear selection (glmms)</a><ul>
<li><a href="#interaction-between-competition-and-linear-selection-results">Interaction between competition and linear selection results</a></li>
</ul></li>
<li><a href="#competition-and-nonlinear-selection-glmms">Competition and nonlinear selection (glmms)</a></li>
<li><a href="#nonlinear-results">Nonlinear results</a></li>
</ul></li>
<li><a href="#ignoring-behavioural-uncertainty">Ignoring behavioural uncertainty</a><ul>
<li><a href="#correlations-between-selection-gradients-and-competition-1">Correlations between selection gradients and competition</a><ul>
<li><a href="#aggression-and-competition-1">Aggression and Competition</a></li>
<li><a href="#activity-and-competition-1">Activity and Competition</a></li>
<li><a href="#docility-and-competition-1">Docility and Competition</a></li>
</ul></li>
<li><a href="#effect-of-competition-on-linear-selection">Effect of competition on linear selection</a><ul>
<li><a href="#interaction-between-competition-and-linear-selection-results-1">Interaction between competition and linear selection results</a></li>
</ul></li>
<li><a href="#competition-and-nonlinear-selection">Competition and nonlinear selection</a><ul>
<li><a href="#format-results-of-nonlinear-selection-for-table">Format results of nonlinear selection for table</a></li>
</ul></li>
<li><a href="#nonlinear-results-1">Nonlinear results</a><ul>
<li><a href="#ars">ARS</a></li>
<li><a href="#ows">OWS</a></li>
<li><a href="#fecundity">Fecundity</a></li>
<li><a href="#plot-of-quadratic-interaction">Plot of quadratic interaction</a></li>
<li><a href="#tile-plot-of-interaction">Tile plot of interaction</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>



<!--pandoc
t: html
default-image-extension: png
template: templates/html.template
toc-depth: 4
toc:

t: latex
s:
S:
latex-engine: xelatex
template: templates/latex.template
default-image-extension: pdf
toc-depth: 4
toc:
-->



<h1 id="competition-and-selection">Competition and Selection</h1>
<h2 id="accounting-for-behavioral-measurement-uncertainty">Accounting for behavioral measurement uncertainty</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MASS) <span class="co"># MASS clashes with dplyr... so always load first</span>
<span class="kw">library</span>(pander) <span class="co"># pander clashes with dplyr... so always load first</span>
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(grid)
<span class="kw">library</span>(dplyr)
<span class="kw">set.alignment</span>(<span class="st">&#39;right&#39;</span>, <span class="dt">row.names =</span> <span class="st">&#39;left&#39;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_mcmc.RData&quot;</span>)
fitness &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file =</span> <span class="st">&quot;data/fitness+competition.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&#39;,&#39;</span>,
  <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/fit_raneff_data.RData&quot;</span>)</code></pre>
<p>We will examine the effect of competition on selection in two general steps.</p>
<ol style="list-style-type: decimal">
<li>Is there an interaction between competition and behavior on fitness?</li>
<li>Are there nonlinear effects of behavior on fitness?</li>
</ol>
<h3 id="correlations-between-selection-gradients-and-competition">Correlations between selection gradients and competition</h3>
<p>First a plot of the relationship between selection gradients and competition. The two study areas were pooled to calculate selection gradients for each year. Therefore we need to calculate competition for the combined study areas. Competition is the number of offspring produced during the year divided by the number of offspring that survived to spring (i.e. recruited into the population).</p>
<pre class="sourceCode r"><code class="sourceCode r">competition_year &lt;-<span class="st"> </span>fitness %&gt;%
<span class="st">  </span><span class="kw">filter</span>(grid_year !=<span class="st"> &quot;SU2008&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(Year, competition) %&gt;%
<span class="st">  </span><span class="kw">unique</span>() %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_competition =</span> <span class="kw">mean</span>(competition))
  
n_year &lt;-<span class="st"> </span><span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%<span class="st"> </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())
competition_year &lt;-<span class="st"> </span><span class="kw">left_join</span>(competition_year, n_year, <span class="dt">by =</span> <span class="st">&quot;Year&quot;</span>)
competition_year$Year &lt;-<span class="st"> </span><span class="kw">as.character</span>(competition_year$Year)

<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_mcmc.RData&quot;</span>)
sel_grads_mcmc_comp &lt;-<span class="st"> </span><span class="kw">left_join</span>(
  <span class="kw">filter</span>(sel_grads_mcmc, standardization ==<span class="st"> &quot;SD&quot;</span>), competition_year,
  <span class="dt">by =</span> <span class="st">&quot;Year&quot;</span>)
<span class="kw">save</span>(sel_grads_mcmc_comp, competition_year,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/sel_grads_mcmc_comp.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_mcmc_comp.RData&quot;</span>)

cor_sgrad_comp &lt;-<span class="st"> </span>function(x){
  v &lt;-<span class="st"> </span>x$variable[<span class="dv">1</span>]
  ct &lt;-<span class="st"> </span><span class="kw">cor.test</span>(x$post_mode, x$mean_competition)
  <span class="kw">data.frame</span>(<span class="dt">variable =</span> v, <span class="dt">est =</span> ct$estimate, <span class="dt">lower =</span> ct$conf.int[<span class="dv">1</span>],
    <span class="dt">upper =</span> ct$conf.int[<span class="dv">2</span>], <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
}

mcmc_cor &lt;-<span class="st"> </span>sel_grads_mcmc_comp %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(variable, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">do</span>(<span class="kw">cor_sgrad_comp</span>(.))
mcmc_cor[ ,<span class="dv">2</span>:<span class="dv">4</span>] &lt;-<span class="st"> </span><span class="kw">round</span>(mcmc_cor[ ,<span class="dv">2</span>:<span class="dv">4</span>], <span class="dt">digits =</span> <span class="dv">2</span>)
mcmc_cor$print &lt;-<span class="st"> </span><span class="kw">paste</span>(mcmc_cor$est,
  <span class="st">&quot; (&quot;</span>, mcmc_cor$lower, <span class="st">&quot;, &quot;</span>, mcmc_cor$upper, <span class="st">&quot;)&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</code></pre>
<h4 id="aggression-and-competition">Aggression and Competition</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sel_grads_mcmc_comp, variable ==<span class="st"> &quot;Aggression&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> mean_competition, <span class="dt">y =</span> post_mode))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Selection Gradient&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Aggression&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Juvenile Competition&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>),
  <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mcmc_cor, variable ==<span class="st"> &quot;Aggression&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> <span class="fl">6.5</span>, <span class="dt">y =</span> <span class="fl">1.1</span>, <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;Correlation = &quot;</span>, print, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)),
  <span class="dt">size =</span> <span class="fl">2.5</span>)
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/05_agg_comp_mcmc.png" />
</div>
<h4 id="activity-and-competition">Activity and Competition</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sel_grads_mcmc_comp, variable ==<span class="st"> &quot;Activity&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> mean_competition, <span class="dt">y =</span> post_mode))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Selection Gradient&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Activity&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Juvenile Competition&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>),
  <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylim</span>(<span class="kw">c</span>(-<span class="dv">1</span>, <span class="fl">1.5</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mcmc_cor, variable ==<span class="st"> &quot;Activity&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> <span class="fl">6.1</span>, <span class="dt">y =</span> <span class="fl">1.5</span>, <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;Correlation = &quot;</span>, print, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)),
  <span class="dt">size =</span> <span class="fl">2.5</span>)
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/05_act_comp_mcmc.png" />
</div>
<h4 id="docility-and-competition">Docility and Competition</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sel_grads_mcmc_comp, variable ==<span class="st"> &quot;Docility&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> mean_competition, <span class="dt">y =</span> post_mode))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Selection Gradient&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Docility&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Juvenile Competition&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>),
  <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mcmc_cor, variable ==<span class="st"> &quot;Docility&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> <span class="fl">6.1</span>, <span class="dt">y =</span> <span class="fl">0.65</span>, <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;Correlation = &quot;</span>, print, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)),
  <span class="dt">size =</span> <span class="fl">2.5</span>)
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/05_doc_comp_mcmc.png" />
</div>
<h3 id="effect-of-competition-on-linear-selection-glmms">Effect of competition on linear selection (glmms)</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/fit_raneff_data.RData&quot;</span>)
<span class="kw">library</span>(dplyr)
fit_raneff_data &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(fit_raneff_data)
<span class="kw">library</span>(lme4)

<span class="co"># Model with interactions between competition and the behavioral traits. </span>
<span class="co"># grid_year and ID are random effects.</span>
arsLinearCompetition &lt;-<span class="st"> </span>function(dat){
  ars_linear_comp &lt;-<span class="st"> </span><span class="kw">glmer</span>(
    ars_all ~<span class="st"> </span>
<span class="st">    </span>competition_s +<span class="st"> </span>
<span class="st">    </span>aggression_s +<span class="st"> </span>
<span class="st">    </span>competition_s:aggression_s +<span class="st"> </span>
<span class="st">    </span>activity_s +<span class="st"> </span>
<span class="st">    </span>competition_s:activity_s +<span class="st"> </span>
<span class="st">    </span>docility_s +
<span class="st">    </span>competition_s:docility_s +
<span class="st">    </span>(<span class="dv">1</span>|Grid) +<span class="st"> </span>(<span class="dv">1</span>|ID),
    <span class="dt">data =</span> dat, <span class="dt">family =</span> poisson, <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>)
    )
  random_effect_variances &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(ars_linear_comp)
  <span class="kw">data.frame</span>(<span class="kw">t</span>(<span class="kw">summary</span>(ars_linear_comp)$coefficients[ ,<span class="st">&quot;Estimate&quot;</span>]),
  <span class="dt">ID =</span> random_effect_variances$ID[<span class="dv">1</span>], <span class="dt">Grid =</span> random_effect_variances$Grid[<span class="dv">1</span>])
}

<span class="kw">library</span>(foreach)</code></pre>
<pre><code>## foreach: simple, scalable parallel programming from Revolution Analytics
## Use Revolution R for scalability, fault tolerance and more.
## http://www.revolutionanalytics.com</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(doMC)</code></pre>
<pre><code>## Loading required package: iterators
## Loading required package: parallel</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ncores =<span class="st"> </span><span class="dv">12</span>
<span class="kw">registerDoMC</span>(<span class="dt">cores =</span> ncores)

batches &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">start =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">1000</span>, <span class="kw">round</span>(<span class="dv">1000</span>/ncores))[<span class="dv">1</span>:ncores])
batches$stop &lt;-<span class="st"> </span><span class="kw">c</span>(batches$start[<span class="dv">2</span>:<span class="kw">length</span>(batches$start)] -<span class="st"> </span><span class="dv">1</span>, <span class="dv">1000</span>)

start_time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
ars_linear_comp_posterior &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span>:ncores, <span class="dt">.combine =</span> rbind) %dopar%<span class="st"> </span>{
  results &lt;-<span class="st"> </span>fit_raneff_data %&gt;%
<span class="st">    </span><span class="kw">filter</span>(type ==<span class="st"> &quot;raneff&quot;</span>, itt %in%<span class="st"> </span>batches$start[i]:batches$stop[i]) %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(itt, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">    </span><span class="kw">do</span>(<span class="kw">arsLinearCompetition</span>(.))
}
run_time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>() -<span class="st"> </span>start_time
<span class="kw">print</span>(run_time)</code></pre>
<pre><code>## Time difference of 2.539 mins</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(ars_linear_comp_posterior,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/ars_linear_comp_posterior.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/ars_linear_comp_posterior.RData&quot;</span>)
<span class="kw">library</span>(MCMCglmm)
<span class="kw">library</span>(lme4)
<span class="kw">library</span>(data.table)</code></pre>
<pre><code>## data.table 1.9.2  For help type: help(&quot;data.table&quot;)
## 
## Attaching package: &#39;data.table&#39;
## 
## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     between, last</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">getPosteriorParams &lt;-<span class="st"> </span>function(x){
  <span class="kw">require</span>(MCMCglmm)
  dat_mcmc &lt;-<span class="st"> </span><span class="kw">mcmc</span>(x)
  pm &lt;-<span class="st"> </span><span class="kw">posterior.mode</span>(dat_mcmc)
  hpd &lt;-<span class="st"> </span><span class="kw">HPDinterval</span>(dat_mcmc, <span class="dt">prob =</span> <span class="fl">0.9</span>)
  pm_table &lt;-<span class="st">  </span><span class="kw">format</span>(<span class="kw">round</span>(pm , <span class="dt">digits =</span> <span class="dv">2</span>), <span class="dt">digits =</span> <span class="dv">1</span>, <span class="dt">nsmall =</span> <span class="dv">2</span>,
    <span class="dt">scientific =</span> <span class="ot">FALSE</span>)
  hpd_table &lt;-<span class="st"> </span><span class="kw">format</span>(<span class="kw">round</span>(hpd, <span class="dt">digits =</span> <span class="dv">2</span>), <span class="dt">digits =</span> <span class="dv">1</span>, <span class="dt">nsmall =</span> <span class="dv">2</span>,
    <span class="dt">scientific =</span> <span class="ot">FALSE</span>)
  pm_hpd_table &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">cbind</span>(pm_table, hpd_table))
  pm_hpd_table$pm_hpd &lt;-<span class="st"> </span><span class="kw">paste</span>(
    pm_table, <span class="st">&quot; (&quot;</span>, hpd_table[ ,<span class="dv">1</span>], <span class="st">&quot;, &quot;</span>, hpd_table[ ,<span class="dv">2</span>], <span class="st">&quot;)&quot;</span>, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>
    )
  pm_hpd_table$sig[<span class="kw">sign</span>(hpd[ ,<span class="dv">1</span>]) ==<span class="st"> </span><span class="kw">sign</span>(hpd[ ,<span class="dv">2</span>])] &lt;-<span class="st"> &quot;*&quot;</span>
  pm_hpd_table$sig[<span class="kw">sign</span>(hpd[ ,<span class="dv">1</span>]) !=<span class="st"> </span><span class="kw">sign</span>(hpd[ ,<span class="dv">2</span>])] &lt;-<span class="st"> &quot; &quot;</span>
  pm_hpd_table$space[<span class="kw">sign</span>(hpd[ ,<span class="dv">1</span>]) ==<span class="st"> </span><span class="kw">sign</span>(hpd[ ,<span class="dv">2</span>])] &lt;-<span class="st"> &quot;*&quot;</span>
  pm_hpd_table$space[<span class="kw">sign</span>(hpd[ ,<span class="dv">1</span>]) !=<span class="st"> </span><span class="kw">sign</span>(hpd[ ,<span class="dv">2</span>])] &lt;-<span class="st"> &quot;&amp;nbsp;&quot;</span>
  pm_hpd_table$pm_hpd &lt;-<span class="st"> </span><span class="kw">paste</span>(pm_hpd_table$pm_hpd, pm_hpd_table$sig, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
  <span class="kw">return</span>(pm_hpd_table)
}

linear_hpd_ars &lt;-<span class="st"> </span><span class="kw">getPosteriorParams</span>(ars_linear_comp_posterior %&gt;%
<span class="st">  </span><span class="kw">ungroup</span>() %&gt;%
<span class="st">  </span><span class="kw">select</span>(<span class="dt">Intercept =</span> X.Intercept., <span class="dt">Competition =</span> competition_s,
    <span class="dt">Aggression =</span> aggression_s, <span class="dt">Activity =</span> activity_s, <span class="dt">docility =</span> docility_s,
    <span class="st">&quot;Competition x Aggression&quot;</span> =<span class="st"> </span>competition_s.aggression_s,
    <span class="st">&quot;Competition x Activity&quot;</span> =<span class="st"> </span>competition_s.activity_s,
    <span class="st">&quot;Competition x Docility&quot;</span> =<span class="st"> </span>competition_s.docility_s)
    )</code></pre>
<h4 id="interaction-between-competition-and-linear-selection-results">Interaction between competition and linear selection results</h4>
<p>The effect of competition on linear selection on female behavioral traits for annual reproductive success. Posterior modes are given with highest posterior density intervals in parentheses.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pandoc.table</span>(linear_hpd_ars %&gt;%<span class="st"> </span><span class="kw">select</span>(pm_hpd), <span class="dt">justify=</span><span class="st">&quot;right&quot;</span>)</code></pre>
<table>
<col width="43%" />
<col width="29%" />
<thead>
<tr class="header">
<th align="right"> </th>
<th align="right">pm_hpd</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><strong>Intercept</strong></td>
<td align="right">-1.01 (-1.11, -0.93)*</td>
</tr>
<tr class="even">
<td align="right"><strong>Competition</strong></td>
<td align="right">-3.27 (-3.65, -3.09)*</td>
</tr>
<tr class="odd">
<td align="right"><strong>Aggression</strong></td>
<td align="right">0.36 ( 0.13, 0.63)*</td>
</tr>
<tr class="even">
<td align="right"><strong>Activity</strong></td>
<td align="right">-0.12 (-0.37, 0.15)</td>
</tr>
<tr class="odd">
<td align="right"><strong>docility</strong></td>
<td align="right">-0.18 (-0.38, -0.06)*</td>
</tr>
<tr class="even">
<td align="right"><strong>Competition x Aggression</strong></td>
<td align="right">1.30 ( 0.50, 1.99)*</td>
</tr>
<tr class="odd">
<td align="right"><strong>Competition x Activity</strong></td>
<td align="right">-0.45 (-1.26, 0.32)</td>
</tr>
<tr class="even">
<td align="right"><strong>Competition x Docility</strong></td>
<td align="right">-0.54 (-1.13, -0.09)*</td>
</tr>
</tbody>
</table>
<h3 id="competition-and-nonlinear-selection-glmms">Competition and nonlinear selection (glmms)</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/fit_raneff_data.RData&quot;</span>)
<span class="kw">library</span>(lme4)

arsNonlinearResults &lt;-<span class="st"> </span>function(dat){
  ars_model  &lt;-<span class="st"> </span><span class="kw">glmer</span>(ars_all ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">    </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +
<span class="st">    </span>aggression_s*activity_s*competition_s +<span class="st"> </span><span class="kw">I</span>(aggression_s^<span class="dv">2</span>)*competition_s +
<span class="st">    </span><span class="kw">I</span>(activity_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span><span class="kw">I</span>(docility_s^<span class="dv">2</span>)*competition_s +
<span class="st">    </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID), <span class="dt">data =</span> dat, <span class="dt">family =</span> poisson,
    <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))
  kpd_model  &lt;-<span class="st"> </span><span class="kw">glmer</span>(kprod   ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">    </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +
<span class="st">    </span>aggression_s*activity_s*competition_s +<span class="st"> </span><span class="kw">I</span>(aggression_s^<span class="dv">2</span>)*competition_s +
<span class="st">    </span><span class="kw">I</span>(activity_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span><span class="kw">I</span>(docility_s^<span class="dv">2</span>)*competition_s +
<span class="st">    </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID), <span class="dt">data =</span> dat, <span class="dt">family =</span> poisson,
    <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))
  ows_model  &lt;-<span class="st"> </span><span class="kw">glmer</span>(prop    ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">    </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +
<span class="st">    </span>aggression_s*activity_s*competition_s +<span class="st"> </span><span class="kw">I</span>(aggression_s^<span class="dv">2</span>)*competition_s +
<span class="st">    </span><span class="kw">I</span>(activity_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span><span class="kw">I</span>(docility_s^<span class="dv">2</span>)*competition_s +
<span class="st">    </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID), <span class="dt">data =</span> dat, <span class="dt">weights =</span> kprod, <span class="dt">family =</span> binomial,
    <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))

  ars_vc &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(ars_model)
  ars_t &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">fitness =</span> <span class="st">&quot;ars&quot;</span>,
    <span class="kw">t</span>(<span class="kw">summary</span>(ars_model)$coefficients[ ,<span class="st">&quot;Estimate&quot;</span>]), <span class="dt">ID =</span> ars_vc$ID[<span class="dv">1</span>],
    <span class="dt">grid_year =</span> ars_vc$grid_year[<span class="dv">1</span>])
  kpd_vc &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(kpd_model)
  kpd_t &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">fitness =</span> <span class="st">&quot;kpd&quot;</span>,
    <span class="kw">t</span>(<span class="kw">summary</span>(kpd_model)$coefficients[ ,<span class="st">&quot;Estimate&quot;</span>]), <span class="dt">ID =</span> kpd_vc$ID[<span class="dv">1</span>],
    <span class="dt">grid_year =</span> kpd_vc$grid_year[<span class="dv">1</span>])
  ows_vc &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(ows_model)
  ows_t &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">fitness =</span> <span class="st">&quot;ows&quot;</span>,
    <span class="kw">t</span>(<span class="kw">summary</span>(ows_model)$coefficients[ ,<span class="st">&quot;Estimate&quot;</span>]), <span class="dt">ID =</span> ows_vc$ID[<span class="dv">1</span>],
    <span class="dt">grid_year =</span> ows_vc$grid_year[<span class="dv">1</span>])
  <span class="kw">rbind</span>(<span class="kw">rbind</span>(ars_t, kpd_t), ows_t)
}


<span class="kw">library</span>(foreach)
<span class="kw">library</span>(doMC)
ncores =<span class="st"> </span><span class="dv">12</span>
<span class="kw">registerDoMC</span>(<span class="dt">cores =</span> ncores)

batches &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">start =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">1000</span>, <span class="kw">round</span>(<span class="dv">1000</span>/ncores))[<span class="dv">1</span>:ncores])
batches$stop &lt;-<span class="st"> </span><span class="kw">c</span>(batches$start[<span class="dv">2</span>:<span class="kw">length</span>(batches$start)] -<span class="st"> </span><span class="dv">1</span>, <span class="dv">1000</span>)

start_time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
nonlinear_mcmc &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span>:ncores, <span class="dt">.combine =</span> rbind) %dopar%<span class="st"> </span>{
  results &lt;-<span class="st"> </span>fit_raneff_data %&gt;%
<span class="st">    </span><span class="kw">filter</span>(type ==<span class="st"> &quot;raneff&quot;</span>, itt %in%<span class="st"> </span>batches$start[i]:batches$stop[i]) %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(itt, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">    </span><span class="kw">do</span>(<span class="kw">arsNonlinearResults</span>(.))
}
run_time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>() -<span class="st"> </span>start_time
<span class="kw">print</span>(run_time)</code></pre>
<pre><code>## Time difference of 20.4 mins</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(nonlinear_mcmc, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/nonlinear_mcmc_models.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/nonlinear_mcmc_models.RData&quot;</span>)

pm_hpd_ars &lt;-<span class="st"> </span><span class="kw">getPosteriorParams</span>(
  nonlinear_mcmc[nonlinear_mcmc$fitness ==<span class="st">&quot;ars&quot;</span>, <span class="dv">3</span>:<span class="dv">18</span>])
pm_hpd_ows &lt;-<span class="st"> </span><span class="kw">getPosteriorParams</span>(
  nonlinear_mcmc[nonlinear_mcmc$fitness ==<span class="st">&quot;ows&quot;</span>, <span class="dv">3</span>:<span class="dv">18</span>])
pm_hpd_kpd &lt;-<span class="st"> </span><span class="kw">getPosteriorParams</span>(
  nonlinear_mcmc[nonlinear_mcmc$fitness ==<span class="st">&quot;kpd&quot;</span>, <span class="dv">3</span>:<span class="dv">18</span>])

nonlinear_results_mcmc &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">ARS =</span> pm_hpd_ars$pm_hpd,
  <span class="dt">OWS =</span> pm_hpd_ows$pm_hpd, <span class="dt">Fecundity =</span> pm_hpd_kpd$pm_hpd)
  
<span class="kw">row.names</span>(nonlinear_results_mcmc) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;Aggression&quot;</span>,
 <span class="st">&quot;Competition&quot;</span>, <span class="st">&quot;Activity&quot;</span>, <span class="st">&quot;Docility&quot;</span>, <span class="st">&quot;Aggression^2&quot;</span>, <span class="st">&quot;Activity^2&quot;</span>,
 <span class="st">&quot;Docility^2&quot;</span>, <span class="st">&quot;Aggression x Competition&quot;</span>, <span class="st">&quot;Activity x Competition&quot;</span>,
 <span class="st">&quot;Docility x Competition&quot;</span>, <span class="st">&quot;Aggression x Activity&quot;</span>,
 <span class="st">&quot;Aggression^2 x Competition&quot;</span>, <span class="st">&quot;Activity^2 x Competition&quot;</span>,
 <span class="st">&quot;Docility^2 x Competition&quot;</span>, <span class="st">&quot;Agg. x Act. x Competition&quot;</span>
 )</code></pre>
<h3 id="nonlinear-results">Nonlinear results</h3>
<p>The effect of competition on linear and nonlinear selection on female behavioral traits for annual reproductive success. Posterior modes are given with highest posterior density intervals in parentheses.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pandoc.table</span>(nonlinear_results_mcmc[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>:<span class="dv">16</span>), ], 
  <span class="dt">split.tables =</span> <span class="dv">160</span>)</code></pre>
<table>
<col width="33%" />
<col width="23%" />
<col width="23%" />
<col width="20%" />
<thead>
<tr class="header">
<th align="left"> </th>
<th align="right">ARS</th>
<th align="right">OWS</th>
<th align="right">Fecundity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Intercept</strong></td>
<td align="right">-0.76 (-1.18, -0.42)*</td>
<td align="right">-1.84 (-2.35, -1.42)*</td>
<td align="right">1.34 ( 1.28, 1.41)*</td>
</tr>
<tr class="even">
<td align="left"><strong>Competition</strong></td>
<td align="right">-2.58 (-3.98, -1.72)*</td>
<td align="right">-2.41 (-4.21, -1.27)*</td>
<td align="right">-0.06 (-0.19, 0.09)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Aggression</strong></td>
<td align="right">0.45 ( 0.08, 0.82)*</td>
<td align="right">0.59 ( 0.17, 1.13)*</td>
<td align="right">-0.04 (-0.09, 0.02)</td>
</tr>
<tr class="even">
<td align="left"><strong>Activity</strong></td>
<td align="right">-0.17 (-0.53, 0.17)</td>
<td align="right">-0.06 (-0.68, 0.24)</td>
<td align="right">0.03 (-0.05, 0.06)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Docility</strong></td>
<td align="right">-0.29 (-0.55, -0.13)*</td>
<td align="right">-0.29 (-0.54, -0.03)*</td>
<td align="right">0.04 ( 0.00, 0.07)*</td>
</tr>
<tr class="even">
<td align="left"><strong>Aggression^2</strong></td>
<td align="right">-0.12 (-0.51, 0.15)</td>
<td align="right">-0.28 (-0.70, 0.16)</td>
<td align="right">0.02 (-0.05, 0.05)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Activity^2</strong></td>
<td align="right">0.00 (-0.36, 0.23)</td>
<td align="right">-0.07 (-0.42, 0.31)</td>
<td align="right">-0.02 (-0.07, 0.02)</td>
</tr>
<tr class="even">
<td align="left"><strong>Docility^2</strong></td>
<td align="right">-0.15 (-0.33, 0.04)</td>
<td align="right">-0.20 (-0.41, 0.05)</td>
<td align="right">0.01 (-0.03, 0.04)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Aggression x Competition</strong></td>
<td align="right">1.71 ( 0.48, 2.66)*</td>
<td align="right">2.16 ( 0.55, 3.53)*</td>
<td align="right">-0.03 (-0.16, 0.09)</td>
</tr>
<tr class="even">
<td align="left"><strong>Activity x Competition</strong></td>
<td align="right">-0.72 (-1.77, 0.35)</td>
<td align="right">-0.24 (-1.70, 1.10)</td>
<td align="right">-0.03 (-0.15, 0.08)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Docility x Competition</strong></td>
<td align="right">-0.70 (-1.55, -0.26)*</td>
<td align="right">-0.45 (-1.13, 0.49)</td>
<td align="right">-0.04 (-0.14, 0.02)</td>
</tr>
<tr class="even">
<td align="left"><strong>Aggression x Activity</strong></td>
<td align="right">0.14 (-0.22, 0.67)</td>
<td align="right">0.21 (-0.29, 0.84)</td>
<td align="right">0.02 (-0.06, 0.08)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Aggression^2 x Competition</strong></td>
<td align="right">-0.27 (-1.36, 0.56)</td>
<td align="right">-0.35 (-1.98, 0.70)</td>
<td align="right">0.03 (-0.11, 0.14)</td>
</tr>
<tr class="even">
<td align="left"><strong>Activity^2 x Competition</strong></td>
<td align="right">-0.06 (-1.07, 0.68)</td>
<td align="right">-0.11 (-1.32, 1.00)</td>
<td align="right">0.00 (-0.11, 0.11)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Docility^2 x Competition</strong></td>
<td align="right">-0.51 (-1.05, 0.15)</td>
<td align="right">-0.34 (-1.29, 0.19)</td>
<td align="right">-0.02 (-0.11, 0.05)</td>
</tr>
<tr class="even">
<td align="left"><strong>Agg. x Act. x Competition</strong></td>
<td align="right">0.44 (-0.75, 1.92)</td>
<td align="right">0.52 (-1.08, 2.57)</td>
<td align="right">0.01 (-0.20, 0.16)</td>
</tr>
</tbody>
</table>
<h2 id="ignoring-behavioural-uncertainty">Ignoring behavioural uncertainty</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_blup.RData&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/fit_raneff_data.RData&quot;</span>)</code></pre>
<h3 id="correlations-between-selection-gradients-and-competition-1">Correlations between selection gradients and competition</h3>
<pre class="sourceCode r"><code class="sourceCode r">competition_year &lt;-<span class="st"> </span>fitness %&gt;%
<span class="st">  </span><span class="kw">filter</span>(grid_year !=<span class="st"> &quot;SU2008&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(Year, competition) %&gt;%
<span class="st">  </span><span class="kw">unique</span>() %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_competition =</span> <span class="kw">mean</span>(competition))
  
n_year &lt;-<span class="st"> </span><span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())
competition_year &lt;-<span class="st"> </span><span class="kw">left_join</span>(competition_year, n_year, <span class="dt">by =</span> <span class="st">&quot;Year&quot;</span>)
competition_year$Year &lt;-<span class="st"> </span><span class="kw">as.character</span>(competition_year$Year)

<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_blup.RData&quot;</span>)
sel_grads_blup_competition &lt;-<span class="st"> </span><span class="kw">left_join</span>(
  <span class="kw">filter</span>(sel_grads_blup, standardization ==<span class="st"> &quot;SD&quot;</span>), competition_year,
  <span class="dt">by =</span> <span class="st">&quot;Year&quot;</span>)
<span class="kw">save</span>(sel_grads_blup_competition, competition_year,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/sel_grads_blup_competition.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_blup_competition.RData&quot;</span>)

cor_sgrad_comp &lt;-<span class="st"> </span>function(x){
  v &lt;-<span class="st"> </span>x$variable[<span class="dv">1</span>]
  ct &lt;-<span class="st"> </span><span class="kw">cor.test</span>(x$coefficients, x$mean_competition)
  <span class="kw">data.frame</span>(<span class="dt">variable =</span> v, <span class="dt">est =</span> ct$estimate, <span class="dt">lower =</span> ct$conf.int[<span class="dv">1</span>],
    <span class="dt">upper =</span> ct$conf.int[<span class="dv">2</span>], <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
}

sg.comp &lt;-<span class="st"> </span>sel_grads_blup_competition %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(variable, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">do</span>(<span class="kw">cor_sgrad_comp</span>(<span class="dt">x=</span>.))
sg.comp[ ,<span class="dv">2</span>:<span class="dv">4</span>] &lt;-<span class="st"> </span><span class="kw">round</span>(sg.comp[ ,<span class="dv">2</span>:<span class="dv">4</span>], <span class="dt">digits =</span> <span class="dv">2</span>)
sg.comp$print &lt;-<span class="st"> </span><span class="kw">paste</span>(sg.comp$est, <span class="st">&quot; (&quot;</span>, sg.comp$lower, <span class="st">&quot;, &quot;</span>,
  sg.comp$upper, <span class="st">&quot;)&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</code></pre>
<h4 id="aggression-and-competition-1">Aggression and Competition</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sel_grads_blup_competition,
  variable ==<span class="st"> &quot;Aggression&quot;</span>), <span class="kw">aes</span>(<span class="dt">x =</span> mean_competition, <span class="dt">y =</span> coefficients))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Selection Gradient&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Aggression&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Juvenile Competition&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>), <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>), <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sg.comp, variable ==<span class="st"> &quot;Aggression&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">6</span>, <span class="dt">y =</span> <span class="fl">1.5</span>, <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;r = &quot;</span>, print, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)), <span class="dt">size =</span> <span class="fl">2.5</span>)
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/05_agg_comp_blup.png" />
</div>
<h4 id="activity-and-competition-1">Activity and Competition</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sel_grads_blup_competition, variable ==<span class="st"> &quot;Activity&quot;</span>), 
  <span class="kw">aes</span>(<span class="dt">x =</span> mean_competition, <span class="dt">y =</span> coefficients))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Selection Gradient&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Activity&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Juvenile Competition&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>),
  <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sg.comp, variable ==<span class="st"> &quot;Activity&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">6</span>, <span class="dt">y =</span> <span class="fl">2.2</span>, <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;r = &quot;</span>, print, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)), <span class="dt">size =</span> <span class="fl">2.5</span>)
  <span class="kw">pdf</span>(<span class="dt">file =</span> <span class="st">&quot;test.pdf&quot;</span>, <span class="dt">width =</span> <span class="fl">2.17</span>, <span class="dt">height =</span> <span class="fl">2.03</span>)
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<h4 id="docility-and-competition-1">Docility and Competition</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sel_grads_blup_competition, variable ==<span class="st"> &quot;Docility&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> mean_competition, <span class="dt">y =</span> coefficients))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Selection Gradient&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Docility&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Juvenile Competition&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>),
  <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sg.comp, variable ==<span class="st"> &quot;Docility&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">6</span>, <span class="dt">y =</span> <span class="dv">1</span>, <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;r = &quot;</span>, print, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)), <span class="dt">size =</span> <span class="fl">2.5</span>)
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/05_doc_comp_blup.png" />
</div>
<h3 id="effect-of-competition-on-linear-selection">Effect of competition on linear selection</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/fit_raneff_data.RData&quot;</span>)
<span class="kw">library</span>(dplyr)
fit_raneff_data &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(fit_raneff_data)
<span class="kw">library</span>(lme4)
fit_raneff_data$oID &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="kw">nrow</span>(fit_raneff_data)

ars_linear_model  &lt;-<span class="st"> </span><span class="kw">glmer</span>(ars_all ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +
<span class="st">  </span>(<span class="dv">1</span>|ID) +<span class="st"> </span>(<span class="dv">1</span>|oID), <span class="dt">data =</span> <span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>),
  <span class="dt">family =</span> poisson, <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))
kpd_linear_model  &lt;-<span class="st"> </span><span class="kw">glmer</span>(kprod ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +
<span class="st">  </span>(<span class="dv">1</span>|ID) +<span class="st"> </span>(<span class="dv">1</span>|oID), <span class="dt">data =</span> <span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>),
  <span class="dt">family =</span> poisson, <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))
ows_linear_model  &lt;-<span class="st"> </span><span class="kw">glmer</span>(prop ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +
<span class="st">  </span>(<span class="dv">1</span>|ID) +<span class="st"> </span>(<span class="dv">1</span>|oID), <span class="dt">data =</span> <span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>),
  <span class="dt">weights =</span> kprod, <span class="dt">family =</span> binomial, <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))

<span class="kw">save</span>(ars_linear_model, kpd_linear_model, ows_linear_model,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/ars_linear_blup_models.RData&quot;</span>)</code></pre>
<p>Models with observation level random effect.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/fit_raneff_data.RData&quot;</span>)
<span class="kw">library</span>(dplyr)
fit_raneff_data &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(fit_raneff_data)
<span class="kw">library</span>(lme4)

fit_raneff_data$oID &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="kw">nrow</span>(fit_raneff_data)

ars_linear_model_  &lt;-<span class="st"> </span><span class="kw">glmer</span>(ars_all ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>(<span class="dv">1</span> |<span class="st"> </span>oID) +
<span class="st">  </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID), <span class="dt">data =</span> <span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>),
  <span class="dt">family =</span> poisson, <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))
kpd_linear_model_  &lt;-<span class="st"> </span><span class="kw">glmer</span>(kprod   ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>(<span class="dv">1</span> |<span class="st"> </span>oID) +
<span class="st">  </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID), <span class="dt">data =</span> <span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>), 
  <span class="dt">family =</span> poisson, <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))
ows_linear_model_  &lt;-<span class="st"> </span><span class="kw">glmer</span>(prop    ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>(<span class="dv">1</span> |<span class="st"> </span>oID) +
<span class="st">  </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID), <span class="dt">data =</span> <span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>), 
  <span class="dt">weights =</span> kprod, <span class="dt">family =</span> binomial, <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))

<span class="kw">save</span>(ars_linear_model, kpd_linear_model, ows_linear_model,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/ars_linear_blup_models.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/ars_linear_blup_models.RData&quot;</span>)
<span class="kw">library</span>(lme4)

getLmerParams &lt;-<span class="st"> </span>function(x){
  coefs &lt;-<span class="st"> </span><span class="kw">summary</span>(x)$coefficients
  coef.table &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">format</span>(coefs[ ,<span class="dv">1</span>:<span class="dv">3</span>], <span class="dt">digits =</span> <span class="dv">1</span>, <span class="dt">nsmall =</span> <span class="dv">2</span>, 
    <span class="dt">scientific =</span> <span class="ot">FALSE</span>))
  coef.table$pval[coefs[ ,<span class="dv">4</span>] &gt;<span class="st"> </span><span class="fl">0.001</span>] &lt;-<span class="st"> </span><span class="kw">format</span>(coefs[coefs[ ,<span class="dv">4</span>] &gt;<span class="st"> </span><span class="fl">0.001</span>, <span class="dv">4</span>], 
    <span class="dt">digits =</span> <span class="dv">1</span>, <span class="dt">nsmall =</span> <span class="dv">2</span>)
  coef.table$pval[coefs[ ,<span class="dv">4</span>] &lt;<span class="st"> </span><span class="fl">0.001</span>] &lt;-<span class="st"> &quot;&lt; 0.001&quot;</span>
  coef.table$coefs &lt;-<span class="st"> </span><span class="kw">paste</span>(coef.table$Estimate, <span class="st">&quot; ±&quot;</span>, coef.table$Std..Error, 
    <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)
  <span class="kw">return</span>(coef.table)
}

ars_linear_blup_results &lt;-<span class="st"> </span><span class="kw">getLmerParams</span>(ars_linear_model)
<span class="kw">row.names</span>(ars_linear_blup_results) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;Aggression&quot;</span>,
  <span class="st">&quot;Competition&quot;</span>, <span class="st">&quot;Activity&quot;</span>, <span class="st">&quot;Docility&quot;</span>, <span class="st">&quot;Aggression x Competition&quot;</span>,
  <span class="st">&quot;Activity x Competition&quot;</span>, <span class="st">&quot;Docility x Competition&quot;</span>)
<span class="kw">names</span>(ars_linear_blup_results) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Estimate&quot;</span>, <span class="st">&quot;SE&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;P&quot;</span>, <span class="st">&quot;Est ± se&quot;</span>)</code></pre>
<h4 id="interaction-between-competition-and-linear-selection-results-1">Interaction between competition and linear selection results</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pandoc.table</span>(ars_linear_blup_results[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>:<span class="dv">8</span>), <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">3</span>)],
  <span class="dt">justify =</span> <span class="st">&quot;right&quot;</span>, <span class="dt">split.tables =</span> <span class="dv">160</span>)</code></pre>
<table>
<col width="43%" />
<col width="18%" />
<col width="11%" />
<col width="6%" />
<thead>
<tr class="header">
<th align="right"> </th>
<th align="right">Est ± se</th>
<th align="right">P</th>
<th align="right">Z</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><strong>Intercept</strong></td>
<td align="right">-1.10 ± 0.22</td>
<td align="right">&lt; 0.001</td>
<td align="right">-5.09</td>
</tr>
<tr class="even">
<td align="right"><strong>Competition</strong></td>
<td align="right">-3.62 ± 0.64</td>
<td align="right">&lt; 0.001</td>
<td align="right">-5.64</td>
</tr>
<tr class="odd">
<td align="right"><strong>Aggression</strong></td>
<td align="right">0.74 ± 0.21</td>
<td align="right">&lt; 0.001</td>
<td align="right">3.49</td>
</tr>
<tr class="even">
<td align="right"><strong>Activity</strong></td>
<td align="right">-0.32 ± 0.20</td>
<td align="right">0.11</td>
<td align="right">-1.61</td>
</tr>
<tr class="odd">
<td align="right"><strong>Docility</strong></td>
<td align="right">-0.27 ± 0.16</td>
<td align="right">0.10</td>
<td align="right">-1.67</td>
</tr>
<tr class="even">
<td align="right"><strong>Aggression x Competition</strong></td>
<td align="right">2.62 ± 0.64</td>
<td align="right">&lt; 0.001</td>
<td align="right">4.07</td>
</tr>
<tr class="odd">
<td align="right"><strong>Activity x Competition</strong></td>
<td align="right">-1.36 ± 0.61</td>
<td align="right">0.03</td>
<td align="right">-2.21</td>
</tr>
<tr class="even">
<td align="right"><strong>Docility x Competition</strong></td>
<td align="right">-0.77 ± 0.49</td>
<td align="right">0.11</td>
<td align="right">-1.58</td>
</tr>
</tbody>
</table>
<h3 id="competition-and-nonlinear-selection">Competition and nonlinear selection</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/fit_raneff_data.RData&quot;</span>)
<span class="kw">library</span>(lme4)
fit_blups_data &lt;-<span class="st"> </span><span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>)
fit_blups_data$oID &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="kw">nrow</span>(fit_blups_data)

ars_nl_model &lt;-<span class="st"> </span><span class="kw">glmer</span>(ars_all ~<span class="st"> </span>aggression_s*competition_s +<span class="st"> </span>
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>
<span class="st">  </span>aggression_s*activity_s*competition_s +<span class="st"> </span><span class="kw">I</span>(aggression_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span>
<span class="st">  </span><span class="kw">I</span>(activity_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span><span class="kw">I</span>(docility_s^<span class="dv">2</span>)*competition_s +
<span class="st">  </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID) +<span class="st"> </span>(<span class="dv">1</span>|oID),
  <span class="dt">data =</span> fit_blups_data, <span class="dt">family =</span> poisson,
  <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))

ars_nl_model &lt;-<span class="st"> </span><span class="kw">glmer</span>(ars_all ~<span class="st"> </span>aggression_s*competition_s +<span class="st"> </span>
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>
<span class="st">  </span>aggression_s*activity_s*competition_s +<span class="st"> </span><span class="kw">I</span>(aggression_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span>
<span class="st">  </span><span class="kw">I</span>(activity_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span><span class="kw">I</span>(docility_s^<span class="dv">2</span>)*competition_s +
<span class="st">  </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID),
  <span class="dt">data =</span> fit_blups_data, <span class="dt">family =</span> poisson,
  <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))
  
kpd_nl_model &lt;-<span class="st"> </span><span class="kw">glmer</span>(kprod ~<span class="st"> </span>aggression_s*competition_s +<span class="st"> </span>
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>
<span class="st">  </span>aggression_s*activity_s*competition_s +<span class="st"> </span><span class="kw">I</span>(aggression_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span>
<span class="st">  </span><span class="kw">I</span>(activity_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span><span class="kw">I</span>(docility_s^<span class="dv">2</span>)*competition_s +
<span class="st">  </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID) +<span class="st"> </span>(<span class="dv">1</span>|oID),
  <span class="dt">data =</span> fit_blups_data, <span class="dt">family =</span> poisson,
  <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))
  
ows_nl_model &lt;-<span class="st"> </span><span class="kw">glmer</span>(prop ~<span class="st"> </span>aggression_s*competition_s +<span class="st"> </span>
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>
<span class="st">  </span>aggression_s*activity_s*competition_s +<span class="st"> </span><span class="kw">I</span>(aggression_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span>
<span class="st">  </span><span class="kw">I</span>(activity_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span><span class="kw">I</span>(docility_s^<span class="dv">2</span>)*competition_s +
<span class="st">  </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID) +<span class="st"> </span>(<span class="dv">1</span>|oID),
  <span class="dt">data =</span> fit_blups_data, <span class="dt">weights =</span> kprod,
  <span class="dt">family =</span> binomial,
  <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))

<span class="kw">save</span>(ars_nl_model,kpd_nl_model, ows_nl_model,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/nl.blup_models.RData&quot;</span>)

fit_raneff_data %&gt;%
<span class="st">  </span><span class="kw">ungroup</span>() %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">mean_ars =</span> <span class="kw">mean</span>(ars_all, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">var_ars =</span> <span class="kw">var</span>(ars_all, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">mean_kpd =</span> <span class="kw">mean</span>(kprod, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">var_kpd =</span> <span class="kw">var</span>(kprod, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
    )</code></pre>
<pre><code>## Source: local data frame [1 x 4]
## 
##   mean_ars var_ars mean_kpd var_kpd
## 1   0.8784   1.255    3.902   4.372</code></pre>
<h4 id="format-results-of-nonlinear-selection-for-table">Format results of nonlinear selection for table</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/nl.blup_models.RData&quot;</span>)

coef_p_ars &lt;-<span class="st"> </span><span class="kw">getLmerParams</span>(ars_nl_model)
coef_p_ows &lt;-<span class="st"> </span><span class="kw">getLmerParams</span>(ows_nl_model)
coef_p_kpd &lt;-<span class="st"> </span><span class="kw">getLmerParams</span>(kpd_nl_model)

term_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;Aggression&quot;</span>,
 <span class="st">&quot;Competition&quot;</span>, <span class="st">&quot;Activity&quot;</span>, <span class="st">&quot;Docility&quot;</span>, <span class="st">&quot;Aggression^2&quot;</span>, <span class="st">&quot;Activity^2&quot;</span>,
 <span class="st">&quot;Docility^2&quot;</span>, <span class="st">&quot;Aggression x Competition&quot;</span>, <span class="st">&quot;Activity x Competition&quot;</span>,
 <span class="st">&quot;Docility x Competition&quot;</span>, <span class="st">&quot;Aggression x Activity&quot;</span>,
 <span class="st">&quot;Aggression^2 x Competition&quot;</span>, <span class="st">&quot;Activity^2 x Competition&quot;</span>,
 <span class="st">&quot;Docility^2 x Competition&quot;</span>, <span class="st">&quot;Agg. x Act. x Competition&quot;</span>
 )

<span class="kw">row.names</span>(coef_p_ars) &lt;-<span class="st"> </span>term_names
<span class="kw">row.names</span>(coef_p_ows) &lt;-<span class="st"> </span>term_names
<span class="kw">row.names</span>(coef_p_kpd) &lt;-<span class="st"> </span>term_names

<span class="kw">names</span>(coef_p_ars) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Estimate&quot;</span>, <span class="st">&quot;SE&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;P&quot;</span>, <span class="st">&quot;Est ± se&quot;</span>)
<span class="kw">names</span>(coef_p_ows) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Estimate&quot;</span>, <span class="st">&quot;SE&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;P&quot;</span>, <span class="st">&quot;Est ± se&quot;</span>)
<span class="kw">names</span>(coef_p_kpd) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Estimate&quot;</span>, <span class="st">&quot;SE&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;P&quot;</span>, <span class="st">&quot;Est ± se&quot;</span>)</code></pre>
<h3 id="nonlinear-results-1">Nonlinear results</h3>
<p>The effect of competition on linear and nonlinear selection on female behavioral traits for annual reproductive success. Posterior modes are given with highest posterior density intervals in parentheses.</p>
<h4 id="ars">ARS</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pandoc.table</span>(coef_p_ars[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>:<span class="dv">16</span>), <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">4</span>)],
 <span class="dt">split.tables =</span> <span class="dv">160</span>)</code></pre>
<table>
<col width="44%" />
<col width="18%" />
<col width="8%" />
<col width="9%" />
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Est ± se</th>
<th align="center">Z</th>
<th align="center">P</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>Intercept</strong></td>
<td align="center">-0.68 ± 0.31</td>
<td align="center">-2.23</td>
<td align="center">0.025</td>
</tr>
<tr class="even">
<td align="center"><strong>Competition</strong></td>
<td align="center">-2.24 ± 0.91</td>
<td align="center">-2.46</td>
<td align="center">0.014</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression</strong></td>
<td align="center">0.96 ± 0.31</td>
<td align="center">3.06</td>
<td align="center">0.002</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity</strong></td>
<td align="center">-0.66 ± 0.28</td>
<td align="center">-2.35</td>
<td align="center">0.019</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility</strong></td>
<td align="center">-0.51 ± 0.23</td>
<td align="center">-2.18</td>
<td align="center">0.029</td>
</tr>
<tr class="even">
<td align="center"><strong>Aggression^2</strong></td>
<td align="center">-0.65 ± 0.32</td>
<td align="center">-2.07</td>
<td align="center">0.039</td>
</tr>
<tr class="odd">
<td align="center"><strong>Activity^2</strong></td>
<td align="center">-0.30 ± 0.26</td>
<td align="center">-1.16</td>
<td align="center">0.247</td>
</tr>
<tr class="even">
<td align="center"><strong>Docility^2</strong></td>
<td align="center">-0.18 ± 0.12</td>
<td align="center">-1.48</td>
<td align="center">0.139</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression x Competition</strong></td>
<td align="center">3.40 ± 0.92</td>
<td align="center">3.68</td>
<td align="center">&lt; 0.001</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity x Competition</strong></td>
<td align="center">-2.45 ± 0.84</td>
<td align="center">-2.90</td>
<td align="center">0.004</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility x Competition</strong></td>
<td align="center">-1.41 ± 0.69</td>
<td align="center">-2.04</td>
<td align="center">0.041</td>
</tr>
<tr class="even">
<td align="center"><strong>Aggression x Activity</strong></td>
<td align="center">1.01 ± 0.43</td>
<td align="center">2.35</td>
<td align="center">0.019</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression^2 x Competition</strong></td>
<td align="center">-1.86 ± 0.96</td>
<td align="center">-1.93</td>
<td align="center">0.053</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity^2 x Competition</strong></td>
<td align="center">-0.81 ± 0.77</td>
<td align="center">-1.05</td>
<td align="center">0.295</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility^2 x Competition</strong></td>
<td align="center">-0.63 ± 0.39</td>
<td align="center">-1.61</td>
<td align="center">0.107</td>
</tr>
<tr class="even">
<td align="center"><strong>Agg. x Act. x Competition</strong></td>
<td align="center">2.62 ± 1.32</td>
<td align="center">1.99</td>
<td align="center">0.046</td>
</tr>
</tbody>
</table>
<h4 id="ows">OWS</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pandoc.table</span>(coef_p_ows[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>:<span class="dv">16</span>), <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">4</span>)],
 <span class="dt">split.tables =</span> <span class="dv">160</span>)</code></pre>
<table>
<col width="44%" />
<col width="18%" />
<col width="8%" />
<col width="9%" />
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Est ± se</th>
<th align="center">Z</th>
<th align="center">P</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>Intercept</strong></td>
<td align="center">-1.92 ± 0.39</td>
<td align="center">-4.87</td>
<td align="center">&lt; 0.001</td>
</tr>
<tr class="even">
<td align="center"><strong>Competition</strong></td>
<td align="center">-2.48 ± 1.18</td>
<td align="center">-2.11</td>
<td align="center">0.035</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression</strong></td>
<td align="center">1.33 ± 0.42</td>
<td align="center">3.17</td>
<td align="center">0.001</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity</strong></td>
<td align="center">-0.82 ± 0.38</td>
<td align="center">-2.14</td>
<td align="center">0.032</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility</strong></td>
<td align="center">-0.49 ± 0.29</td>
<td align="center">-1.70</td>
<td align="center">0.088</td>
</tr>
<tr class="even">
<td align="center"><strong>Aggression^2</strong></td>
<td align="center">-1.02 ± 0.43</td>
<td align="center">-2.36</td>
<td align="center">0.018</td>
</tr>
<tr class="odd">
<td align="center"><strong>Activity^2</strong></td>
<td align="center">-0.37 ± 0.36</td>
<td align="center">-1.03</td>
<td align="center">0.304</td>
</tr>
<tr class="even">
<td align="center"><strong>Docility^2</strong></td>
<td align="center">-0.18 ± 0.15</td>
<td align="center">-1.17</td>
<td align="center">0.242</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression x Competition</strong></td>
<td align="center">4.75 ± 1.28</td>
<td align="center">3.70</td>
<td align="center">&lt; 0.001</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity x Competition</strong></td>
<td align="center">-2.89 ± 1.20</td>
<td align="center">-2.40</td>
<td align="center">0.016</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility x Competition</strong></td>
<td align="center">-0.78 ± 0.90</td>
<td align="center">-0.86</td>
<td align="center">0.388</td>
</tr>
<tr class="even">
<td align="center"><strong>Aggression x Activity</strong></td>
<td align="center">1.40 ± 0.60</td>
<td align="center">2.35</td>
<td align="center">0.019</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression^2 x Competition</strong></td>
<td align="center">-3.11 ± 1.36</td>
<td align="center">-2.29</td>
<td align="center">0.022</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity^2 x Competition</strong></td>
<td align="center">-1.17 ± 1.10</td>
<td align="center">-1.06</td>
<td align="center">0.291</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility^2 x Competition</strong></td>
<td align="center">-0.50 ± 0.50</td>
<td align="center">-0.98</td>
<td align="center">0.325</td>
</tr>
<tr class="even">
<td align="center"><strong>Agg. x Act. x Competition</strong></td>
<td align="center">3.95 ± 1.86</td>
<td align="center">2.13</td>
<td align="center">0.034</td>
</tr>
</tbody>
</table>
<h4 id="fecundity">Fecundity</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pandoc.table</span>(coef_p_kpd[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>:<span class="dv">16</span>), <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">4</span>)],
 <span class="dt">split.tables =</span> <span class="dv">160</span>)</code></pre>
<table>
<col width="44%" />
<col width="20%" />
<col width="9%" />
<col width="9%" />
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Est ± se</th>
<th align="center">Z</th>
<th align="center">P</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>Intercept</strong></td>
<td align="center">1.362 ± 0.091</td>
<td align="center">14.937</td>
<td align="center">&lt; 0.001</td>
</tr>
<tr class="even">
<td align="center"><strong>Competition</strong></td>
<td align="center">-0.017 ± 0.161</td>
<td align="center">-0.106</td>
<td align="center">0.92</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression</strong></td>
<td align="center">-0.058 ± 0.049</td>
<td align="center">-1.176</td>
<td align="center">0.24</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity</strong></td>
<td align="center">0.030 ± 0.050</td>
<td align="center">0.594</td>
<td align="center">0.55</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility</strong></td>
<td align="center">0.030 ± 0.041</td>
<td align="center">0.724</td>
<td align="center">0.47</td>
</tr>
<tr class="even">
<td align="center"><strong>Aggression^2</strong></td>
<td align="center">0.036 ± 0.053</td>
<td align="center">0.672</td>
<td align="center">0.50</td>
</tr>
<tr class="odd">
<td align="center"><strong>Activity^2</strong></td>
<td align="center">-0.064 ± 0.051</td>
<td align="center">-1.248</td>
<td align="center">0.21</td>
</tr>
<tr class="even">
<td align="center"><strong>Docility^2</strong></td>
<td align="center">0.005 ± 0.026</td>
<td align="center">0.209</td>
<td align="center">0.83</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression x Competition</strong></td>
<td align="center">-0.067 ± 0.117</td>
<td align="center">-0.579</td>
<td align="center">0.56</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity x Competition</strong></td>
<td align="center">0.008 ± 0.088</td>
<td align="center">0.086</td>
<td align="center">0.93</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility x Competition</strong></td>
<td align="center">-0.116 ± 0.087</td>
<td align="center">-1.325</td>
<td align="center">0.19</td>
</tr>
<tr class="even">
<td align="center"><strong>Aggression x Activity</strong></td>
<td align="center">0.024 ± 0.075</td>
<td align="center">0.319</td>
<td align="center">0.75</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression^2 x Competition</strong></td>
<td align="center">0.153 ± 0.149</td>
<td align="center">1.029</td>
<td align="center">0.30</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity^2 x Competition</strong></td>
<td align="center">0.079 ± 0.145</td>
<td align="center">0.545</td>
<td align="center">0.59</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility^2 x Competition</strong></td>
<td align="center">-0.067 ± 0.055</td>
<td align="center">-1.218</td>
<td align="center">0.22</td>
</tr>
<tr class="even">
<td align="center"><strong>Agg. x Act. x Competition</strong></td>
<td align="center">-0.252 ± 0.240</td>
<td align="center">-1.051</td>
<td align="center">0.29</td>
</tr>
</tbody>
</table>
<h4 id="plot-of-quadratic-interaction">Plot of quadratic interaction</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(effects)</code></pre>
<pre><code>## Loading required package: colorspace
## 
## Attaching package: &#39;effects&#39;
## 
## The following object is masked from &#39;package:car&#39;:
## 
##     Prestige</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)

g.ows &lt;-<span class="st"> </span><span class="kw">glm</span>(prop ~<span class="st"> </span>aggression_s *<span class="st"> </span>competition_s +<span class="st"> </span>activity_s *<span class="st"> </span>
<span class="st">    </span>competition_s +<span class="st"> </span>docility_s *<span class="st"> </span>competition_s +<span class="st"> </span>aggression_s:activity_s *<span class="st"> </span>
<span class="st">    </span>competition_s +<span class="st"> </span><span class="kw">I</span>(aggression_s^<span class="dv">2</span>) *<span class="st"> </span>competition_s, <span class="dt">data =</span> <span class="kw">filter</span>(fit_raneff_data, 
    type ==<span class="st"> &quot;blup&quot;</span>), <span class="dt">weights =</span> kprod, <span class="dt">family =</span> binomial)</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">e.ows &lt;-<span class="st"> </span><span class="kw">effect</span>(<span class="dt">term =</span> <span class="st">&quot;aggression_s:competition_s:activity_s&quot;</span>, 
    <span class="dt">mod =</span> g.ows)

e &lt;-<span class="st"> </span><span class="kw">Effect</span>(<span class="kw">c</span>(<span class="st">&quot;aggression_s&quot;</span>, <span class="st">&quot;activity_s&quot;</span>, <span class="st">&quot;competition_s&quot;</span>), 
    g.ows, <span class="dt">xlevels =</span> <span class="kw">list</span>(<span class="dt">aggression_s =</span> <span class="dv">100</span>, <span class="dt">activity_s =</span> <span class="dv">2</span>, 
        <span class="dt">competition_s =</span> <span class="dv">2</span>))

s &lt;-<span class="st"> </span><span class="kw">summary</span>(e, <span class="dt">type =</span> <span class="st">&quot;link&quot;</span>)
se &lt;-<span class="st"> </span>s$effect
su &lt;-<span class="st"> </span>s$upper
sl &lt;-<span class="st"> </span>s$lower
d &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(se)
du &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(su)
dl &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(sl)
<span class="kw">names</span>(d) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;la.lc&quot;</span>, <span class="st">&quot;ha.lc&quot;</span>, <span class="st">&quot;la.hc&quot;</span>, <span class="st">&quot;ha.hc&quot;</span>)
<span class="kw">names</span>(du) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;la.lc&quot;</span>, <span class="st">&quot;ha.lc&quot;</span>, <span class="st">&quot;la.hc&quot;</span>, <span class="st">&quot;ha.hc&quot;</span>)
<span class="kw">names</span>(dl) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;la.lc&quot;</span>, <span class="st">&quot;ha.lc&quot;</span>, <span class="st">&quot;la.hc&quot;</span>, <span class="st">&quot;ha.hc&quot;</span>)

plot_d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Aggression =</span> <span class="kw">as.numeric</span>(<span class="kw">rep</span>(<span class="kw">row.names</span>(s$effect), 
    <span class="dv">12</span>)), <span class="dt">OWS =</span> <span class="kw">c</span>(d$la.lc, d$ha.lc, d$la.hc, d$ha.hc, du$la.lc, 
    du$ha.lc, du$la.hc, du$ha.hc, dl$la.lc, dl$ha.lc, dl$la.hc, 
    dl$ha.hc), <span class="dt">Competition =</span> <span class="kw">rep</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;Low</span><span class="ch">\n</span><span class="st">Competition&quot;</span>, <span class="st">&quot;High</span><span class="ch">\n</span><span class="st">Competition&quot;</span>), 
    <span class="dt">each =</span> <span class="dv">200</span>), <span class="dv">3</span>), <span class="dt">Activity =</span> <span class="kw">rep</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;High&quot;</span>), <span class="dt">each =</span> <span class="dv">100</span>), 
    <span class="dv">6</span>), <span class="dt">type =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;main&quot;</span>, <span class="st">&quot;upper&quot;</span>, <span class="st">&quot;lower&quot;</span>), <span class="dt">each =</span> <span class="dv">400</span>))
plot_d$env &lt;-<span class="st"> </span><span class="kw">paste</span>(plot_d$Competition, plot_d$Activity, <span class="dt">sep =</span> <span class="st">&quot;.&quot;</span>)

quad_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(plot_d, <span class="kw">aes</span>(<span class="dt">x =</span> Aggression, <span class="dt">y =</span> OWS)) +<span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">alpha =</span> Activity, 
    <span class="dt">linetype =</span> type, <span class="dt">size =</span> type)) +<span class="st"> </span><span class="kw">facet_wrap</span>(~Competition) +<span class="st"> </span>
<span class="st">    </span><span class="kw">scale_alpha_discrete</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.3</span>)) +<span class="st"> </span><span class="kw">scale_linetype_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">2</span>, 
    <span class="dv">1</span>, <span class="dv">2</span>)) +<span class="st"> </span><span class="kw">scale_size_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="fl">0.3</span>, <span class="dv">1</span>, <span class="fl">0.3</span>)) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Offspring</span><span class="ch">\n</span><span class="st">Overwinter Survival&quot;</span>) +<span class="st"> </span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Aggression&quot;</span>) +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>) +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(), 
    <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(), 
    <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>), 
    <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>), 
    <span class="dt">legend.key =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.background =</span> <span class="kw">element_blank</span>()) +<span class="st"> </span>
<span class="st">    </span><span class="kw">guides</span>(<span class="dt">linetype =</span> <span class="ot">FALSE</span>, <span class="dt">size =</span> <span class="ot">FALSE</span>, <span class="dt">alpha =</span> <span class="kw">guide_legend</span>(<span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">1</span>))) +<span class="st"> </span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.75</span>, <span class="fl">0.25</span>), <span class="dt">legend.background =</span> <span class="kw">element_blank</span>(), 
        <span class="dt">legend.key.size =</span> <span class="kw">unit</span>(<span class="fl">0.4</span>, <span class="st">&quot;cm&quot;</span>)) +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, 
    <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>)) +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>(), 
    <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>())

<span class="kw">pdf</span>(<span class="st">&quot;figure/05_quad_print.pdf&quot;</span>, <span class="dt">width =</span> <span class="fl">3.14</span>, <span class="dt">height =</span> <span class="dv">2</span>)
quad_plot
<span class="kw">dev.off</span>()</code></pre>
<pre><code>## pdf 
##   2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">quad_plot</code></pre>
<div class="figure">
<img src="figure/05_quad.png" />
</div>
<h4 id="tile-plot-of-interaction">Tile plot of interaction</h4>
<pre class="sourceCode r"><code class="sourceCode r">n =<span class="st"> </span><span class="dv">12</span>
e &lt;-<span class="st"> </span><span class="kw">Effect</span>(<span class="kw">c</span>(<span class="st">&quot;aggression_s&quot;</span>, <span class="st">&quot;activity_s&quot;</span>, <span class="st">&quot;competition_s&quot;</span>), 
    g.ows, <span class="dt">xlevels =</span> <span class="kw">list</span>(<span class="dt">aggression_s =</span> n, <span class="dt">activity_s =</span> n, <span class="dt">competition_s =</span> <span class="dv">2</span>))
s &lt;-<span class="st"> </span><span class="kw">summary</span>(e, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)
de &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(s$effect)
de_lc &lt;-<span class="st"> </span>de[, <span class="dv">1</span>:n]
de_hc &lt;-<span class="st"> </span>de[, (n +<span class="st"> </span><span class="dv">1</span>):(<span class="dv">2</span> *<span class="st"> </span>n)]

fix.names &lt;-<span class="st"> </span>function(x) {
    a &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(<span class="kw">strsplit</span>(<span class="kw">names</span>(x), <span class="dt">split =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>), <span class="st">&quot;[[&quot;</span>, 
        <span class="dv">1</span>))
    b &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(<span class="kw">strsplit</span>(<span class="kw">names</span>(x), <span class="dt">split =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>), <span class="st">&quot;[[&quot;</span>, 
        <span class="dv">2</span>))
    out &lt;-<span class="st"> </span><span class="kw">paste</span>(a, b, <span class="dt">sep =</span> <span class="st">&quot;.&quot;</span>)
    <span class="kw">return</span>(out)
}

d_hc &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Aggression =</span> <span class="kw">rep</span>(<span class="kw">row.names</span>(de_hc), n), <span class="dt">Activity =</span> <span class="kw">rep</span>(<span class="kw">fix.names</span>(de_hc), 
    <span class="dt">each =</span> n), <span class="dt">OWS =</span> <span class="kw">as.vector</span>(<span class="kw">as.matrix</span>(de_hc)))
d_hc$Aggression &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(d_hc$Aggression))
d_hc$Activity &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(d_hc$Activity))

d_lc &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Aggression =</span> <span class="kw">rep</span>(<span class="kw">row.names</span>(de_lc), n), <span class="dt">Activity =</span> <span class="kw">rep</span>(<span class="kw">fix.names</span>(de_lc), 
    <span class="dt">each =</span> n), <span class="dt">OWS =</span> <span class="kw">as.vector</span>(<span class="kw">as.matrix</span>(de_lc)))
d_lc$Aggression &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(d_lc$Aggression))
d_lc$Activity &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(d_lc$Activity))

tile_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(d_lc, <span class="kw">aes</span>(<span class="dt">x =</span> Aggression, <span class="dt">y =</span> Activity, <span class="dt">z =</span> OWS)) +<span class="st"> </span>
<span class="st">    </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">alpha =</span> OWS), <span class="dt">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="dv">0</span>) +<span class="st"> </span><span class="kw">scale_alpha_continuous</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">1</span>, 
    <span class="dv">0</span>)) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Activity&quot;</span>) +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Aggression&quot;</span>) +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>) +<span class="st"> </span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), 
        <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, 
            <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>), <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), 
        <span class="dt">legend.key =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.background =</span> <span class="kw">element_blank</span>()) +<span class="st"> </span>
<span class="st">    </span><span class="kw">guides</span>(<span class="dt">linetype =</span> <span class="ot">FALSE</span>, <span class="dt">size =</span> <span class="ot">FALSE</span>, <span class="dt">alpha =</span> <span class="ot">FALSE</span>) +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, 
    <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))

<span class="kw">pdf</span>(<span class="st">&quot;figure/05_tile_print.pdf&quot;</span>, <span class="dt">width =</span> <span class="fl">3.14</span>, <span class="dt">height =</span> <span class="fl">3.14</span>)
tile_plot
<span class="kw">dev.off</span>()</code></pre>
<pre><code>## pdf 
##   2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tile_plot</code></pre>
<div class="figure">
<img src="figure/05_tile.png" />
</div>
</body>
</html>