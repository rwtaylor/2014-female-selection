<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
body {max-width:600px; padding:10px;}
  </style>
</head>
<body>
<nav id="TOC">
<ul>
<li><a href="#principal-component-analysis">Principal Component Analysis</a><ul>
<li><a href="#mirror-image-stimulation-pca">Mirror Image Stimulation PCA</a><ul>
<li><a href="#bartletts-test-kmo">Bartlett's test &amp; KMO</a></li>
<li><a href="#multivariate-normality">Multivariate normality</a></li>
<li><a href="#pseudo-replication">Pseudo-replication</a></li>
</ul></li>
<li><a href="#open-field-arena-pca">Open Field Arena PCA</a><ul>
<li><a href="#bartletts-test-kmo-1">Bartlett's test &amp; KMO</a></li>
<li><a href="#multivariate-normality-1">Multivariate normality</a></li>
<li><a href="#pseudo-replication-1">Pseudo-replication</a></li>
</ul></li>
<li><a href="#merge-pca-data">Merge PCA data</a></li>
</ul></li>
<li><a href="#random-effects-blups-repeatability">Random Effects, BLUPs &amp; Repeatability</a><ul>
<li><a href="#docility">Docility</a><ul>
<li><a href="#docility-repeatability">Docility Repeatability</a></li>
<li><a href="#docility-repeatability-across-years">Docility Repeatability Across Years</a></li>
<li><a href="#docility-repeatabiltiy-within-years">Docility Repeatabiltiy Within Years</a></li>
</ul></li>
<li><a href="#aggression">Aggression</a><ul>
<li><a href="#aggression-repeatability">Aggression Repeatability</a></li>
<li><a href="#aggression-repeatability-across-years">Aggression Repeatability Across Years</a></li>
<li><a href="#aggression-repeatabiltiy-within-years">Aggression Repeatabiltiy Within Years</a></li>
</ul></li>
<li><a href="#activity">Activity</a><ul>
<li><a href="#activity-repeatability">Activity Repeatability</a></li>
<li><a href="#activity-repeatability-across-years">Activity Repeatability Across Years</a></li>
<li><a href="#activity-repeatabiltiy-within-years">Activity Repeatabiltiy Within Years</a></li>
</ul></li>
<li><a href="#repeatability-summary">Repeatability Summary</a></li>
<li><a href="#run-lmer-models">Run lmer models</a><ul>
<li><a href="#docility-1">Docility</a></li>
<li><a href="#aggression-1">Aggression</a></li>
<li><a href="#activity-1">Activity</a></li>
</ul></li>
<li><a href="#extract-random-effects-blups">Extract random effects / BLUPs</a><ul>
<li><a href="#from-mcmcglmm-models">from MCMCglmm models</a></li>
<li><a href="#from-lmer-models">from lmer models</a></li>
<li><a href="#rbind-mcmc-raneffs-and-blups">rbind MCMC raneffs and BLUPs</a></li>
<li><a href="#rescale-docility-raneffs-blups">Rescale docility raneffs &amp; BLUPs</a></li>
</ul></li>
<li><a href="#model-diagnostics">Model Diagnostics</a><ul>
<li><a href="#docility-2">Docility</a></li>
<li><a href="#aggression-2">Aggression</a></li>
<li><a href="#activity-2">Activity</a></li>
</ul></li>
</ul></li>
<li><a href="#assessing-the-effect-of-priors-on-blups">Assessing the effect of priors on BLUPs</a><ul>
<li><a href="#priors">Priors</a></li>
<li><a href="#run-models">Run models</a><ul>
<li><a href="#model-diagnostics-1">Model Diagnostics</a></li>
</ul></li>
<li><a href="#extract-raneffs">Extract raneffs</a></li>
<li><a href="#compare-mcmc-priors">Compare MCMC priors</a><ul>
<li><a href="#posterior-modes">Posterior modes</a></li>
<li><a href="#variance-of-blups">Variance of blups</a></li>
</ul></li>
</ul></li>
<li><a href="#fitness-and-standardization">Fitness and Standardization</a><ul>
<li><a href="#load-data">Load Data</a></li>
<li><a href="#merge-fitness-with-blups">Merge fitness with blups</a></li>
<li><a href="#relative-fitness">Relative Fitness</a></li>
<li><a href="#standardize-variables">Standardize Variables</a></li>
<li><a href="#sample-sizes">Sample Sizes</a></li>
</ul></li>
<li><a href="#temporal-selection-gradients">Temporal Selection Gradients</a><ul>
<li><a href="#does-year-significantly-improve-models-of-selection">Does 'Year' significantly improve models of selection?</a></li>
<li><a href="#accounting-for-random-effect-uncertainty">Accounting for random effect uncertainty</a><ul>
<li><a href="#calculate-selection-gradients">Calculate selection gradients</a></li>
<li><a href="#plots">Plots</a></li>
<li><a href="#correlations">Correlations</a><ul>
<li><a href="#aggression-and-activity">Aggression and Activity</a></li>
<li><a href="#aggression-and-docility">Aggression and Docility</a></li>
<li><a href="#activity-and-docility">Activity and Docility</a></li>
</ul></li>
<li><a href="#summary-stats">Summary Stats</a></li>
</ul></li>
<li><a href="#ignoring-random-effect-uncertainty">Ignoring random effect uncertainty</a><ul>
<li><a href="#calculate-selection-gradients-1">Calculate selection gradients</a></li>
<li><a href="#plot">Plot</a></li>
<li><a href="#correlations-1">Correlations</a><ul>
<li><a href="#aggression-and-activity-1">Aggression and Activity</a></li>
<li><a href="#aggression-and-docility-1">Aggression and Docility</a></li>
<li><a href="#activity-and-docility-1">Activity and Docility</a></li>
</ul></li>
<li><a href="#summary-statistics">Summary Statistics</a></li>
</ul></li>
<li><a href="#compare-analytical-frameworks">Compare Analytical Frameworks</a><ul>
<li><a href="#table">Table</a></li>
<li><a href="#aggression-plot">Aggression plot</a></li>
<li><a href="#activity-plot">Activity Plot</a></li>
<li><a href="#docility-plot">Docility Plot</a></li>
</ul></li>
</ul></li>
<li><a href="#competition-and-selection">Competition and Selection</a><ul>
<li><a href="#accounting-for-behavioral-measurement-uncertainty">Accounting for behavioral measurement uncertainty</a><ul>
<li><a href="#correlations-between-selection-gradients-and-competition">Correlations between selection gradients and competition</a><ul>
<li><a href="#aggression-and-competition">Aggression and Competition</a></li>
<li><a href="#activity-and-competition">Activity and Competition</a></li>
<li><a href="#docility-and-competition">Docility and Competition</a></li>
</ul></li>
<li><a href="#effect-of-competition-on-linear-selection-glmms">Effect of competition on linear selection (glmms)</a><ul>
<li><a href="#interaction-between-competition-and-linear-selection-results">Interaction between competition and linear selection results</a></li>
</ul></li>
<li><a href="#competition-and-nonlinear-selection-glmms">Competition and nonlinear selection (glmms)</a></li>
<li><a href="#nonlinear-results">Nonlinear results</a></li>
</ul></li>
<li><a href="#ignoring-behavioural-uncertainty">Ignoring behavioural uncertainty</a><ul>
<li><a href="#correlations-between-selection-gradients-and-competition-1">Correlations between selection gradients and competition</a><ul>
<li><a href="#aggression-and-competition-1">Aggression and Competition</a></li>
<li><a href="#activity-and-competition-1">Activity and Competition</a></li>
<li><a href="#docility-and-competition-1">Docility and Competition</a></li>
</ul></li>
<li><a href="#effect-of-competition-on-linear-selection">Effect of competition on linear selection</a><ul>
<li><a href="#interaction-between-competition-and-linear-selection-results-1">Interaction between competition and linear selection results</a></li>
</ul></li>
<li><a href="#competition-and-nonlinear-selection">Competition and nonlinear selection</a><ul>
<li><a href="#format-results-of-nonlinear-selection-for-table">Format results of nonlinear selection for table</a></li>
</ul></li>
<li><a href="#nonlinear-results-1">Nonlinear results</a><ul>
<li><a href="#ars">ARS</a></li>
<li><a href="#ows">OWS</a></li>
<li><a href="#fecundity">Fecundity</a></li>
<li><a href="#plot-of-quadratic-interaction">Plot of quadratic interaction</a></li>
<li><a href="#tile-plot-of-interaction">Tile plot of interaction</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>



<!--pandoc
t: html
default-image-extension: png
template: templates/html.template
toc-depth: 4
toc:

t: latex
s:
S:
latex-engine: xelatex
template: templates/latex.template
default-image-extension: pdf
toc-depth: 4
toc:
-->


<h1 id="principal-component-analysis">Principal Component Analysis</h1>
<blockquote>
<p>When using PCA for data reduction rather than inferential analysis, assumption of normality is not required (Tabachnick &amp; Fidell 2001)</p>
</blockquote>
<p>We will use principal component analysis to reduce the redundancy among the behavioural measurements scored from the open field (OF) and mirror image stimulation (MIS) trials and to identify the dominant axes of behavioural variation in the OF and MIS trials. Principal components are calculated separately for the OF and MIS behavioural measurements using a correlation matrix. The behavioural dataset used in this analysis is exactly the same as used in Taylor et al. (2012) so the principal component loadings and scores are also the same.</p>
<p>To evaluate the appropriateness of this analyses we will follow Budaev's advice (2010. Using Principal Components and Factor Analysis in Animal Behaviour Research: Caveats and Guidelines. Ethology 116: 472–480.). Budaev suggests some best practices for reporting PCA results that we will follow.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MASS) <span class="co"># MASS clashes with dplyr... so always load first</span>
<span class="kw">library</span>(pander) <span class="co"># pander clashes with dplyr... so always load first</span></code></pre>
<pre><code>## 
## Attaching package: &#39;pander&#39;
## 
## The following object is masked from &#39;package:knitr&#39;:
## 
##     pandoc</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(foreach)</code></pre>
<pre><code>## foreach: simple, scalable parallel programming from Revolution Analytics
## Use Revolution R for scalability, fault tolerance and more.
## http://www.revolutionanalytics.com</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(doMC)</code></pre>
<pre><code>## Loading required package: iterators
## Loading required package: parallel</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">registerDoMC</span>()
<span class="kw">library</span>(tidyr)
<span class="kw">library</span>(dplyr)</code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;
## 
## The following object is masked from &#39;package:MASS&#39;:
## 
##     select
## 
## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag
## 
## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.alignment</span>(<span class="st">&#39;right&#39;</span>, <span class="dt">row.names =</span> <span class="st">&#39;left&#39;</span>)
<span class="kw">library</span>(mvnormtest)
<span class="kw">library</span>(psych)
<span class="kw">library</span>(ggplot2)</code></pre>
<pre><code>## 
## Attaching package: &#39;ggplot2&#39;
## 
## The following object is masked from &#39;package:psych&#39;:
## 
##     %+%</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MCMCglmm)</code></pre>
<pre><code>## Loading required package: Matrix
## Loading required package: coda
## Loading required package: lattice
## Loading required package: ape</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">behav_data &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(<span class="kw">read.table</span>(<span class="dt">file =</span> <span class="st">&quot;data/behaviour.csv&quot;</span>,
                                <span class="dt">sep =</span> <span class="st">&#39;,&#39;</span>,
                                <span class="dt">header =</span> <span class="ot">TRUE</span>,
                                <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>))
behav_data</code></pre>
<pre><code>## Source: local data frame [4,286 x 25]
## 
##     ID Sex Grid Year julian         trial_id Obs docil handlevent_year
## 1    4   F   SU 2005    177               NA MRG    28              12
## 2  601   M   AG 2005    165               NA CLS    15               9
## 3  601   M   AG 2005    182 0.44270.2005.182 ADI    17              10
## 4  601   M   AG 2005    224 0.44270.2005.224 ADI     8              12
## 5    5   F   KL 2005    170 0.46255.2005.170 ADI    10              10
## 6    5   F   KL 2005    184               NA MAW    20              11
## 7    5   F   KL 2005    212 0.46255.2005.212 ADI    12              14
## 8    5   F   KL 2005    219               NA ADI    10              15
## 9  603   M   AG 2005    170               NA CLS    17               7
## 10 603   M   AG 2005    173 0.46342.2005.173 ADI    12               8
## .. ... ...  ...  ...    ...              ... ...   ...             ...
## Variables not shown: Study (chr), front (dbl), attack_rate (dbl), back
##   (dbl), ln_attack_latency (dbl), ln_approach_latency (dbl), hole_rate
##   (dbl), jump_rate (dbl), chew (dbl), still (dbl), hang (dbl), groom
##   (dbl), walk (dbl), fecal (dbl), trial_life (int), trial_year (int)</code></pre>
<h2 id="mirror-image-stimulation-pca">Mirror Image Stimulation PCA</h2>
<p>Budaev suggests using the Bartlett's test and the Kaiser–Meyer–Olkin (KMO) measure to assess sampling adequecy. Because the behaviour data contains multiple measures per individual we will first subsample the data, randomly choosing 1 record per individual. Bootstrap 100 times.</p>
<pre class="sourceCode r"><code class="sourceCode r">mis_data &lt;-<span class="st">  </span>behav_data %&gt;%
<span class="st">  </span><span class="kw">select</span>(ID, trial_id, front, attack_rate, back, ln_attack_latency, 
    ln_approach_latency)%&gt;%
<span class="st">  </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(front))
    
<span class="co"># Get only complete records of the MIS behaviours</span>
mis_sub_data &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span>:<span class="dv">100</span>, <span class="dt">.combine =</span> <span class="st">&#39;rbind&#39;</span>) %dopar%<span class="st"> </span>{
  mis_data %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(ID) %&gt;%
<span class="st">  </span><span class="kw">do</span>(<span class="kw">sample_n</span>(., <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">itt =</span> i)
}
<span class="kw">save</span>(mis_data, mis_sub_data, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/mis_sub.Rdata&quot;</span>)</code></pre>
<h3 id="bartletts-test-kmo">Bartlett's test &amp; KMO</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/mis_sub.Rdata&quot;</span>)
n_trials &lt;-<span class="st"> </span>mis_data %&gt;%<span class="st"> </span><span class="kw">ungroup</span>() %&gt;%<span class="st"> </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())
mis_KMO_Bart &lt;-<span class="st"> </span>mis_sub_data %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(itt) %&gt;%
<span class="st">    </span><span class="kw">select</span>(-ID, -trial_id) %&gt;%
<span class="st">    </span><span class="kw">summarise</span>(
      <span class="dt">KMO_MSA =</span> <span class="kw">KMO</span>(<span class="kw">cbind</span>(front, attack_rate, back, 
        ln_attack_latency, ln_approach_latency))$MSA,
      <span class="dt">cortest.bartlett =</span> <span class="kw">cortest.bartlett</span>(<span class="dt">R =</span> <span class="kw">cor</span>(<span class="kw">cbind</span>(front, 
        attack_rate, back, ln_attack_latency, 
        ln_approach_latency)), <span class="dt">n =</span> n_trials$n)$chisq
      )

p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mis_KMO_Bart, <span class="kw">aes</span>(<span class="dt">x =</span> KMO_MSA))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.01</span>)
p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Bootstrapped KMO MSA values&quot;</span>) +<span class="st"> </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</code></pre>
<pre><code>## Warning: position_stack requires constant width: output may be incorrect</code></pre>
<div class="figure">
<img src="figure/01_bartlett1.png" />
</div>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mis_KMO_Bart, <span class="kw">aes</span>(<span class="dt">x =</span> cortest.bartlett))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Bootstrapped cortest.bartlett chi-sq values&quot;</span>)
p +<span class="st"> </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>)) +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;chi-square (deg. free = 10)&quot;</span>)</code></pre>
<div class="figure">
<img src="figure/01_bartlett2.png" />
</div>
<p>The overall measure of sampling adequecy is fine (Measure of Sampling Adequacy = 0.7415). Bartletts test unsurprisingly rejects the hypotheses that all correlations are zero (P = 0).</p>
<h3 id="multivariate-normality">Multivariate normality</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/mis_sub.Rdata&quot;</span>)
mis_one &lt;-<span class="st"> </span>mis_sub_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(itt ==<span class="st"> </span><span class="dv">1</span>)
<span class="kw">mshapiro.test</span>(<span class="kw">t</span>(<span class="kw">as.matrix</span>(mis_one[-<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">8</span>)])))</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  Z
## W = 0.5897, p-value &lt; 2.2e-16</code></pre>
<p>The data are not multi-normal. In our case this isn't a major problem because we are not performing any statistical tests alongside the PCA, we are just using the PCA to reduce the dimensionality of the data. We will note that the data are not multivariate normal.</p>
<h3 id="pseudo-replication">Pseudo-replication</h3>
<p>Because our data contains multiple records per individual we will check to be sure pesudo-replication isn't having a large effect on the PCA loadings.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/mis_sub.Rdata&quot;</span>)
<span class="co"># Calculate PCA for subsampled data</span>
mis_pca &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span>:<span class="dv">100</span>, <span class="dt">.combine =</span> rbind) %do%<span class="st"> </span>{
  foo &lt;-<span class="st"> </span>mis_sub_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(itt ==<span class="st"> </span>i)
  pc_loadings &lt;-<span class="st"> </span><span class="kw">prcomp</span>(foo[-<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">8</span>)], <span class="dt">scale =</span> <span class="ot">TRUE</span>)$rotation[ ,<span class="st">&quot;PC1&quot;</span>]
  if(<span class="kw">sign</span>(pc_loadings[<span class="st">&quot;front&quot;</span>]) ==<span class="st"> </span>-<span class="dv">1</span>) {pc_loadings &lt;-<span class="st"> </span>pc_loadings *<span class="st"> </span>-<span class="dv">1</span>}
  pc_loadings
}

mis_pca &lt;-<span class="st"> </span><span class="kw">gather</span>(<span class="kw">data.frame</span>(mis_pca), front, attack_rate, back, ln_attack_latency, ln_approach_latency, <span class="dt">key =</span> <span class="st">&quot;trait&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;loading&quot;</span>)

<span class="co"># Calculate PCA for full dataset</span>
mis_pca_full &lt;-<span class="st"> </span><span class="kw">prcomp</span>(mis_data[-<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>, <span class="dv">8</span>)], <span class="dt">scale =</span> <span class="ot">TRUE</span>)

mis_pca_loadings &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">trait =</span> <span class="kw">dimnames</span>(mis_pca_full$rotation)[[<span class="dv">1</span>]],
                        <span class="dt">loading =</span> mis_pca_full$rotation[ ,<span class="st">&quot;PC1&quot;</span>])

if(<span class="kw">sign</span>(mis_pca_loadings$loading[mis_pca_loadings$trait ==<span class="st"> &quot;front&quot;</span>]) ==<span class="st"> </span>-<span class="dv">1</span>) {
  mis_pca_loadings$loading &lt;-<span class="st"> </span>mis_pca_loadings$loading *<span class="st"> </span>-<span class="dv">1</span>
}

p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mis_pca, <span class="kw">aes</span>(<span class="dt">x =</span> loading))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.01</span>) +<span class="st"> </span><span class="kw">facet_wrap</span>( ~<span class="st"> </span>trait)
p +<span class="st"> </span><span class="kw">geom_vline</span>(<span class="dt">data =</span> mis_pca_loadings,
      <span class="kw">aes</span>(<span class="dt">xintercept =</span> loading), <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>)</code></pre>
<p><img src="figure/01_misPCA.png" /> The loadings for PC 1 are nearly identical (subsampled to 1 trial per indidivual vs. full dataset). So we will continue with the loadings from the full dataset so that they are consistent with Taylor et al. 2012.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#  Reverse sign if &#39;front&#39; is negative. This way higher scores will always be </span>
<span class="co">#  more aggressive. Sign of pc scores is arbitrary. Make sure to reverse scores </span>
<span class="co">#  and loadings or else confusion!</span>
if(mis_pca_full$rotation[<span class="st">&quot;front&quot;</span>, <span class="st">&quot;PC1&quot;</span>] &lt;<span class="st"> </span><span class="dv">0</span>){
    mis_pca_full$rotation &lt;-<span class="st"> </span>-<span class="dv">1</span> *<span class="st"> </span>(mis_pca_full$rotation)
    mis_scores &lt;-<span class="st"> </span><span class="kw">data.frame</span>(-mis_pca_full$x)
    } else {
    mis_scores &lt;-<span class="st"> </span><span class="kw">data.frame</span>(mis_pca_full$x)
}

<span class="co"># reattach scores to trail.id (which was rowname after PCA)</span>
mis_pca_scores &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">trial_id =</span> mis_data$trial_id,
                   <span class="dt">misPC1 =</span> mis_scores$PC1,
                   <span class="dt">misPC2 =</span> mis_scores$PC2,
                   <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

mis_pca_summary &lt;-<span class="st"> </span><span class="kw">rbind</span>(mis_pca_full$rotation,
  <span class="dt">StdDev =</span> mis_pca_full$sdev,
  <span class="dt">PropVar =</span> mis_pca_full$sdev^<span class="dv">2</span> /<span class="st"> </span><span class="kw">sum</span>(mis_pca_full$sdev^<span class="dv">2</span>))</code></pre>
<h2 id="open-field-arena-pca">Open Field Arena PCA</h2>
<p>Following same procedure as above, now for the open field behavioural measures.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get only complete records of the MIS behaviours</span>
of_data &lt;-<span class="st"> </span>behav_data %&gt;%
<span class="st">             </span><span class="kw">select</span>(ID, trial_id, hole_rate,jump_rate, chew, still, hang,
              groom, walk, fecal) %&gt;%
<span class="st">             </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(hole_rate))

of_sub_data &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span>:<span class="dv">100</span>, <span class="dt">.combine =</span> <span class="st">&#39;rbind&#39;</span>) %dopar%<span class="st"> </span>{
  of_data %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(ID) %&gt;%
<span class="st">  </span><span class="kw">do</span>(<span class="kw">sample_n</span>(., <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">itt =</span> i)  
}
<span class="kw">save</span>(of_data, of_sub_data, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/of_sub_data.RData&quot;</span>)</code></pre>
<h3 id="bartletts-test-kmo-1">Bartlett's test &amp; KMO</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/of_sub_data.RData&quot;</span>)
n_trials &lt;-<span class="st"> </span>of_data %&gt;%<span class="st"> </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())
of_KMO_Bart &lt;-<span class="st"> </span>of_sub_data %&gt;%
<span class="st">                </span><span class="kw">group_by</span>(itt) %&gt;%
<span class="st">                </span><span class="kw">select</span>(-ID, -trial_id) %&gt;%
<span class="st">                </span><span class="kw">summarise</span>(
                  <span class="dt">KMO_MSA =</span> <span class="kw">KMO</span>(<span class="kw">cbind</span>(hole_rate, jump_rate, chew, still, hang, 
                    groom, walk, fecal))$MSA,
                  <span class="dt">cortest.bartlett =</span> <span class="kw">cortest.bartlett</span>(<span class="dt">R =</span> <span class="kw">cor</span>(<span class="kw">cbind</span>(hole_rate, 
                    jump_rate, chew, still, hang, groom, walk, fecal)),
                    <span class="dt">n =</span> n_trials$n)$chisq
                  )

p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(of_KMO_Bart, <span class="kw">aes</span>(<span class="dt">x =</span> KMO_MSA)) +<span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.01</span>)
p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Bootstrapped KMO MSA values&quot;</span>) +<span class="st"> </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</code></pre>
<pre><code>## Warning: position_stack requires constant width: output may be incorrect</code></pre>
<div class="figure">
<img src="figure/01_of_bartlett1.png" />
</div>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(of_KMO_Bart, <span class="kw">aes</span>(<span class="dt">x =</span> cortest.bartlett))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">5</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Bootstrapped cortest.bartlett chi-sq values&quot;</span>)
p +<span class="st"> </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1300</span>)) +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Chisq&quot;</span>)</code></pre>
<div class="figure">
<img src="figure/01_of_bartlett2.png" />
</div>
<p>The overall measure of sampling adequecy is a bit low, maybe..., (MSA = 0.6419). Again, Bartlett's test rejects the hypotheses that all correlations are zero (P = 0).</p>
<p>Lets take a closer look at the KMO test.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/of_sub_data.RData&quot;</span>)
kmo_of &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span>:<span class="dv">100</span>, <span class="dt">.combine =</span> <span class="st">&#39;rbind&#39;</span>) %do%<span class="st"> </span>{
  foo &lt;-<span class="st"> </span>of_sub_data %&gt;%<span class="st"> </span><span class="kw">ungroup</span>() %&gt;%<span class="st"> </span><span class="kw">filter</span>(itt ==<span class="st"> </span>i)
  <span class="kw">KMO</span>(foo[ ,<span class="kw">c</span>(-<span class="dv">1</span>,-<span class="dv">2</span>,-<span class="dv">11</span>)])$MSAi
}
kmo_of &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(<span class="kw">data.frame</span>(kmo_of))

p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">gather</span>(kmo_of, hole_rate, jump_rate, chew, still, hang, groom, walk, fecal, <span class="dt">key =</span> <span class="st">&quot;behav&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;KMO&quot;</span>), <span class="kw">aes</span>(<span class="dt">x =</span> KMO))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">facet_wrap</span>( ~<span class="st"> </span>behav) +<span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.02</span>) +<span class="st"> </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))
p +<span class="st"> </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">0.7</span>, <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>)</code></pre>
<div class="figure">
<img src="figure/01_closer_look_KMO.png" />
</div>
<p>Looks like the low overall KMO index is driven by grooming and hanging. Both of which don't factor in very highly in the PCA loadings. I think therefore this is OK.</p>
<h3 id="multivariate-normality-1">Multivariate normality</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/of_sub_data.RData&quot;</span>)
of_one &lt;-<span class="st"> </span>of_sub_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(itt ==<span class="st"> </span><span class="dv">1</span>)
<span class="kw">mshapiro.test</span>(<span class="kw">t</span>(<span class="kw">as.matrix</span>(of_one[-<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">11</span>)])))</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  Z
## W = 0.7185, p-value &lt; 2.2e-16</code></pre>
<p>The open field data are also not multi-normal (P = 2.4153 × 10<sup>-24</sup>).</p>
<h3 id="pseudo-replication-1">Pseudo-replication</h3>
<p>Because our data contains multiple records per individual we will check to be sure pesudo-replication isn't having a large effect on the PCA loadings.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/of_sub_data.RData&quot;</span>)
<span class="co"># Calculate PCA for subsampled data</span>
of_pca &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span>:<span class="dv">100</span>, <span class="dt">.combine =</span> rbind) %do%<span class="st"> </span>{
  foo &lt;-<span class="st"> </span>of_sub_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(itt ==<span class="st"> </span>i)
  pc_loadings &lt;-<span class="st"> </span><span class="kw">prcomp</span>(foo[-<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">11</span>)], <span class="dt">scale =</span> <span class="ot">TRUE</span>)$rotation[ ,<span class="st">&quot;PC1&quot;</span>]
  if(<span class="kw">sign</span>(pc_loadings[<span class="st">&quot;still&quot;</span>]) ==<span class="st"> </span><span class="dv">1</span>) {pc_loadings &lt;-<span class="st"> </span>pc_loadings *<span class="st"> </span>-<span class="dv">1</span>}
}

of_pca &lt;-<span class="st"> </span><span class="kw">gather</span>(<span class="kw">data.frame</span>(of_pca), hole_rate, jump_rate, chew, still, hang, groom, walk, fecal, <span class="dt">key =</span> <span class="st">&quot;trait&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;loading&quot;</span>)

<span class="co"># Calculate PCA for full dataset</span>
of_pca_full &lt;-<span class="st"> </span><span class="kw">prcomp</span>(of_data[-<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">11</span>)], <span class="dt">scale =</span> <span class="ot">TRUE</span>)

of_pca_loadings &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">trait =</span> <span class="kw">dimnames</span>(of_pca_full$rotation)[[<span class="dv">1</span>]],
                       <span class="dt">loading =</span> of_pca_full$rotation[ ,<span class="st">&quot;PC1&quot;</span>])

if(<span class="kw">sign</span>(of_pca_loadings$loading[of_pca_loadings$trait ==<span class="st"> &quot;still&quot;</span>]) ==<span class="st"> </span><span class="dv">1</span>) {
  of_pca_loadings$loading &lt;-<span class="st"> </span>of_pca_loadings$loading *<span class="st"> </span>-<span class="dv">1</span>
}

p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(of_pca, <span class="kw">aes</span>(<span class="dt">x =</span> loading)) +<span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.01</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">facet_wrap</span>( ~<span class="st"> </span>trait) 
p +<span class="st"> </span><span class="kw">geom_vline</span>(<span class="dt">data =</span> of_pca_loadings, <span class="kw">aes</span>(<span class="dt">xintercept =</span> loading), <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>)</code></pre>
<div class="figure">
<img src="figure/01_ofPCA.png" />
</div>
<p>Once again the loadings for PC 1 are spot on the modes of the bootstrap distribution. So we will continue with the loadings from the full dataset so that they are consistent with Taylor et al. 2012. Interestingly, hang and groom have the largest bootstrap variance, and these were the triats identified by the KMO test as not being sampled adequately.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/of_sub_data.RData&quot;</span>)
of_pca_full &lt;-<span class="st"> </span><span class="kw">prcomp</span>(of_data[-<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">11</span>)], <span class="dt">scale =</span> <span class="ot">TRUE</span>)
<span class="co">#  If the pc coefficient for still is positive, then reverse sign of PC scores</span>
<span class="co">#  so that high PC1 is more active.</span>
if(of_pca_full$rotation[<span class="st">&quot;still&quot;</span>, <span class="st">&quot;PC1&quot;</span>] &gt;<span class="st"> </span><span class="dv">0</span>){
    of_pca_full$rotation &lt;-<span class="st"> </span>-<span class="dv">1</span> *<span class="st"> </span>(of_pca_full$rotation)
    of_scores &lt;-<span class="st"> </span><span class="kw">data.frame</span>(-of_pca_full$x)
    } else {
    of_scores &lt;-<span class="st"> </span><span class="kw">data.frame</span>(of_pca_full$x)
}

<span class="co">#  Get scores</span>
of_pca_scores &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">trial_id =</span> of_data$trial_id, <span class="dt">ofPC1 =</span> of_scores$PC1, 
  <span class="dt">ofPC2 =</span> of_scores$PC2, <span class="dt">ofPC3 =</span> of_scores$PC3, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

of_pca_summary &lt;-<span class="st"> </span><span class="kw">rbind</span>(of_pca_full$rotation, <span class="dt">StdDev =</span> of_pca_full$sdev, 
  <span class="dt">PropVar =</span> of_pca_full$sdev^<span class="dv">2</span> /<span class="st"> </span><span class="kw">sum</span>(of_pca_full$sdev^<span class="dv">2</span>))

<span class="co"># Save score data</span>
<span class="kw">save</span>(mis_pca_summary, of_pca_summary,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/pca.RData&quot;</span>)</code></pre>
<h2 id="merge-pca-data">Merge PCA data</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/pca.RData&quot;</span>)

<span class="co"># merge pc scores with rest of data by trial id.</span>
pca_data &lt;-<span class="st"> </span><span class="kw">left_join</span>(behav_data, mis_pca_scores, <span class="dt">by =</span> <span class="st">&quot;trial_id&quot;</span>)
pca_data &lt;-<span class="st"> </span><span class="kw">left_join</span>(pca_data, of_pca_scores, <span class="dt">by =</span> <span class="st">&quot;trial_id&quot;</span>)

<span class="kw">save</span>(pca_data, mis_pca_summary, of_pca_summary,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/pca.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">of_table &lt;-<span class="st"> </span><span class="kw">c</span>(of_pca_summary[<span class="st">&quot;walk&quot;</span>,<span class="dv">1</span>], of_pca_summary[<span class="st">&quot;jump_rate&quot;</span>,<span class="dv">1</span>], 
              of_pca_summary[<span class="st">&quot;hole_rate&quot;</span>,<span class="dv">1</span>], of_pca_summary[<span class="st">&quot;fecal&quot;</span>,<span class="dv">1</span>], 
              of_pca_summary[<span class="st">&quot;hang&quot;</span>,<span class="dv">1</span>], of_pca_summary[<span class="st">&quot;chew&quot;</span>,<span class="dv">1</span>], 
              of_pca_summary[<span class="st">&quot;groom&quot;</span>,<span class="dv">1</span>], of_pca_summary[<span class="st">&quot;still&quot;</span>,<span class="dv">1</span>], 
              of_pca_summary[<span class="st">&quot;StdDev&quot;</span>,<span class="dv">1</span>], of_pca_summary[<span class="st">&quot;PropVar&quot;</span>,<span class="dv">1</span>] *<span class="st"> </span><span class="dv">100</span>)
of_table &lt;-<span class="st"> </span><span class="kw">format</span>(of_table, <span class="dt">nsmall =</span> <span class="dv">2</span>, <span class="dt">digits =</span> <span class="dv">0</span>)

mis_table &lt;-<span class="st"> </span><span class="kw">c</span>(mis_pca_summary[<span class="st">&quot;front&quot;</span>,<span class="dv">1</span>], mis_pca_summary[<span class="st">&quot;attack_rate&quot;</span>,<span class="dv">1</span>],
               mis_pca_summary[<span class="st">&quot;back&quot;</span>,<span class="dv">1</span>], 
               mis_pca_summary[<span class="st">&quot;ln_attack_latency&quot;</span>,<span class="dv">1</span>],
               mis_pca_summary[<span class="st">&quot;ln_approach_latency&quot;</span>,<span class="dv">1</span>], 
               mis_pca_summary[<span class="st">&quot;StdDev&quot;</span>,<span class="dv">1</span>],
               mis_pca_summary[<span class="st">&quot;PropVar&quot;</span>,<span class="dv">1</span>] *<span class="st"> </span><span class="dv">100</span>)
mis_table &lt;-<span class="kw">format</span>(mis_table, <span class="dt">nsmall =</span> <span class="dv">2</span>, <span class="dt">digits =</span> <span class="dv">0</span>)


pca_table &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">check.names =</span> <span class="ot">FALSE</span>,
  <span class="st">&quot;OF Behaviour&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Walk&quot;</span>, <span class="st">&quot;Jump Rate&quot;</span>, <span class="st">&quot;Hole Rate&quot;</span>, <span class="st">&quot;No. Pellets&quot;</span>, <span class="st">&quot;Hang&quot;</span>,
  <span class="st">&quot;Chew&quot;</span>, <span class="st">&quot;Groom&quot;</span>, <span class="st">&quot;Still&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;Std. Dev.&quot;</span>, <span class="st">&quot;% Total variance&quot;</span>, <span class="st">&quot;N records&quot;</span>,
  <span class="st">&quot;N individuals&quot;</span>),
  <span class="st">&quot;OF PC1&quot;</span> =<span class="st"> </span><span class="kw">c</span>(of_table[<span class="dv">1</span>:<span class="dv">8</span>], <span class="st">&quot;&quot;</span>, of_table[<span class="dv">9</span>:<span class="dv">10</span>], <span class="kw">nrow</span>(behav_data %&gt;%
<span class="st">                 </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(still))), <span class="kw">nrow</span>(of_data %&gt;%<span class="st"> </span><span class="kw">select</span>(ID) %&gt;%
<span class="st">                 </span><span class="kw">unique</span>())),
  <span class="st">&quot;MIS Behaviour&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Front&quot;</span>, <span class="st">&quot;Attack rate&quot;</span>, <span class="st">&quot;Back&quot;</span>, <span class="st">&quot;Attack latency&quot;</span>,
  <span class="st">&quot;Approach latency&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, <span class="dv">8</span>)),
  <span class="st">&quot;MIS PC1&quot;</span> =<span class="st"> </span><span class="kw">c</span>(mis_table[<span class="dv">1</span>:<span class="dv">5</span>], <span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, <span class="dv">4</span>), mis_table[<span class="dv">6</span>:<span class="dv">7</span>], 
  <span class="kw">nrow</span>(behav_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(front))), <span class="kw">nrow</span>(mis_data %&gt;%
<span class="st">  </span><span class="kw">select</span>(ID) %&gt;%<span class="st"> </span><span class="kw">unique</span>()))
  )
<span class="kw">pandoc.table</span>(pca_table)</code></pre>
<table>
<col width="23%" />
<col width="12%" />
<col width="23%" />
<col width="12%" />
<thead>
<tr class="header">
<th align="right">OF Behaviour</th>
<th align="right">OF PC1</th>
<th align="right">MIS Behaviour</th>
<th align="right">MIS PC1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">Walk</td>
<td align="right">0.47</td>
<td align="right">Front</td>
<td align="right">0.49</td>
</tr>
<tr class="even">
<td align="right">Jump Rate</td>
<td align="right">0.46</td>
<td align="right">Attack rate</td>
<td align="right">0.38</td>
</tr>
<tr class="odd">
<td align="right">Hole Rate</td>
<td align="right">0.31</td>
<td align="right">Back</td>
<td align="right">-0.41</td>
</tr>
<tr class="even">
<td align="right">No. Pellets</td>
<td align="right">0.30</td>
<td align="right">Attack latency</td>
<td align="right">-0.47</td>
</tr>
<tr class="odd">
<td align="right">Hang</td>
<td align="right">0.20</td>
<td align="right">Approach latency</td>
<td align="right">-0.48</td>
</tr>
<tr class="even">
<td align="right">Chew</td>
<td align="right">0.26</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="right">Groom</td>
<td align="right">-0.04</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="right">Still</td>
<td align="right">-0.53</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="right">Std. Dev.</td>
<td align="right">1.67</td>
<td align="right"></td>
<td align="right">1.67</td>
</tr>
<tr class="even">
<td align="right">% Total variance</td>
<td align="right">34.73</td>
<td align="right"></td>
<td align="right">55.79</td>
</tr>
<tr class="odd">
<td align="right">N records</td>
<td align="right">556</td>
<td align="right"></td>
<td align="right">553</td>
</tr>
<tr class="even">
<td align="right">N individuals</td>
<td align="right">365</td>
<td align="right"></td>
<td align="right">364</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sample sizes</span>
n_docil &lt;-<span class="st"> </span>pca_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(docil)) %&gt;%
<span class="st">            </span><span class="kw">group_by</span>(ID) %&gt;%<span class="st"> </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())

n_oft &lt;-<span class="st"> </span>pca_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(misPC1)) %&gt;%
<span class="st">           </span><span class="kw">group_by</span>(ID) %&gt;%<span class="st"> </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())

s_table &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">check.names =</span> <span class="ot">FALSE</span>,
     <span class="dt">Test =</span> <span class="kw">c</span>(<span class="st">&quot;OF / MIS&quot;</span>, <span class="st">&quot;Handling&quot;</span>),
    <span class="st">&quot;N trials&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="kw">sum</span>(n_oft$n), <span class="kw">sum</span>(n_docil$n)),
    <span class="st">&quot;N individuals&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="kw">length</span>(<span class="kw">unique</span>(n_oft$ID)), <span class="kw">length</span>(<span class="kw">unique</span>(n_docil$ID))),
    <span class="st">&quot;N &gt; 1 trial&quot;</span>   =<span class="st"> </span><span class="kw">c</span>(<span class="kw">length</span>(n_oft$ID[n_oft$n &gt;<span class="st"> </span><span class="dv">1</span>]),
                        <span class="kw">length</span>(n_docil$ID[n_docil$n &gt;<span class="st"> </span><span class="dv">1</span>]))
    )
<span class="kw">pandoc.table</span>(s_table)</code></pre>
<table>
<col width="12%" />
<col width="15%" />
<col width="22%" />
<col width="18%" />
<thead>
<tr class="header">
<th align="center">Test</th>
<th align="center">N trials</th>
<th align="center">N individuals</th>
<th align="center">N &gt; 1 trial</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">OF / MIS</td>
<td align="center">553</td>
<td align="center">364</td>
<td align="center">165</td>
</tr>
<tr class="even">
<td align="center">Handling</td>
<td align="center">4227</td>
<td align="center">869</td>
<td align="center">621</td>
</tr>
</tbody>
</table>
<!--pandoc
t: html
default-image-extension: png
template: templates/html.template
toc-depth: 4
toc:

t: latex
s:
S:
latex-engine: xelatex
template: templates/latex.template
default-image-extension: pdf
toc-depth: 4
toc:
-->


<h1 id="random-effects-blups-repeatability">Random Effects, BLUPs &amp; Repeatability</h1>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MASS) <span class="co"># MASS clashes with dplyr... so always load first</span>
<span class="kw">library</span>(pander) <span class="co"># pander clashes with dplyr... so always load first</span></code></pre>
<pre><code>## 
## Attaching package: &#39;pander&#39;
## 
## The following object is masked from &#39;package:knitr&#39;:
## 
##     pandoc</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.alignment</span>(<span class="st">&#39;right&#39;</span>, <span class="dt">row.names =</span> <span class="st">&#39;left&#39;</span>)
<span class="kw">library</span>(dplyr)</code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;
## 
## The following object is masked from &#39;package:MASS&#39;:
## 
##     select
## 
## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag
## 
## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MCMCglmm)</code></pre>
<pre><code>## Loading required package: Matrix
## Loading required package: coda
## Loading required package: lattice
## Loading required package: ape</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/pca.RData&quot;</span>)

doc_data &lt;-<span class="st"> </span>pca_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(docil))
agg_data &lt;-<span class="st"> </span>pca_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(misPC1))
act_data &lt;-<span class="st"> </span>pca_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(ofPC1))

thin &lt;-<span class="st"> </span><span class="dv">500</span>
burnin &lt;-<span class="st"> </span>thin *<span class="st"> </span><span class="dv">100</span>
nitt &lt;-<span class="st"> </span>burnin +<span class="st"> </span>thin *<span class="st"> </span><span class="dv">1000</span></code></pre>
<h2 id="docility">Docility</h2>
<p>Models with covariates for the behavioral tests as fixed effects and ID as a random effect. Covariates include the julian day of the test (continuous), the observer who administered the test (factor) and the handling event number for the year (continuous). We will save 1000 samples from the posterior distribution.</p>
<p>Setting pr = TRUE in MCMCglmm saves the posterior distribution of random effects.</p>
<pre class="sourceCode r"><code class="sourceCode r">prior &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">G =</span> <span class="kw">list</span>(<span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(doc_data$docil, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>)), 
  <span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(doc_data$docil, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">0.002</span>)
  )

time_start &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
doc_mcmc_model &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(docil ~<span class="st"> </span>julian +<span class="st"> </span>Obs +<span class="st"> </span>handlevent_year +
<span class="st">                            </span><span class="kw">I</span>(handlevent_year^<span class="dv">2</span>),
                     <span class="dt">random =</span> ~<span class="st"> </span>ID,
                     <span class="dt">prior =</span> prior,
                     <span class="dt">pr =</span> <span class="ot">TRUE</span>,
                     <span class="dt">data =</span> doc_data,
                     <span class="dt">thin =</span> thin,
                     <span class="dt">burnin =</span> burnin,
                     <span class="dt">nitt =</span> nitt,
                     <span class="dt">verbose =</span> <span class="ot">FALSE</span>
                     )
<span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Approx. model run time: &quot;</span>, <span class="kw">format</span>(<span class="kw">Sys.time</span>() -<span class="st"> </span>time_start)))</code></pre>
<pre><code>## [1] &quot;Approx. model run time:  26.52 mins&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(doc_mcmc_model, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/doc_mcmc_model.RData&quot;</span>)</code></pre>
<h3 id="docility-repeatability">Docility Repeatability</h3>
<p>Repeatability is the ratio of the between individual variance to the total variance of the trait (within and between individual variance).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/doc_mcmc_model.RData&quot;</span>)

PM_HPD &lt;-<span class="st"> </span>function(x){
  <span class="co"># Get the posterior mode and HPD interval for a posterior distribution</span>
  out &lt;-<span class="st"> </span><span class="kw">posterior.mode</span>(x)
  out[<span class="dv">2</span>:<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">HPDinterval</span>(x)
  <span class="kw">return</span>(out)
}

format_PM_HPD &lt;-<span class="st"> </span>function(x){
  fx &lt;-<span class="st"> </span><span class="kw">format</span>(x, <span class="dt">digits =</span> <span class="dv">2</span>, <span class="dt">nsmall =</span> <span class="dv">2</span>)
  out &lt;-<span class="st"> </span>fx[[<span class="dv">1</span>]]
  out[<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;(&quot;</span>, fx[<span class="dv">2</span>], <span class="st">&quot; – &quot;</span>, fx[<span class="dv">3</span>], <span class="st">&quot;)&quot;</span>, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)
  <span class="kw">return</span>(out)
}

doc_I_var &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(doc_mcmc_model$VCV[ ,<span class="st">&quot;ID&quot;</span>])
doc_P_var &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(<span class="kw">mcmc</span>(<span class="kw">rowSums</span>(doc_mcmc_model$VCV)))
doc_rep &lt;-<span class="st"> </span>doc_I_var /<span class="st"> </span>doc_P_var

dIv &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(doc_I_var)
dPv &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(doc_P_var)
dRv &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(doc_rep)

doc_table &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
   <span class="dt">Parameter  =</span> <span class="kw">c</span>(<span class="st">&quot;ID Variance&quot;</span>, <span class="st">&quot;Phen. Variance&quot;</span>, <span class="st">&quot;Repeatability&quot;</span>),
  <span class="st">&quot;Post Mode&quot;</span> =<span class="st"> </span><span class="kw">c</span>(dIv[<span class="dv">1</span>], dPv[<span class="dv">1</span>], dRv[<span class="dv">1</span>]),
  <span class="st">&quot;Cred Int.&quot;</span> =<span class="st"> </span><span class="kw">c</span>(dIv[<span class="dv">2</span>], dPv[<span class="dv">2</span>], dRv[<span class="dv">2</span>])
  )

<span class="kw">pandoc.table</span>(doc_table, <span class="dt">caption =</span> <span class="st">&quot;Docility repeatability using all trials&quot;</span>)</code></pre>
<table>
<caption>Docility repeatability using all trials</caption>
<col width="20%" />
<col width="16%" />
<col width="20%" />
<thead>
<tr class="header">
<th align="right">Parameter</th>
<th align="right">Post.Mode</th>
<th align="right">Cred.Int.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">ID Variance</td>
<td align="right">19.95</td>
<td align="right">(16.63 – 22.25)</td>
</tr>
<tr class="even">
<td align="right">Phen. Variance</td>
<td align="right">53.17</td>
<td align="right">(49.79 – 55.76)</td>
</tr>
<tr class="odd">
<td align="right">Repeatability</td>
<td align="right">0.38</td>
<td align="right">(0.33 – 0.40)</td>
</tr>
</tbody>
</table>
<h3 id="docility-repeatability-across-years">Docility Repeatability Across Years</h3>
<p>The above model treats repeated measures within a year the same as repeated measures across years (both exist in the dataset). Next we will subset the data to include only across year repeated measures.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/doc_mcmc_model.RData&quot;</span>)
<span class="co"># Split the dataset into within and across year sets</span>
<span class="co"># We will select one random trial for each squirrel from each year</span>
## Now split into groups of ID &amp; Year and sample one trial at random

doc_data_across &lt;-<span class="st"> </span>doc_data %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(ID, Year) %&gt;%
<span class="st">  </span>dplyr:::<span class="kw">sample_n.grouped_df</span>(<span class="dv">1</span>)

<span class="co"># Run model again</span>

prior &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">G =</span> <span class="kw">list</span>(<span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(doc_data_across$docil, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>)),
  <span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(doc_data_across$docil, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>)
  )
prior &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">G =</span> <span class="kw">list</span>(<span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(doc_data_across$docil, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>)),
  <span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(doc_data_across$docil, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>)
)

time_start &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()

doc_mcmc_model_across &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(docil ~<span class="st"> </span>julian +<span class="st"> </span>Obs +<span class="st"> </span>handlevent_year +<span class="st"> </span>
<span class="st">                                    </span><span class="kw">I</span>(handlevent_year^<span class="dv">2</span>),
                            <span class="dt">random =</span> ~<span class="st"> </span>ID,
                            <span class="dt">prior =</span> prior,
                            <span class="dt">pr =</span> <span class="ot">TRUE</span>,
                            <span class="dt">data =</span> <span class="kw">ungroup</span>(doc_data_across),
                            <span class="dt">thin =</span> thin,
                            <span class="dt">burnin =</span> burnin,
                            <span class="dt">nitt =</span> nitt,
                            <span class="dt">verbose =</span> <span class="ot">FALSE</span>
                            )
<span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Approx. model run time: &quot;</span>, <span class="kw">format</span>(<span class="kw">Sys.time</span>() -<span class="st"> </span>time_start)))</code></pre>
<pre><code>## [1] &quot;Approx. model run time:  10.28 mins&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(doc_mcmc_model_across,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/doc_mcmc_model_across.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/doc_mcmc_model_across.RData&quot;</span>)

doc_I_var_across &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(doc_mcmc_model_across$VCV[ ,<span class="st">&quot;ID&quot;</span>])
doc_P_var_across &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(<span class="kw">mcmc</span>(<span class="kw">rowSums</span>(doc_mcmc_model_across$VCV)))
doc_rep_across   &lt;-<span class="st"> </span>doc_I_var_across /<span class="st"> </span>doc_P_var_across

dIv_a &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(doc_I_var_across)
dPv_a &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(doc_P_var_across)
dRv_a &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(doc_rep_across)

doc_ay_table &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">check.names =</span> <span class="ot">FALSE</span>,
   <span class="dt">Parameter  =</span> <span class="kw">c</span>(<span class="st">&quot;ID Variance&quot;</span>, <span class="st">&quot;Phen. Variance&quot;</span>, <span class="st">&quot;Repeatability&quot;</span>),
  <span class="st">&quot;Post Mode&quot;</span> =<span class="st"> </span><span class="kw">c</span>(dIv_a[<span class="dv">1</span>], dPv_a[<span class="dv">1</span>], dRv_a[<span class="dv">1</span>]),
  <span class="st">&quot;Cred Int.&quot;</span> =<span class="st"> </span><span class="kw">c</span>(dIv_a[<span class="dv">2</span>], dPv_a[<span class="dv">2</span>], dRv_a[<span class="dv">2</span>])
  )

<span class="kw">pandoc.table</span>(doc_ay_table, <span class="dt">caption =</span> <span class="st">&quot;Docility repeatability across years&quot;</span>)</code></pre>
<table>
<caption>Docility repeatability across years</caption>
<col width="20%" />
<col width="16%" />
<col width="20%" />
<thead>
<tr class="header">
<th align="center">Parameter</th>
<th align="center">Post Mode</th>
<th align="center">Cred Int.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">ID Variance</td>
<td align="center">16.08</td>
<td align="center">(11.53 – 20.50)</td>
</tr>
<tr class="even">
<td align="center">Phen. Variance</td>
<td align="center">50.85</td>
<td align="center">(47.09 – 55.16)</td>
</tr>
<tr class="odd">
<td align="center">Repeatability</td>
<td align="center">0.32</td>
<td align="center">(0.24 – 0.37)</td>
</tr>
</tbody>
</table>
<p>Ok, the repeatability across years is a little lower than when within year repeated measures are inlcuded. Might be interesing to see what repeatability is within years only.</p>
<h3 id="docility-repeatabiltiy-within-years">Docility Repeatabiltiy Within Years</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Now pick 1 year for each squirrel, prioritizing years with most measures</span>
pick_year &lt;-<span class="st"> </span>function(x){
  if(<span class="kw">length</span>(<span class="kw">unique</span>(x$Year)) &gt;<span class="st"> </span><span class="dv">1</span>) {
    table_years &lt;-<span class="st"> </span><span class="kw">table</span>(x$Year)
    max_years &lt;-<span class="st"> </span><span class="kw">which</span>(table_years ==<span class="st"> </span><span class="kw">max</span>(table_years))
    year &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">sample</span>(<span class="kw">names</span>(max_years), <span class="dv">1</span>))
    x[x$Year ==<span class="st"> </span>year, ]
    }else{x}
}

doc_data_within &lt;-<span class="st"> </span>doc_data %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(ID) %&gt;%
<span class="st">  </span><span class="kw">do</span>(<span class="kw">pick_year</span>(.))

<span class="co"># Run model again</span>
prior &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">G =</span> <span class="kw">list</span>(<span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(doc_data_within$doc, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>)), 
  <span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(doc_data_within$doc, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>))</code></pre>
<pre><code>## Warning: Name partially matched in data frame
## Warning: Name partially matched in data frame</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">time_start &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
doc_mcmc_model_within &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(docil ~<span class="st"> </span>julian +<span class="st"> </span>Obs +<span class="st"> </span>handlevent_year +<span class="st"> </span>
<span class="st">                                   </span><span class="kw">I</span>(handlevent_year^<span class="dv">2</span>),
                          <span class="dt">random =</span> ~<span class="st"> </span>ID,
                          <span class="dt">prior =</span> prior,
                          <span class="dt">pr =</span> <span class="ot">TRUE</span>,
                          <span class="dt">data =</span> <span class="kw">ungroup</span>(doc_data_within),
                          <span class="dt">thin =</span> thin,
                          <span class="dt">burnin =</span> burnin,
                          <span class="dt">nitt =</span> nitt,
                          <span class="dt">verbose =</span> <span class="ot">FALSE</span>
                          )
<span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Approx. model run time: &quot;</span>, <span class="kw">format</span>(<span class="kw">Sys.time</span>() -<span class="st"> </span>time_start)))</code></pre>
<pre><code>## [1] &quot;Approx. model run time:  22.08 mins&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(doc_mcmc_model_within,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/doc_mcmc_model_within.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/doc_mcmc_model_within.RData&quot;</span>)

doc_I_var_within &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(doc_mcmc_model_within$VCV[ ,<span class="st">&quot;ID&quot;</span>])
doc_P_var_within &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(<span class="kw">mcmc</span>(<span class="kw">rowSums</span>(doc_mcmc_model_within$VCV)))
doc_rep_within   &lt;-<span class="st"> </span>doc_I_var_within /<span class="st"> </span>doc_P_var_within

dIv_w &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(doc_I_var_within)
dPv_w &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(doc_P_var_within)
dRv_w &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(doc_rep_within)

doc_wy_table &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">check.names =</span> <span class="ot">FALSE</span>,
  <span class="dt">Parameter =</span> <span class="kw">c</span>(<span class="st">&quot;ID Variance&quot;</span>, <span class="st">&quot;Phen. Variance&quot;</span>, <span class="st">&quot;Repeatability&quot;</span>),
  <span class="st">&quot;Post Mode&quot;</span> =<span class="st"> </span><span class="kw">c</span>(dIv_w[<span class="dv">1</span>], dPv_w[<span class="dv">1</span>], dRv_w[<span class="dv">1</span>]),
  <span class="st">&quot;Cred Int.&quot;</span> =<span class="st"> </span><span class="kw">c</span>(dIv_w[<span class="dv">2</span>], dPv_w[<span class="dv">2</span>], dRv_w[<span class="dv">2</span>])
  )

<span class="kw">pandoc.table</span>(doc_wy_table, <span class="dt">caption =</span> <span class="st">&quot;Docility repeatability within years&quot;</span>, 
  <span class="dt">justify =</span> <span class="st">&#39;right&#39;</span>)</code></pre>
<table>
<caption>Docility repeatability within years</caption>
<col width="20%" />
<col width="16%" />
<col width="20%" />
<thead>
<tr class="header">
<th align="right">Parameter</th>
<th align="right">Post Mode</th>
<th align="right">Cred Int.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">ID Variance</td>
<td align="right">21.20</td>
<td align="right">(17.70 – 23.61)</td>
</tr>
<tr class="even">
<td align="right">Phen. Variance</td>
<td align="right">52.45</td>
<td align="right">(49.50 – 55.89)</td>
</tr>
<tr class="odd">
<td align="right">Repeatability</td>
<td align="right">0.40</td>
<td align="right">(0.36 – 0.42)</td>
</tr>
</tbody>
</table>
<h2 id="aggression">Aggression</h2>
<p>Aggression is the first principal component of the mirror image stimluation test.</p>
<pre class="sourceCode r"><code class="sourceCode r">prior &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">G =</span> <span class="kw">list</span>(<span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(agg_data$misPC1, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>)),
  <span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(agg_data$misPC1, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>))

time_start &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
agg_mcmc_model &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(misPC1 ~<span class="st"> </span>julian +<span class="st"> </span>trial_life +<span class="st"> </span><span class="kw">I</span>(trial_life^<span class="dv">2</span>),
                    <span class="dt">random =</span> ~<span class="st"> </span>ID,
                    <span class="dt">prior =</span> prior,
                    <span class="dt">pr =</span> <span class="ot">TRUE</span>,
                    <span class="dt">data =</span> <span class="kw">ungroup</span>(agg_data),
                    <span class="dt">thin =</span> thin,
                    <span class="dt">burnin =</span> burnin,
                    <span class="dt">nitt =</span> nitt,
                    <span class="dt">verbose =</span> <span class="ot">FALSE</span>
                    )
<span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Approx. model run time: &quot;</span>, <span class="kw">format</span>(<span class="kw">Sys.time</span>() -<span class="st"> </span>time_start)))</code></pre>
<pre><code>## [1] &quot;Approx. model run time:  4.033 mins&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">summary</span>(agg_mcmc_model))</code></pre>
<pre><code>## 
##  Iterations = 50001:549501
##  Thinning interval  = 500
##  Sample size  = 1000 
## 
##  DIC: 2053 
## 
##  G-structure:  ~ID
## 
##    post.mean l-95% CI u-95% CI eff.samp
## ID      1.01    0.588     1.46     1000
## 
##  R-structure:  ~units
## 
##       post.mean l-95% CI u-95% CI eff.samp
## units      1.79     1.43     2.13     1000
## 
##  Location effects: misPC1 ~ julian + trial_life + I(trial_life^2) 
## 
##                 post.mean l-95% CI u-95% CI eff.samp  pMCMC    
## (Intercept)       1.03670  0.26825  1.83944     1000  0.018 *  
## julian           -0.00736 -0.01143 -0.00367     1000 &lt;0.001 ***
## trial_life        0.35863 -0.43893  1.10061      785  0.358    
## I(trial_life^2)  -0.07384 -0.28611  0.11870      762  0.488    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(agg_mcmc_model, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/agg_mcmc_model.RData&quot;</span>)</code></pre>
<h3 id="aggression-repeatability">Aggression Repeatability</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/agg_mcmc_model.RData&quot;</span>)
agg_I_var &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(agg_mcmc_model$VCV[ ,<span class="st">&quot;ID&quot;</span>])
agg_P_var &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(<span class="kw">mcmc</span>(<span class="kw">rowSums</span>(agg_mcmc_model$VCV)))
agg_rep &lt;-<span class="st"> </span>agg_I_var /<span class="st"> </span>agg_P_var

agIv &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(agg_I_var)
agPv &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(agg_P_var)
agRv &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(agg_rep)

agg_table &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">Parameter =</span> <span class="kw">c</span>(<span class="st">&quot;ID Variance&quot;</span>, <span class="st">&quot;Phen. Variance&quot;</span>, <span class="st">&quot;Repeatability&quot;</span>),
  <span class="st">&quot;Post Mode&quot;</span> =<span class="st"> </span><span class="kw">c</span>(agIv[<span class="dv">1</span>], agPv[<span class="dv">1</span>], agRv[<span class="dv">1</span>]),
  <span class="st">&quot;Cred Int.&quot;</span> =<span class="st"> </span><span class="kw">c</span>(agIv[<span class="dv">2</span>], agPv[<span class="dv">2</span>], agRv[<span class="dv">2</span>])
  )

<span class="kw">pandoc.table</span>(agg_table, <span class="dt">caption =</span> <span class="st">&quot;Aggression repeatability using all trials&quot;</span>, 
  <span class="dt">justify =</span> <span class="st">&#39;right&#39;</span>)</code></pre>
<table>
<caption>Aggression repeatability using all trials</caption>
<col width="20%" />
<col width="16%" />
<col width="18%" />
<thead>
<tr class="header">
<th align="right">Parameter</th>
<th align="right">Post.Mode</th>
<th align="right">Cred.Int.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">ID Variance</td>
<td align="right">1.04</td>
<td align="right">(0.59 – 1.46)</td>
</tr>
<tr class="even">
<td align="right">Phen. Variance</td>
<td align="right">2.66</td>
<td align="right">(2.48 – 3.18)</td>
</tr>
<tr class="odd">
<td align="right">Repeatability</td>
<td align="right">0.39</td>
<td align="right">(0.24 – 0.46)</td>
</tr>
</tbody>
</table>
<h3 id="aggression-repeatability-across-years">Aggression Repeatability Across Years</h3>
<pre class="sourceCode r"><code class="sourceCode r">agg_data_across &lt;-<span class="st"> </span>agg_data %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(ID, Year) %&gt;%
<span class="st">  </span>dplyr:::<span class="kw">sample_n.grouped_df</span>(<span class="dv">1</span>)

prior &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">G =</span> <span class="kw">list</span>(
    <span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(agg_data_across$misPC1, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>)),
  <span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(agg_data_across$misPC1, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>))

time_start &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
agg_mcmc_model_across &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(misPC1 ~<span class="st"> </span>julian +<span class="st"> </span>trial_life +
<span class="st">                                   </span><span class="kw">I</span>(trial_life^<span class="dv">2</span>),
                           <span class="dt">random =</span> ~<span class="st"> </span>ID,
                           <span class="dt">prior =</span> prior,
                           <span class="dt">pr =</span> <span class="ot">TRUE</span>,
                           <span class="dt">data =</span> <span class="kw">ungroup</span>(agg_data_across),
                           <span class="dt">thin =</span> thin,
                           <span class="dt">burnin =</span> burnin,
                           <span class="dt">nitt =</span> nitt,
                           <span class="dt">verbose =</span> <span class="ot">FALSE</span>
                           )
<span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Approx. model run time: &quot;</span>, <span class="kw">format</span>(<span class="kw">Sys.time</span>() -<span class="st"> </span>time_start)))</code></pre>
<pre><code>## [1] &quot;Approx. model run time:  3.654 mins&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(agg_mcmc_model_across,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/agg_mcmc_model_across.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/agg_mcmc_model_across.RData&quot;</span>)

agg_I_var_across &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(agg_mcmc_model_across$VCV[ ,<span class="st">&quot;ID&quot;</span>])
agg_P_var_across &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(<span class="kw">mcmc</span>(<span class="kw">rowSums</span>(agg_mcmc_model_across$VCV)))
agg_rep_across   &lt;-<span class="st"> </span>agg_I_var_across /<span class="st"> </span>agg_P_var_across

agIv_a &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(agg_I_var_across)
agPv_a &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(agg_P_var_across)
agRv_a &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(agg_rep_across)

agg_ay_table &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">Parameter =</span> <span class="kw">c</span>(<span class="st">&quot;ID Variance&quot;</span>, <span class="st">&quot;Phen. Variance&quot;</span>, <span class="st">&quot;Repeatability&quot;</span>),
  <span class="st">&quot;Post Mode&quot;</span> =<span class="st"> </span><span class="kw">c</span>(agIv_a[<span class="dv">1</span>], agPv_a[<span class="dv">1</span>], agRv_a[<span class="dv">1</span>]),
  <span class="st">&quot;Cred Int.&quot;</span> =<span class="st"> </span><span class="kw">c</span>(agIv_a[<span class="dv">2</span>], agPv_a[<span class="dv">2</span>], agRv_a[<span class="dv">2</span>])
  )

<span class="kw">pandoc.table</span>(agg_ay_table, <span class="dt">caption =</span> <span class="st">&quot;Aggression repeatability across years&quot;</span>, 
  <span class="dt">justify =</span> <span class="st">&#39;right&#39;</span>)</code></pre>
<table>
<caption>Aggression repeatability across years</caption>
<col width="20%" />
<col width="16%" />
<col width="18%" />
<thead>
<tr class="header">
<th align="right">Parameter</th>
<th align="right">Post.Mode</th>
<th align="right">Cred.Int.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">ID Variance</td>
<td align="right">0.68</td>
<td align="right">(0.41 – 1.40)</td>
</tr>
<tr class="even">
<td align="right">Phen. Variance</td>
<td align="right">2.92</td>
<td align="right">(2.54 – 3.30)</td>
</tr>
<tr class="odd">
<td align="right">Repeatability</td>
<td align="right">0.23</td>
<td align="right">(0.16 – 0.42)</td>
</tr>
</tbody>
</table>
<h3 id="aggression-repeatabiltiy-within-years">Aggression Repeatabiltiy Within Years</h3>
<pre class="sourceCode r"><code class="sourceCode r">agg_data_within &lt;-<span class="st"> </span>agg_data %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(ID) %&gt;%
<span class="st">  </span><span class="kw">do</span>(<span class="kw">pick_year</span>(.))

prior &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">G =</span> <span class="kw">list</span>(
    <span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(agg_data_within$misPC1, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>)),
  <span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(agg_data_within$misPC1, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>)
  )

time_start &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
agg_mcmc_model_within &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(misPC1 ~<span class="st"> </span>julian +<span class="st"> </span>trial_life +
<span class="st">                                    </span><span class="kw">I</span>(trial_life^<span class="dv">2</span>),
                           <span class="dt">random =</span> ~<span class="st"> </span>ID,
                           <span class="dt">prior =</span> prior,
                           <span class="dt">pr =</span> <span class="ot">TRUE</span>,
                           <span class="dt">data =</span> <span class="kw">ungroup</span>(agg_data_within),
                           <span class="dt">thin =</span> thin,
                           <span class="dt">burnin =</span> burnin,
                           <span class="dt">nitt =</span> nitt,
                           <span class="dt">verbose =</span> <span class="ot">FALSE</span>
                           )
<span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Approx. model run time: &quot;</span>, <span class="kw">format</span>(<span class="kw">Sys.time</span>() -<span class="st"> </span>time_start)))</code></pre>
<pre><code>## [1] &quot;Approx. model run time:  3.663 mins&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(agg_mcmc_model_within,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/agg_mcmc_model_within.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/agg_mcmc_model_within.RData&quot;</span>)

agg_I_var_within &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(agg_mcmc_model_within$VCV[ ,<span class="st">&quot;ID&quot;</span>])
agg_P_var_within &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(<span class="kw">mcmc</span>(<span class="kw">rowSums</span>(agg_mcmc_model_within$VCV)))
agg_rep_within   &lt;-<span class="st"> </span>agg_I_var_within /<span class="st"> </span>agg_P_var_within

agIv_w &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(agg_I_var_within)
agPv_w &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(agg_P_var_within)
agRv_w &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(agg_rep_within)

agg_wy_table &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">Parameter =</span> <span class="kw">c</span>(<span class="st">&quot;ID Variance&quot;</span>, <span class="st">&quot;Phen. Variance&quot;</span>, <span class="st">&quot;Repeatability&quot;</span>),
  <span class="st">&quot;Post Mode&quot;</span> =<span class="st"> </span><span class="kw">c</span>(agIv_w[<span class="dv">1</span>], agPv_w[<span class="dv">1</span>], agRv_w[<span class="dv">1</span>]),
  <span class="st">&quot;Cred Int.&quot;</span> =<span class="st"> </span><span class="kw">c</span>(agIv_w[<span class="dv">2</span>], agPv_w[<span class="dv">2</span>], agRv_w[<span class="dv">2</span>])
  )

<span class="kw">pandoc.table</span>(agg_wy_table, <span class="dt">caption =</span> <span class="st">&quot;Aggression repeatability within years&quot;</span>)</code></pre>
<table>
<caption>Aggression repeatability within years</caption>
<col width="20%" />
<col width="16%" />
<col width="18%" />
<thead>
<tr class="header">
<th align="center">Parameter</th>
<th align="center">Post.Mode</th>
<th align="center">Cred.Int.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">ID Variance</td>
<td align="center">1.39</td>
<td align="center">(0.91 – 1.85)</td>
</tr>
<tr class="even">
<td align="center">Phen. Variance</td>
<td align="center">2.78</td>
<td align="center">(2.44 – 3.18)</td>
</tr>
<tr class="odd">
<td align="center">Repeatability</td>
<td align="center">0.50</td>
<td align="center">(0.37 – 0.58)</td>
</tr>
</tbody>
</table>
<h2 id="activity">Activity</h2>
<p>Activity is the first principal component of the open field test.</p>
<pre class="sourceCode r"><code class="sourceCode r">prior &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">G =</span> <span class="kw">list</span>(<span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(act_data$ofPC1, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>)),
  <span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(act_data$ofPC1, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>)
  )

time_start &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
act_mcmc_model &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(ofPC1 ~<span class="st"> </span>julian +<span class="st"> </span>trial_life +<span class="st"> </span><span class="kw">I</span>(trial_life^<span class="dv">2</span>),
                    <span class="dt">random =</span> ~<span class="st"> </span>ID,
                    <span class="dt">prior =</span> prior,
                    <span class="dt">pr =</span> <span class="ot">TRUE</span>,
                    <span class="dt">data =</span> <span class="kw">ungroup</span>(act_data),
                    <span class="dt">thin =</span> thin,
                    <span class="dt">burnin =</span> burnin,
                    <span class="dt">nitt =</span> nitt,
                    <span class="dt">verbose =</span> <span class="ot">FALSE</span>
                    )
<span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Approx. model run time: &quot;</span>, <span class="kw">format</span>(<span class="kw">Sys.time</span>() -<span class="st"> </span>time_start)))</code></pre>
<pre><code>## [1] &quot;Approx. model run time:  3.956 mins&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">summary</span>(act_mcmc_model))</code></pre>
<pre><code>## 
##  Iterations = 50001:549501
##  Thinning interval  = 500
##  Sample size  = 1000 
## 
##  DIC: 1965 
## 
##  G-structure:  ~ID
## 
##    post.mean l-95% CI u-95% CI eff.samp
## ID      1.14     0.81      1.5     1000
## 
##  R-structure:  ~units
## 
##       post.mean l-95% CI u-95% CI eff.samp
## units      1.42     1.15      1.7     1000
## 
##  Location effects: ofPC1 ~ julian + trial_life + I(trial_life^2) 
## 
##                 post.mean  l-95% CI  u-95% CI eff.samp  pMCMC    
## (Intercept)      1.681676  0.992768  2.483235     1000 &lt;0.001 ***
## julian           0.000679 -0.002925  0.004063     1000  0.682    
## trial_life      -1.703131 -2.366306 -0.988700     1000 &lt;0.001 ***
## I(trial_life^2)  0.264116  0.063945  0.428435     1000  0.006 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(act_mcmc_model, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/act_mcmc_model.RData&quot;</span>)</code></pre>
<h3 id="activity-repeatability">Activity Repeatability</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/act_mcmc_model.RData&quot;</span>)
act_I_var &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(act_mcmc_model$VCV[ ,<span class="st">&quot;ID&quot;</span>])
act_P_var &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(<span class="kw">mcmc</span>(<span class="kw">rowSums</span>(act_mcmc_model$VCV)))
act_rep &lt;-<span class="st"> </span>act_I_var /<span class="st"> </span>act_P_var

acIv &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(act_I_var)
acPv &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(act_P_var)
acRv &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(act_rep)

act_table &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">Parameter =</span> <span class="kw">c</span>(<span class="st">&quot;ID Variance&quot;</span>, <span class="st">&quot;Phen. Variance&quot;</span>, <span class="st">&quot;Repeatability&quot;</span>),
  <span class="st">&quot;Post Mode&quot;</span> =<span class="st"> </span><span class="kw">c</span>(acIv[<span class="dv">1</span>], acPv[<span class="dv">1</span>], acRv[<span class="dv">1</span>]),
  <span class="st">&quot;Cred Int.&quot;</span> =<span class="st"> </span><span class="kw">c</span>(acIv[<span class="dv">2</span>], acPv[<span class="dv">2</span>], acRv[<span class="dv">2</span>])
  )

<span class="kw">pandoc.table</span>(act_table, <span class="dt">caption =</span> <span class="st">&quot;Activity repeatability using all trials&quot;</span>)</code></pre>
<table>
<caption>Activity repeatability using all trials</caption>
<col width="20%" />
<col width="16%" />
<col width="18%" />
<thead>
<tr class="header">
<th align="center">Parameter</th>
<th align="center">Post.Mode</th>
<th align="center">Cred.Int.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">ID Variance</td>
<td align="center">1.20</td>
<td align="center">(0.81 – 1.50)</td>
</tr>
<tr class="even">
<td align="center">Phen. Variance</td>
<td align="center">2.52</td>
<td align="center">(2.29 – 2.90)</td>
</tr>
<tr class="odd">
<td align="center">Repeatability</td>
<td align="center">0.48</td>
<td align="center">(0.35 – 0.52)</td>
</tr>
</tbody>
</table>
<h3 id="activity-repeatability-across-years">Activity Repeatability Across Years</h3>
<pre class="sourceCode r"><code class="sourceCode r">act_data_across &lt;-<span class="st"> </span>act_data %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(ID, Year) %&gt;%
<span class="st">  </span>dplyr:::<span class="kw">sample_n.grouped_df</span>(<span class="dv">1</span>)

prior &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">G =</span> <span class="kw">list</span>(<span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(act_data_across$ofPC1, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>)),
  <span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(act_data_across$ofPC1, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>))

time_start &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
act_mcmc_model_across &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(ofPC1 ~<span class="st"> </span>julian +<span class="st"> </span>trial_life +
<span class="st">                                   </span><span class="kw">I</span>(trial_life^<span class="dv">2</span>),
                           <span class="dt">random =</span> ~<span class="st"> </span>ID,
                           <span class="dt">prior =</span> prior,
                           <span class="dt">pr =</span> <span class="ot">TRUE</span>,
                           <span class="dt">data =</span> <span class="kw">ungroup</span>(act_data_across),
                           <span class="dt">thin =</span> thin,
                           <span class="dt">burnin =</span> burnin,
                           <span class="dt">nitt =</span> nitt,
                           <span class="dt">verbose =</span> <span class="ot">FALSE</span>
                           )
<span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Approx. model run time: &quot;</span>, <span class="kw">format</span>(<span class="kw">Sys.time</span>() -<span class="st"> </span>time_start)))</code></pre>
<pre><code>## [1] &quot;Approx. model run time:  3.431 mins&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(act_mcmc_model_across,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/act_mcmc_model_across.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/act_mcmc_model_across.RData&quot;</span>)

act_I_var_across &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(act_mcmc_model_across$VCV[ ,<span class="st">&quot;ID&quot;</span>])
act_P_var_across &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(<span class="kw">mcmc</span>(<span class="kw">rowSums</span>(act_mcmc_model_across$VCV)))
act_rep_across   &lt;-<span class="st"> </span>act_I_var_across /<span class="st"> </span>act_P_var_across

acIv_a &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(act_I_var_across)
acPv_a &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(act_P_var_across)
acRv_a &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(act_rep_across)

act_ay_table &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">Parameter =</span> <span class="kw">c</span>(<span class="st">&quot;ID Variance&quot;</span>, <span class="st">&quot;Phen. Variance&quot;</span>, <span class="st">&quot;Repeatability&quot;</span>),
  <span class="st">&quot;Post Mode&quot;</span> =<span class="st"> </span><span class="kw">c</span>(acIv_a[<span class="dv">1</span>], acPv_a[<span class="dv">1</span>], acRv_a[<span class="dv">1</span>]),
  <span class="st">&quot;Cred Int.&quot;</span> =<span class="st"> </span><span class="kw">c</span>(acIv_a[<span class="dv">2</span>], acPv_a[<span class="dv">2</span>], acRv_a[<span class="dv">2</span>])
  )

<span class="kw">pandoc.table</span>(act_ay_table, <span class="dt">caption =</span> <span class="st">&quot;Activity repeatability across years&quot;</span>)</code></pre>
<table>
<caption>Activity repeatability across years</caption>
<col width="20%" />
<col width="16%" />
<col width="18%" />
<thead>
<tr class="header">
<th align="center">Parameter</th>
<th align="center">Post.Mode</th>
<th align="center">Cred.Int.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">ID Variance</td>
<td align="center">0.89</td>
<td align="center">(0.43 – 1.34)</td>
</tr>
<tr class="even">
<td align="center">Phen. Variance</td>
<td align="center">2.70</td>
<td align="center">(2.27 – 2.96)</td>
</tr>
<tr class="odd">
<td align="center">Repeatability</td>
<td align="center">0.33</td>
<td align="center">(0.19 – 0.45)</td>
</tr>
</tbody>
</table>
<h3 id="activity-repeatabiltiy-within-years">Activity Repeatabiltiy Within Years</h3>
<pre class="sourceCode r"><code class="sourceCode r">act_data_within &lt;-<span class="st"> </span>act_data %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(ID) %&gt;%
<span class="st">  </span><span class="kw">do</span>(<span class="kw">pick_year</span>(.))

prior &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">G =</span> <span class="kw">list</span>(<span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(act_data_within$ofPC1, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>)), 
  <span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="kw">var</span>(act_data_within$ofPC1, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu =</span> <span class="fl">1.002</span>)
  )

time_start &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
act_mcmc_model_within &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(ofPC1 ~<span class="st"> </span>julian +<span class="st"> </span>trial_life +
<span class="st">                                   </span><span class="kw">I</span>(trial_life^<span class="dv">2</span>),
                           <span class="dt">random =</span> ~<span class="st"> </span>ID,
                           <span class="dt">prior =</span> prior,
                           <span class="dt">pr =</span> <span class="ot">TRUE</span>,
                           <span class="dt">data =</span> <span class="kw">ungroup</span>(act_data_within),
                           <span class="dt">thin =</span> thin,
                           <span class="dt">burnin =</span> burnin,
                           <span class="dt">nitt =</span> nitt,
                           <span class="dt">verbose =</span> <span class="ot">FALSE</span>
                           )
<span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Approx. model run time: &quot;</span>, <span class="kw">format</span>(<span class="kw">Sys.time</span>() -<span class="st"> </span>time_start)))</code></pre>
<pre><code>## [1] &quot;Approx. model run time:  3.567 mins&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(act_mcmc_model_within,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/act_mcmc_model_within.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/act_mcmc_model_within.RData&quot;</span>)

act_I_var_within &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(act_mcmc_model_within$VCV[ ,<span class="st">&quot;ID&quot;</span>])
act_P_var_within &lt;-<span class="st"> </span><span class="kw">PM_HPD</span>(<span class="kw">mcmc</span>(<span class="kw">rowSums</span>(act_mcmc_model_within$VCV)))
act_rep_within   &lt;-<span class="st"> </span>act_I_var_within /<span class="st"> </span>act_P_var_within

acIv_w &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(act_I_var_within)
acPv_w &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(act_P_var_within)
acRv_w &lt;-<span class="st"> </span><span class="kw">format_PM_HPD</span>(act_rep_within)

act_wy_table &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">Parameter =</span> <span class="kw">c</span>(<span class="st">&quot;ID Variance&quot;</span>, <span class="st">&quot;Phen. Variance&quot;</span>, <span class="st">&quot;Repeatability&quot;</span>),
  <span class="st">&quot;Post Mode&quot;</span> =<span class="st"> </span><span class="kw">c</span>(acIv_w[<span class="dv">1</span>], acPv_w[<span class="dv">1</span>], acRv_w[<span class="dv">1</span>]),
  <span class="st">&quot;Cred Int.&quot;</span> =<span class="st"> </span><span class="kw">c</span>(acIv_w[<span class="dv">2</span>], acPv_w[<span class="dv">2</span>], acRv_w[<span class="dv">2</span>])
  )

<span class="kw">pandoc.table</span>(act_wy_table, <span class="dt">caption =</span> <span class="st">&quot;Activity repeatability within years&quot;</span>)</code></pre>
<table>
<caption>Activity repeatability within years</caption>
<col width="20%" />
<col width="16%" />
<col width="18%" />
<thead>
<tr class="header">
<th align="center">Parameter</th>
<th align="center">Post.Mode</th>
<th align="center">Cred.Int.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">ID Variance</td>
<td align="center">1.33</td>
<td align="center">(0.97 – 1.81)</td>
</tr>
<tr class="even">
<td align="center">Phen. Variance</td>
<td align="center">2.45</td>
<td align="center">(2.25 – 2.95)</td>
</tr>
<tr class="odd">
<td align="center">Repeatability</td>
<td align="center">0.54</td>
<td align="center">(0.43 – 0.62)</td>
</tr>
</tbody>
</table>
<h2 id="repeatability-summary">Repeatability Summary</h2>
<pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span>function(x){<span class="kw">paste</span>(x[<span class="dv">1</span>], x[<span class="dv">2</span>])}
table_summary &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">Behaviour =</span> <span class="kw">c</span>(<span class="st">&quot;Aggression&quot;</span>, <span class="st">&quot;Activity&quot;</span>, <span class="st">&quot;Docility&quot;</span>),
  <span class="dt">All    =</span> <span class="kw">c</span>(<span class="kw">d</span>(agRv), <span class="kw">d</span>(acRv), <span class="kw">d</span>(dRv)),
  <span class="dt">Across =</span> <span class="kw">c</span>(<span class="kw">d</span>(agRv_a), <span class="kw">d</span>(acRv_a), <span class="kw">d</span>(dRv_a)),
  <span class="dt">Within =</span> <span class="kw">c</span>(<span class="kw">d</span>(agRv_w), <span class="kw">d</span>(acRv_w), <span class="kw">d</span>(dRv_w))
  )
<span class="kw">save</span>(table_summary, <span class="dt">file =</span> <span class="st">&quot;mcmc_repeatability_summary.RData&quot;</span>)
<span class="kw">pandoc.table</span>(table_summary, <span class="dt">caption =</span> <span class="st">&quot;Summary of repeatabilities&quot;</span>)</code></pre>
<table>
<caption>Summary of repeatabilities (continued below)</caption>
<col width="16%" />
<col width="26%" />
<col width="26%" />
<thead>
<tr class="header">
<th align="right">Behaviour</th>
<th align="right">All</th>
<th align="right">Across</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">Aggression</td>
<td align="right">0.39 (0.24 – 0.46)</td>
<td align="right">0.23 (0.16 – 0.42)</td>
</tr>
<tr class="even">
<td align="right">Activity</td>
<td align="right">0.48 (0.35 – 0.52)</td>
<td align="right">0.33 (0.19 – 0.45)</td>
</tr>
<tr class="odd">
<td align="right">Docility</td>
<td align="right">0.38 (0.33 – 0.40)</td>
<td align="right">0.32 (0.24 – 0.37)</td>
</tr>
</tbody>
</table>
<table>
<col width="25%" />
<thead>
<tr class="header">
<th align="right">Within</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.50 (0.37 – 0.58)</td>
</tr>
<tr class="even">
<td align="right">0.54 (0.43 – 0.62)</td>
</tr>
<tr class="odd">
<td align="right">0.40 (0.36 – 0.42)</td>
</tr>
</tbody>
</table>
<h2 id="run-lmer-models">Run lmer models</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lme4)</code></pre>
<pre><code>## Loading required package: Rcpp</code></pre>
<h3 id="docility-1">Docility</h3>
<pre class="sourceCode r"><code class="sourceCode r">doc_data &lt;-<span class="st"> </span>pca_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(docil))
doc_lmer_model &lt;-<span class="st"> </span><span class="kw">lmer</span>(docil ~<span class="st"> </span><span class="kw">as.factor</span>(Year) +<span class="st"> </span>julian +<span class="st"> </span>Obs +
<span class="st">  </span>handlevent_year +<span class="st"> </span><span class="kw">I</span>(handlevent_year^<span class="dv">2</span>) +<span class="st"> </span>(<span class="dv">1</span> |<span class="st"> </span>ID), <span class="dt">data =</span> doc_data)
<span class="kw">save</span>(doc_lmer_model, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/doc_lmer_model.RData&quot;</span>)</code></pre>
<h3 id="aggression-1">Aggression</h3>
<pre class="sourceCode r"><code class="sourceCode r">agg_data &lt;-<span class="st"> </span>pca_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(misPC1))
agg_lmer_model &lt;-<span class="st"> </span><span class="kw">lmer</span>(misPC1 ~<span class="st">  </span><span class="kw">as.factor</span>(Year) +<span class="st"> </span>julian +<span class="st"> </span>trial_life +
<span class="st">  </span><span class="kw">I</span>(trial_life^<span class="dv">2</span>) +<span class="st"> </span>(<span class="dv">1</span> |<span class="st"> </span>ID), <span class="dt">data =</span> agg_data)
<span class="kw">save</span>(agg_lmer_model, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/agg_lmer_model.RData&quot;</span>)</code></pre>
<h3 id="activity-1">Activity</h3>
<pre class="sourceCode r"><code class="sourceCode r">act_data &lt;-<span class="st"> </span>pca_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(ofPC1))
act_lmer_model &lt;-<span class="st"> </span><span class="kw">lmer</span>(ofPC1 ~<span class="st">  </span><span class="kw">as.factor</span>(Year) +<span class="st"> </span>julian +<span class="st"> </span>trial_life +
<span class="st">  </span><span class="kw">I</span>(trial_life^<span class="dv">2</span>) +<span class="st"> </span>(<span class="dv">1</span> |<span class="st"> </span>ID), <span class="dt">data =</span> act_data)
<span class="kw">save</span>(act_lmer_model, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/act_lmer_model.RData&quot;</span>)</code></pre>
<h2 id="extract-random-effects-blups">Extract random effects / BLUPs</h2>
<h3 id="from-mcmcglmm-models">from MCMCglmm models</h3>
<pre class="sourceCode r"><code class="sourceCode r">extractMCMCglmmRanEffs &lt;-<span class="st"> </span>function(x, trait_name){
  <span class="kw">library</span>(dplyr)
  <span class="kw">library</span>(MCMCglmm)  
  <span class="co"># Now get the posterior distribution, so we can pass variance in behavioral </span>
  <span class="co"># estimate on to further analyses. 1000 sets of random effects saved.</span>
  sols &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x$Sol) ## Get random effects
  sols &lt;-<span class="st"> </span>sols[ ,<span class="kw">grep</span>(<span class="st">&quot;ID&quot;</span>, <span class="kw">names</span>(sols))] ## Get all the ID columns
  sols &lt;-<span class="st"> </span><span class="kw">stack</span>(sols)
  <span class="kw">names</span>(sols) &lt;-<span class="st"> </span><span class="kw">c</span>(trait_name, <span class="st">&quot;ID&quot;</span>)
  sols$itt &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="dv">1000</span> <span class="co"># Just an index for each set of random effects (e.g. each </span>
                     <span class="co"># MCMC sample)</span>
  sols$ID &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;ID</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="st">&quot;&quot;</span>, sols$ID)
  sols$type &lt;-<span class="st"> &quot;raneff&quot;</span>
  <span class="kw">tbl_df</span>(sols)
}

<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/doc_mcmc_model.RData&quot;</span>)
doc_mcmc_raneffs &lt;-<span class="st"> </span><span class="kw">extractMCMCglmmRanEffs</span>(doc_mcmc_model,
  <span class="dt">trait_name =</span> <span class="st">&quot;docility&quot;</span>)

<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/agg_mcmc_model.RData&quot;</span>)
agg_mcmc_raneffs &lt;-<span class="st"> </span><span class="kw">extractMCMCglmmRanEffs</span>(agg_mcmc_model,
  <span class="dt">trait_name =</span> <span class="st">&quot;aggression&quot;</span>)

<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/act_mcmc_model.RData&quot;</span>)
act_mcmc_raneffs &lt;-<span class="st"> </span><span class="kw">extractMCMCglmmRanEffs</span>(act_mcmc_model,
  <span class="dt">trait_name =</span> <span class="st">&quot;activity&quot;</span>)

<span class="co"># No dplyr outer join?</span>
mcmc_raneffs &lt;-<span class="st"> </span><span class="kw">merge</span>(doc_mcmc_raneffs, agg_mcmc_raneffs,
  <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;itt&quot;</span>, <span class="st">&quot;type&quot;</span>), <span class="dt">all =</span> <span class="ot">TRUE</span>)
mcmc_raneffs &lt;-<span class="st"> </span><span class="kw">merge</span>(mcmc_raneffs, act_mcmc_raneffs,
  <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;itt&quot;</span>, <span class="st">&quot;type&quot;</span>), <span class="dt">all =</span> <span class="ot">TRUE</span>)

mcmc_raneffs &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(mcmc_raneffs)

<span class="kw">save</span>(mcmc_raneffs, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/MCMCraneffs.RData&quot;</span>)</code></pre>
<h3 id="from-lmer-models">from lmer models</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/doc_lmer_model.RData&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/agg_lmer_model.RData&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/act_lmer_model.RData&quot;</span>)

extractLmerBLUPs &lt;-<span class="st"> </span>function(x, value){
  <span class="kw">require</span>(dplyr)
  <span class="kw">require</span>(lme4)
  blups &lt;-<span class="st"> </span><span class="kw">ranef</span>(x)$ID
  blups$ID &lt;-<span class="st"> </span><span class="kw">rownames</span>(blups)
  <span class="kw">names</span>(blups) &lt;-<span class="st"> </span><span class="kw">c</span>(value, <span class="st">&quot;ID&quot;</span>)
  blups$itt &lt;-<span class="st"> </span><span class="dv">0</span>  ## NOTE itt == 0 is BLUPs
  blups$type &lt;-<span class="st"> &quot;blup&quot;</span>
  <span class="kw">tbl_df</span>(blups)
}

doc_lmer_model.blups &lt;-<span class="st"> </span><span class="kw">extractLmerBLUPs</span>(doc_lmer_model, <span class="st">&quot;docility&quot;</span>)
agg_lmer_model.blups &lt;-<span class="st"> </span><span class="kw">extractLmerBLUPs</span>(agg_lmer_model, <span class="st">&quot;aggression&quot;</span>)
act_lmer_model.blups &lt;-<span class="st"> </span><span class="kw">extractLmerBLUPs</span>(act_lmer_model, <span class="st">&quot;activity&quot;</span>)

<span class="co"># No outer join for dplyr?</span>
lmer_blups &lt;-<span class="st"> </span><span class="kw">merge</span>(doc_lmer_model.blups, agg_lmer_model.blups, <span class="dt">all =</span> <span class="ot">TRUE</span>)
lmer_blups &lt;-<span class="st"> </span><span class="kw">merge</span>(lmer_blups, act_lmer_model.blups, <span class="dt">all =</span> <span class="ot">TRUE</span>)
lmer_blups &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(lmer_blups)
<span class="kw">save</span>(lmer_blups, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/lmer_blups.RData&quot;</span>)</code></pre>
<h3 id="rbind-mcmc-raneffs-and-blups">rbind MCMC raneffs and BLUPs</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/MCMCraneffs.RData&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/doc_lmer_model.RData&quot;</span>)
raneffs_blups &lt;-<span class="st"> </span><span class="kw">rbind</span>(mcmc_raneffs, lmer_blups)

<span class="kw">save</span>(raneffs_blups, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/raneffs_blups.RData&quot;</span>)</code></pre>
<h3 id="rescale-docility-raneffs-blups">Rescale docility raneffs &amp; BLUPs</h3>
<p>The docility BLUPs can be rescaled to the raw docility measurement. Aggression and activity are based on PCA scores and so are unit/scaleless so no need to rescale.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/raneffs_blups.RData&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/doc_mcmc_model.RData&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/doc_lmer_model.RData&quot;</span>)
<span class="co"># The intercepts are nearly indentical, as expected, but we&#39;ll keep them </span>
<span class="co"># separate for consistency</span>
lmer_model_intercept &lt;-<span class="st"> </span><span class="kw">summary</span>(doc_lmer_model)$coefficients[<span class="st">&quot;(Intercept)&quot;</span>,
                                <span class="st">&quot;Estimate&quot;</span>]
mcmc_model_intercept &lt;-<span class="st">  </span><span class="kw">summary</span>(doc_mcmc_model)$solutions[<span class="st">&quot;(Intercept)&quot;</span>,
                                <span class="st">&quot;post.mean&quot;</span>]

raneffs_blups$docility[raneffs_blups$type ==<span class="st"> &quot;raneff&quot;</span>] &lt;-<span class="st"> </span>
<span class="st">  </span>raneffs_blups$docility[raneffs_blups$type ==<span class="st"> &quot;raneff&quot;</span>] +<span class="st"> </span>mcmc_model_intercept

raneffs_blups$docility[raneffs_blups$type ==<span class="st"> &quot;blup&quot;</span>] &lt;-<span class="st"> </span>
<span class="st">  </span>raneffs_blups$docility[raneffs_blups$type ==<span class="st"> &quot;blup&quot;</span>] +<span class="st"> </span>lmer_model_intercept

<span class="kw">save</span>(raneffs_blups, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/raneffs_blups.RData&quot;</span>)</code></pre>
<h2 id="model-diagnostics">Model Diagnostics</h2>
<h3 id="docility-2">Docility</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/doc_mcmc_model.RData&quot;</span>)
<span class="kw">autocorr.diag</span>(doc_mcmc_model$VCV)</code></pre>
<pre><code>##                 ID     units
## Lag 0     1.000000  1.000000
## Lag 500   0.002313 -0.036398
## Lag 2500  0.017386  0.008852
## Lag 5000  0.035184  0.006301
## Lag 25000 0.008448  0.007935</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">geweke.diag</span>(doc_mcmc_model$VCV)</code></pre>
<pre><code>## 
## Fraction in 1st window = 0.1
## Fraction in 2nd window = 0.5 
## 
##     ID  units 
## 0.4782 0.5114</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">heidel.diag</span>(doc_mcmc_model$VCV)</code></pre>
<pre><code>##                                     
##       Stationarity start     p-value
##       test         iteration        
## ID    passed       1         0.521  
## units passed       1         0.706  
##                               
##       Halfwidth Mean Halfwidth
##       test                    
## ID    passed    19.3 0.0897   
## units passed    33.5 0.0506</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(doc_mcmc_model$VCV)</code></pre>
<div class="figure">
<img src="figure/02_docility_diagnostics.png" />
</div>
<h3 id="aggression-2">Aggression</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/agg_mcmc_model.RData&quot;</span>)
<span class="kw">autocorr.diag</span>(agg_mcmc_model$VCV)</code></pre>
<pre><code>##                   ID     units
## Lag 0      1.0000000  1.000000
## Lag 500    0.0192333 -0.004458
## Lag 2500   0.0228034  0.020507
## Lag 5000  -0.0009168 -0.036696
## Lag 25000  0.0020479 -0.024898</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">geweke.diag</span>(agg_mcmc_model$VCV)</code></pre>
<pre><code>## 
## Fraction in 1st window = 0.1
## Fraction in 2nd window = 0.5 
## 
##     ID  units 
##  2.604 -2.004</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">heidel.diag</span>(agg_mcmc_model$VCV)</code></pre>
<pre><code>##                                     
##       Stationarity start     p-value
##       test         iteration        
## ID    passed       1         0.467  
## units passed       1         0.938  
##                               
##       Halfwidth Mean Halfwidth
##       test                    
## ID    passed    1.01 0.0139   
## units passed    1.79 0.0116</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(agg_mcmc_model$VCV)</code></pre>
<div class="figure">
<img src="figure/02_aggression_diagnostics.png" />
</div>
<h3 id="activity-2">Activity</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/act_mcmc_model.RData&quot;</span>)
<span class="kw">autocorr.diag</span>(act_mcmc_model$VCV)</code></pre>
<pre><code>##                 ID     units
## Lag 0      1.00000  1.000000
## Lag 500   -0.01143 -0.001613
## Lag 2500  -0.02268 -0.003608
## Lag 5000   0.03577 -0.017001
## Lag 25000  0.01260  0.003523</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">geweke.diag</span>(act_mcmc_model$VCV)</code></pre>
<pre><code>## 
## Fraction in 1st window = 0.1
## Fraction in 2nd window = 0.5 
## 
##     ID  units 
## 0.5648 0.3727</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">heidel.diag</span>(act_mcmc_model$VCV)</code></pre>
<pre><code>##                                     
##       Stationarity start     p-value
##       test         iteration        
## ID    passed       1         0.849  
## units passed       1         0.683  
##                               
##       Halfwidth Mean Halfwidth
##       test                    
## ID    passed    1.14 0.01120  
## units passed    1.42 0.00879</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(act_mcmc_model$VCV)</code></pre>
<div class="figure">
<img src="figure/02_activity_diagnostics.png" />
</div>
<!--pandoc
t: html
default-image-extension: png
template: templates/html.template
toc-depth: 4
toc:

t: latex
s:
S:
latex-engine: xelatex
template: templates/latex.template
default-image-extension: pdf
toc-depth: 4
toc:
-->


<h1 id="assessing-the-effect-of-priors-on-blups">Assessing the effect of priors on BLUPs</h1>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/pca.RData&quot;</span>)
<span class="kw">library</span>(tidyr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(MCMCglmm)
<span class="kw">library</span>(pander)
<span class="kw">set.alignment</span>(<span class="st">&#39;right&#39;</span>, <span class="dt">row.names =</span> <span class="st">&#39;left&#39;</span>)

doc_data &lt;-<span class="st"> </span>pca_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(docil))
agg_data &lt;-<span class="st"> </span>pca_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(misPC1))
act_data &lt;-<span class="st"> </span>pca_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(ofPC1))</code></pre>
<h2 id="priors">Priors</h2>
<p>From a post to r-sig-me by Ned Dochterman</p>
<ol style="list-style-type: decimal">
<li>Parameter expanded</li>
<li>Another parameter expanded just to see if results vary across runs</li>
<li>Parameter expanded variance = docility variance</li>
<li>Parameter expanded really high variance</li>
<li>Inverse Wishart</li>
<li>Inverse Gamma</li>
<li>Flat, uniform, prior for just a variance</li>
<li>Flat improper prior, equivalent to REML fitting.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">priors &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="kw">list</span>(
    <span class="dt">G=</span><span class="kw">list</span>(<span class="dt">G1=</span><span class="kw">list</span>(<span class="dt">V=</span><span class="dv">1</span>, <span class="dt">nu=</span><span class="dv">1</span>, <span class="dt">alpha.mu =</span> <span class="dv">0</span>, <span class="dt">alpha.V =</span> <span class="dv">10000</span>)),
    <span class="dt">R=</span><span class="kw">list</span>(<span class="dt">V=</span><span class="dv">1</span>, <span class="dt">nu=</span><span class="dv">1</span>)
  ),
  <span class="kw">list</span>(
    <span class="dt">G=</span><span class="kw">list</span>(<span class="dt">G1=</span><span class="kw">list</span>(<span class="dt">V=</span><span class="dv">1</span>, <span class="dt">nu=</span><span class="dv">1</span>, <span class="dt">alpha.mu =</span> <span class="dv">0</span>, <span class="dt">alpha.V =</span> <span class="dv">10000</span>)),
    <span class="dt">R=</span><span class="kw">list</span>(<span class="dt">V=</span><span class="dv">1</span>, <span class="dt">nu=</span><span class="dv">1</span>)
  ),
  <span class="kw">list</span>(
    <span class="dt">G=</span><span class="kw">list</span>(
      <span class="dt">G1=</span><span class="kw">list</span>(
        <span class="dt">V=</span><span class="kw">var</span>(doc_data$docil, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu=</span><span class="dv">1</span>, <span class="dt">alpha.mu =</span> <span class="dv">0</span>,
          <span class="dt">alpha.V =</span> <span class="dv">10000</span>
      )
    ),
    <span class="dt">R=</span><span class="kw">list</span>(<span class="dt">V=</span><span class="kw">var</span>(doc_data$docil, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">nu=</span><span class="dv">1</span>)
  ),
  <span class="kw">list</span>(
    <span class="dt">G=</span><span class="kw">list</span>(<span class="dt">G1=</span><span class="kw">list</span>(<span class="dt">V=</span><span class="dv">1000</span>, <span class="dt">nu=</span><span class="dv">1</span>, <span class="dt">alpha.mu =</span> <span class="dv">0</span>, <span class="dt">alpha.V =</span> <span class="dv">1000</span>)),
    <span class="dt">R=</span><span class="kw">list</span>(<span class="dt">V=</span><span class="dv">1000</span>, <span class="dt">nu=</span><span class="dv">1</span>)
  ),
  <span class="kw">list</span>(<span class="dt">G=</span><span class="kw">list</span>(<span class="dt">G1=</span><span class="kw">list</span>(<span class="dt">V=</span><span class="dv">1</span>, <span class="dt">nu=</span><span class="dv">1</span>)), <span class="dt">R=</span><span class="kw">list</span>(<span class="dt">V=</span><span class="dv">1</span>, <span class="dt">nu=</span><span class="dv">1</span>)),
  <span class="kw">list</span>(<span class="dt">G=</span><span class="kw">list</span>(<span class="dt">G1=</span><span class="kw">list</span>(<span class="dt">V=</span><span class="dv">1</span>, <span class="dt">nu=</span><span class="fl">0.002</span>)), <span class="dt">R=</span><span class="kw">list</span>(<span class="dt">V=</span><span class="dv">1</span>, <span class="dt">nu=</span><span class="fl">0.002</span>)),
  <span class="kw">list</span>(<span class="dt">G=</span><span class="kw">list</span>(<span class="dt">G1=</span><span class="kw">list</span>(<span class="dt">V=</span><span class="fl">1e-16</span>, <span class="dt">nu=</span>-<span class="dv">2</span>)), <span class="dt">R=</span><span class="kw">list</span>(<span class="dt">V=</span><span class="fl">1e-16</span>, <span class="dt">nu=</span>-<span class="dv">2</span>))  ,
  <span class="kw">list</span>(<span class="dt">G=</span><span class="kw">list</span>(<span class="dt">G1=</span><span class="kw">list</span>(<span class="dt">V=</span><span class="dv">1</span>,<span class="dt">nu=</span><span class="dv">0</span>)),<span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span><span class="dv">1</span>, <span class="dt">nu =</span> <span class="dv">0</span>))
)</code></pre>
<h2 id="run-models">Run models</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(foreach)</code></pre>
<pre><code>## foreach: simple, scalable parallel programming from Revolution Analytics
## Use Revolution R for scalability, fault tolerance and more.
## http://www.revolutionanalytics.com</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(doMC)</code></pre>
<pre><code>## Loading required package: iterators
## Loading required package: parallel</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">registerDoMC</span>(<span class="dt">cores =</span> <span class="dv">8</span>)

thin &lt;-<span class="st"> </span><span class="dv">100</span>
burnin &lt;-<span class="st"> </span>thin *<span class="st"> </span><span class="dv">100</span>
nitt &lt;-<span class="st"> </span>burnin +<span class="st"> </span>thin *<span class="st"> </span><span class="dv">1000</span>

time_start &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
m_priors &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span>:<span class="kw">length</span>(priors)) %dopar%<span class="st"> </span>{
  <span class="kw">MCMCglmm</span>(docil ~<span class="st"> </span>julian +<span class="st"> </span>Obs +<span class="st"> </span>handlevent_year +<span class="st"> </span><span class="kw">I</span>(handlevent_year^<span class="dv">2</span>),
                                    <span class="dt">random =</span> ~<span class="st"> </span>ID,
                                    <span class="dt">prior =</span> priors[[i]],
                                    <span class="dt">pr =</span> <span class="ot">TRUE</span>,
                                    <span class="dt">data =</span> doc_data,
                                    <span class="dt">thin =</span> thin,
                                    <span class="dt">burnin =</span> burnin,
                                    <span class="dt">nitt =</span> nitt,
                                    <span class="dt">verbose =</span> <span class="ot">FALSE</span>
                                    )
}
<span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Approx. models run time: &quot;</span>, <span class="kw">format</span>(<span class="kw">Sys.time</span>() -<span class="st"> </span>time_start)))</code></pre>
<pre><code>## [1] &quot;Approx. models run time:  8.042 mins&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(m_priors, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/m_priors.RData&quot;</span>)</code></pre>
<h3 id="model-diagnostics-1">Model Diagnostics</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/m_priors.RData&quot;</span>)

ad &lt;-<span class="st"> </span><span class="kw">list</span>()
gd &lt;-<span class="st"> </span><span class="kw">list</span>()
hd &lt;-<span class="st"> </span><span class="kw">list</span>()

for(i in <span class="dv">1</span>:<span class="kw">length</span>(priors)){
  ad[[i]] &lt;-<span class="st"> </span><span class="kw">autocorr.diag</span>(m_priors[[i]]$VCV)
  gd[[i]] &lt;-<span class="st"> </span><span class="kw">geweke.diag</span>(m_priors[[i]]$VCV)
  hd[[i]] &lt;-<span class="st"> </span><span class="kw">heidel.diag</span>(m_priors[[i]]$VCV)  
}
ad</code></pre>
<pre><code>## [[1]]
##                ID    units
## Lag 0     1.00000  1.00000
## Lag 100  -0.02922 -0.03013
## Lag 500   0.01560  0.02187
## Lag 1000 -0.05264 -0.03655
## Lag 5000  0.01480  0.01472
## 
## [[2]]
##                 ID     units
## Lag 0     1.000000  1.000000
## Lag 100  -0.038620 -0.005688
## Lag 500  -0.038033  0.062510
## Lag 1000  0.041033  0.021035
## Lag 5000  0.008467 -0.030301
## 
## [[3]]
##                 ID     units
## Lag 0     1.000000  1.000000
## Lag 100  -0.047543  0.048670
## Lag 500   0.003440 -0.002852
## Lag 1000 -0.005587  0.011396
## Lag 5000  0.003182  0.007828
## 
## [[4]]
##                  ID    units
## Lag 0     1.0000000  1.00000
## Lag 100   0.0004055 -0.02710
## Lag 500   0.0480595 -0.03198
## Lag 1000  0.0189893  0.02511
## Lag 5000 -0.0272179  0.01032
## 
## [[5]]
##                ID    units
## Lag 0     1.00000  1.00000
## Lag 100   0.06009 -0.03227
## Lag 500   0.06123  0.02975
## Lag 1000  0.01682 -0.01543
## Lag 5000 -0.05175  0.03395
## 
## [[6]]
##                  ID    units
## Lag 0     1.0000000  1.00000
## Lag 100   0.0002831 -0.03890
## Lag 500   0.0032093 -0.02185
## Lag 1000 -0.0009037  0.05010
## Lag 5000 -0.0424693 -0.02452
## 
## [[7]]
##                 ID    units
## Lag 0     1.000000  1.00000
## Lag 100   0.025706  0.03615
## Lag 500  -0.018627  0.02782
## Lag 1000  0.007562  0.05121
## Lag 5000 -0.035466 -0.02292
## 
## [[8]]
##                ID     units
## Lag 0     1.00000  1.000000
## Lag 100  -0.02928 -0.006564
## Lag 500  -0.05204  0.022471
## Lag 1000 -0.01659  0.063554
## Lag 5000 -0.01517 -0.023190</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">gd</code></pre>
<pre><code>## [[1]]
## 
## Fraction in 1st window = 0.1
## Fraction in 2nd window = 0.5 
## 
##     ID  units 
## 0.5828 0.5301 
## 
## 
## [[2]]
## 
## Fraction in 1st window = 0.1
## Fraction in 2nd window = 0.5 
## 
##       ID    units 
## -0.02447 -1.64978 
## 
## 
## [[3]]
## 
## Fraction in 1st window = 0.1
## Fraction in 2nd window = 0.5 
## 
##      ID   units 
## -0.4845  2.2787 
## 
## 
## [[4]]
## 
## Fraction in 1st window = 0.1
## Fraction in 2nd window = 0.5 
## 
##    ID units 
## 2.160 1.382 
## 
## 
## [[5]]
## 
## Fraction in 1st window = 0.1
## Fraction in 2nd window = 0.5 
## 
##      ID   units 
## -0.4190 -0.1041 
## 
## 
## [[6]]
## 
## Fraction in 1st window = 0.1
## Fraction in 2nd window = 0.5 
## 
##      ID   units 
##  0.1051 -1.3288 
## 
## 
## [[7]]
## 
## Fraction in 1st window = 0.1
## Fraction in 2nd window = 0.5 
## 
##       ID    units 
## -0.07847 -2.51430 
## 
## 
## [[8]]
## 
## Fraction in 1st window = 0.1
## Fraction in 2nd window = 0.5 
## 
##      ID   units 
## -0.3845 -0.1387</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">hd</code></pre>
<pre><code>## [[1]]
##                                     
##       Stationarity start     p-value
##       test         iteration        
## ID    passed       1         0.794  
## units passed       1         0.321  
##                               
##       Halfwidth Mean Halfwidth
##       test                    
## ID    passed    19.3 0.0880   
## units passed    33.5 0.0514   
## 
## [[2]]
##                                     
##       Stationarity start     p-value
##       test         iteration        
## ID    passed       1         0.2942 
## units passed       1         0.0967 
##                               
##       Halfwidth Mean Halfwidth
##       test                    
## ID    passed    19.3 0.0896   
## units passed    33.5 0.0500   
## 
## [[3]]
##                                     
##       Stationarity start     p-value
##       test         iteration        
## ID    passed       1         0.800  
## units passed       1         0.387  
##                               
##       Halfwidth Mean Halfwidth
##       test                    
## ID    passed    19.2 0.0906   
## units passed    33.5 0.0537   
## 
## [[4]]
##                                     
##       Stationarity start     p-value
##       test         iteration        
## ID    passed       101       0.0706 
## units passed       301       0.1075 
##                               
##       Halfwidth Mean Halfwidth
##       test                    
## ID    passed    19.2 0.0928   
## units passed    33.7 0.0623   
## 
## [[5]]
##                                     
##       Stationarity start     p-value
##       test         iteration        
## ID    passed       1         0.572  
## units passed       1         0.723  
##                               
##       Halfwidth Mean Halfwidth
##       test                    
## ID    passed    19.2 0.0943   
## units passed    33.5 0.0501   
## 
## [[6]]
##                                     
##       Stationarity start     p-value
##       test         iteration        
## ID    passed       1         0.278  
## units passed       1         0.102  
##                               
##       Halfwidth Mean Halfwidth
##       test                    
## ID    passed    19.2 0.0878   
## units passed    33.5 0.0495   
## 
## [[7]]
##                                     
##       Stationarity start     p-value
##       test         iteration        
## ID    passed       1         0.784  
## units passed       1         0.487  
##                               
##       Halfwidth Mean Halfwidth
##       test                    
## ID    passed    19.4 0.0895   
## units passed    33.5 0.0513   
## 
## [[8]]
##                                     
##       Stationarity start     p-value
##       test         iteration        
## ID    passed       1         0.535  
## units passed       1         0.958  
##                               
##       Halfwidth Mean Halfwidth
##       test                    
## ID    passed    19.2 0.0883   
## units passed    33.5 0.0515</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">for(i in <span class="dv">1</span>:<span class="kw">length</span>(priors)){
  <span class="kw">plot</span>(m_priors[[i]]$VCV)
}</code></pre>
<p><img src="figure/02b_diagnostic_plots1.png" alt="FALSE" /> <img src="figure/02b_diagnostic_plots2.png" alt="FALSE" /> <img src="figure/02b_diagnostic_plots3.png" alt="FALSE" /> <img src="figure/02b_diagnostic_plots4.png" alt="FALSE" /> <img src="figure/02b_diagnostic_plots5.png" alt="FALSE" /> <img src="figure/02b_diagnostic_plots6.png" alt="FALSE" /> <img src="figure/02b_diagnostic_plots7.png" alt="FALSE" /> <img src="figure/02b_diagnostic_plots8.png" alt="FALSE" /></p>
<h2 id="extract-raneffs">Extract raneffs</h2>
<pre class="sourceCode r"><code class="sourceCode r">extractMCMCglmmBLUPs &lt;-<span class="st"> </span>function(x, value, <span class="dt">ptype =</span> <span class="st">&quot;1&quot;</span>){
  p_modes &lt;-<span class="st"> </span><span class="kw">posterior.mode</span>(x$Sol) ## Get posterior_modes of the BLUPs
  p_modes &lt;-<span class="st"> </span>p_modes[<span class="kw">grep</span>(<span class="st">&quot;ID&quot;</span>, <span class="kw">names</span>(p_modes))] ## Get all the ID rows
  p_modes &lt;-<span class="st"> </span><span class="kw">stack</span>(p_modes)
  <span class="kw">names</span>(p_modes) &lt;-<span class="st"> </span><span class="kw">c</span>(value, <span class="st">&quot;ID&quot;</span>)
  p_modes$type &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;mcmc.mode&quot;</span>, ptype, <span class="dt">sep =</span> <span class="st">&#39;.&#39;</span>)
  p_modes$ID &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;ID</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="st">&quot;&quot;</span>, p_modes$ID)
  p_modes$itt &lt;-<span class="st"> </span><span class="ot">NA</span>
  sols &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x$Sol) ## Get BLUPs
  sols &lt;-<span class="st"> </span>sols[ ,<span class="kw">grep</span>(<span class="st">&quot;ID&quot;</span>, <span class="kw">names</span>(sols))] ## Get all the ID columns
  sols &lt;-<span class="st"> </span><span class="kw">stack</span>(sols)
  <span class="kw">names</span>(sols) &lt;-<span class="st"> </span><span class="kw">c</span>(value, <span class="st">&quot;ID&quot;</span>)
  sols$itt &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="dv">1000</span> ## Just an index for each MCMC sample
  sols$type =<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;mcmc&quot;</span>, ptype, <span class="dt">sep =</span> <span class="st">&#39;.&#39;</span>)
  sols$ID &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;ID</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="st">&quot;&quot;</span>, sols$ID)
  <span class="kw">rbind</span>(sols, p_modes)
}

doc_mcmc &lt;-<span class="st"> </span><span class="kw">list</span>()
for(i in <span class="dv">1</span>:<span class="kw">length</span>(priors)){
  doc_mcmc[[i]] &lt;-<span class="st"> </span><span class="kw">extractMCMCglmmBLUPs</span>(m_priors[[i]],
    <span class="dt">value =</span> <span class="st">&quot;docility&quot;</span>, <span class="dt">ptype =</span> i)  
}

mcmc_priors &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, doc_mcmc)</code></pre>
<h2 id="compare-mcmc-priors">Compare MCMC priors</h2>
<p>Comparing the effect of priors on the posterior distributions.</p>
<h3 id="posterior-modes">Posterior modes</h3>
<pre class="sourceCode r"><code class="sourceCode r">mcmc_modes &lt;-<span class="st"> </span>mcmc_priors[<span class="kw">grep</span>(<span class="st">&quot;mode&quot;</span>, mcmc_priors$type), ]
mcmc_modes$itt &lt;-<span class="st"> </span><span class="ot">NULL</span>
mcmc_modes &lt;-<span class="st"> </span><span class="kw">spread</span>(mcmc_modes, type, docility)

cov_modes &lt;-<span class="st"> </span><span class="kw">cov</span>(mcmc_modes[ ,<span class="dv">2</span>:<span class="kw">ncol</span>(mcmc_modes)])
cor_modes &lt;-<span class="st"> </span><span class="kw">cor</span>(mcmc_modes[ ,<span class="dv">2</span>:<span class="kw">ncol</span>(mcmc_modes)])

cov_modes[<span class="kw">upper.tri</span>(cov_modes)] &lt;-<span class="st"> </span>cor_modes[<span class="kw">upper.tri</span>(cor_modes)]

<span class="kw">pandoc.table</span>(cov_modes)</code></pre>
<table>
<caption>Table continues below</caption>
<col width="25%" />
<col width="19%" />
<col width="19%" />
<col width="19%" />
<thead>
<tr class="header">
<th align="left"> </th>
<th align="right">mcmc.mode.1</th>
<th align="right">mcmc.mode.2</th>
<th align="right">mcmc.mode.3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>mcmc.mode.1</strong></td>
<td align="right">12.03</td>
<td align="right">0.9508</td>
<td align="right">0.9484</td>
</tr>
<tr class="even">
<td align="left"><strong>mcmc.mode.2</strong></td>
<td align="right">11.5</td>
<td align="right">12.16</td>
<td align="right">0.9524</td>
</tr>
<tr class="odd">
<td align="left"><strong>mcmc.mode.3</strong></td>
<td align="right">11.55</td>
<td align="right">11.66</td>
<td align="right">12.33</td>
</tr>
<tr class="even">
<td align="left"><strong>mcmc.mode.4</strong></td>
<td align="right">11.57</td>
<td align="right">11.65</td>
<td align="right">11.71</td>
</tr>
<tr class="odd">
<td align="left"><strong>mcmc.mode.5</strong></td>
<td align="right">11.55</td>
<td align="right">11.62</td>
<td align="right">11.65</td>
</tr>
<tr class="even">
<td align="left"><strong>mcmc.mode.6</strong></td>
<td align="right">11.51</td>
<td align="right">11.63</td>
<td align="right">11.61</td>
</tr>
<tr class="odd">
<td align="left"><strong>mcmc.mode.7</strong></td>
<td align="right">11.58</td>
<td align="right">11.72</td>
<td align="right">11.72</td>
</tr>
<tr class="even">
<td align="left"><strong>mcmc.mode.8</strong></td>
<td align="right">11.47</td>
<td align="right">11.56</td>
<td align="right">11.52</td>
</tr>
</tbody>
</table>
<table>
<caption>Table continues below</caption>
<col width="25%" />
<col width="19%" />
<col width="19%" />
<col width="19%" />
<thead>
<tr class="header">
<th align="left"> </th>
<th align="right">mcmc.mode.4</th>
<th align="right">mcmc.mode.5</th>
<th align="right">mcmc.mode.6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>mcmc.mode.1</strong></td>
<td align="right">0.9475</td>
<td align="right">0.9488</td>
<td align="right">0.9495</td>
</tr>
<tr class="even">
<td align="left"><strong>mcmc.mode.2</strong></td>
<td align="right">0.9488</td>
<td align="right">0.9498</td>
<td align="right">0.9542</td>
</tr>
<tr class="odd">
<td align="left"><strong>mcmc.mode.3</strong></td>
<td align="right">0.9473</td>
<td align="right">0.9458</td>
<td align="right">0.9464</td>
</tr>
<tr class="even">
<td align="left"><strong>mcmc.mode.4</strong></td>
<td align="right">12.4</td>
<td align="right">0.9516</td>
<td align="right">0.9522</td>
</tr>
<tr class="odd">
<td align="left"><strong>mcmc.mode.5</strong></td>
<td align="right">11.76</td>
<td align="right">12.31</td>
<td align="right">0.9463</td>
</tr>
<tr class="even">
<td align="left"><strong>mcmc.mode.6</strong></td>
<td align="right">11.72</td>
<td align="right">11.6</td>
<td align="right">12.21</td>
</tr>
<tr class="odd">
<td align="left"><strong>mcmc.mode.7</strong></td>
<td align="right">11.76</td>
<td align="right">11.67</td>
<td align="right">11.72</td>
</tr>
<tr class="even">
<td align="left"><strong>mcmc.mode.8</strong></td>
<td align="right">11.66</td>
<td align="right">11.6</td>
<td align="right">11.58</td>
</tr>
</tbody>
</table>
<table>
<col width="25%" />
<col width="19%" />
<col width="19%" />
<thead>
<tr class="header">
<th align="left"> </th>
<th align="right">mcmc.mode.7</th>
<th align="right">mcmc.mode.8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>mcmc.mode.1</strong></td>
<td align="right">0.9496</td>
<td align="right">0.9516</td>
</tr>
<tr class="even">
<td align="left"><strong>mcmc.mode.2</strong></td>
<td align="right">0.9562</td>
<td align="right">0.9536</td>
</tr>
<tr class="odd">
<td align="left"><strong>mcmc.mode.3</strong></td>
<td align="right">0.9497</td>
<td align="right">0.9439</td>
</tr>
<tr class="even">
<td align="left"><strong>mcmc.mode.4</strong></td>
<td align="right">0.95</td>
<td align="right">0.9524</td>
</tr>
<tr class="odd">
<td align="left"><strong>mcmc.mode.5</strong></td>
<td align="right">0.9463</td>
<td align="right">0.9511</td>
</tr>
<tr class="even">
<td align="left"><strong>mcmc.mode.6</strong></td>
<td align="right">0.9541</td>
<td align="right">0.953</td>
</tr>
<tr class="odd">
<td align="left"><strong>mcmc.mode.7</strong></td>
<td align="right">12.36</td>
<td align="right">0.9543</td>
</tr>
<tr class="even">
<td align="left"><strong>mcmc.mode.8</strong></td>
<td align="right">11.66</td>
<td align="right">12.08</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(GGally)
<span class="kw">ggpairs</span>(mcmc_modes, <span class="dt">columns =</span> <span class="dv">3</span>:<span class="kw">ncol</span>(mcmc_modes))</code></pre>
<div class="figure">
<img src="figure/02b_plot_modes.png" />
</div>
<p>Ok, the models are all converging on the same point estimates. Why 0.95 correlation???</p>
<h3 id="variance-of-blups">Variance of blups</h3>
<pre class="sourceCode r"><code class="sourceCode r">mcmc_itts &lt;-<span class="st"> </span>mcmc_priors[!<span class="kw">is.na</span>(mcmc_priors$itt), ]
<span class="kw">tapply</span>(mcmc_itts$docility, mcmc_itts$type, var)</code></pre>
<pre><code>## mcmc.1 mcmc.2 mcmc.3 mcmc.4 mcmc.5 mcmc.6 mcmc.7 mcmc.8 
##  19.20  19.30  19.16  19.12  19.20  19.13  19.26  19.14</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tapply</span>(mcmc_itts$docility, mcmc_itts$type, range)</code></pre>
<pre><code>## $mcmc.1
## [1] -18.35  18.04
## 
## $mcmc.2
## [1] -20.60  19.28
## 
## $mcmc.3
## [1] -20.06  18.31
## 
## $mcmc.4
## [1] -20.17  18.76
## 
## $mcmc.5
## [1] -19.19  17.83
## 
## $mcmc.6
## [1] -19.51  18.44
## 
## $mcmc.7
## [1] -18.99  18.26
## 
## $mcmc.8
## [1] -22.01  17.66</code></pre>
<p>No variation in variances either...</p>
<!--pandoc
t: html
default-image-extension: png
template: templates/html.template
toc-depth: 4
toc:

t: latex
s:
S:
latex-engine: xelatex
template: templates/latex.template
default-image-extension: pdf
toc-depth: 4
toc:
-->


<h1 id="fitness-and-standardization">Fitness and Standardization</h1>
<h3 id="load-data">Load Data</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MASS) <span class="co"># MASS clashes with dplyr... so always load first</span>
<span class="kw">library</span>(pander) <span class="co"># pander clashes with dplyr... so always load first</span></code></pre>
<pre><code>## 
## Attaching package: &#39;pander&#39;
## 
## The following object is masked from &#39;package:knitr&#39;:
## 
##     pandoc</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)</code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;
## 
## The following object is masked from &#39;package:MASS&#39;:
## 
##     select
## 
## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag
## 
## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.alignment</span>(<span class="st">&#39;right&#39;</span>, <span class="dt">row.names =</span> <span class="st">&#39;left&#39;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/raneffs_blups.RData&quot;</span>)
<span class="co"># load(&quot;data/analyses_data/pca.RData&quot;)</span>
fitness &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file =</span> <span class="st">&quot;data/fitness+competition.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&#39;,&#39;</span>,
  <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
fitness &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(fitness)</code></pre>
<h2 id="merge-fitness-with-blups">Merge fitness with blups</h2>
<pre class="sourceCode r"><code class="sourceCode r">fitness$ID &lt;-<span class="st"> </span><span class="kw">as.character</span>(fitness$ID)
fit_raneff_data &lt;-<span class="st"> </span><span class="kw">inner_join</span>(fitness, raneffs_blups, <span class="dt">by =</span> <span class="st">&quot;ID&quot;</span>)
fit_raneff_data &lt;-<span class="st"> </span>fit_raneff_data %&gt;%
<span class="st">  </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(docility) &amp;<span class="st"> </span>!<span class="kw">is.na</span>(aggression) &amp;<span class="st"> </span>!<span class="kw">is.na</span>(activity))</code></pre>
<h2 id="relative-fitness">Relative Fitness</h2>
<p>Calculate relative fitness for each year &amp; population combination. Two populations (Grids).<br />Three measures of fitness:</p>
<ol style="list-style-type: decimal">
<li>ars_all = Annual reproductive success over all litters (no. pups that survived overwinter)<br /></li>
<li>kprod = Fecundity (kids produced)<br /></li>
<li>prop = Offpsring overwinter survival (proportion of pups produced that survived overwinter)</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Calculate offspring overwitner survival</span>
fit_raneff_data &lt;-<span class="st"> </span>fit_raneff_data %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">prop =</span> ars_all/kprod)

fit_raneff_data &lt;-<span class="st"> </span>fit_raneff_data %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Grid, Year, itt) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rel_ars =</span> ars_all /<span class="st"> </span><span class="kw">mean</span>(ars_all),
   <span class="dt">rel_kpd =</span> kprod /<span class="st"> </span><span class="kw">mean</span>(kprod),
   <span class="dt">rel_ows =</span> prop /<span class="st"> </span><span class="kw">mean</span>(prop)
   )</code></pre>
<p>Now:</p>
<ul>
<li>rel_ars = relative ARS</li>
<li>rel_kpd = relative fecunidty</li>
<li>felOWS = relative offspring overwinter survival</li>
</ul>
<h2 id="standardize-variables">Standardize Variables</h2>
<p>Standaradized to mean 0 and sd 1. Standardized variables renamed from xxx to xxx_s or xxx_sy (for standardized within year). Standardized within each BLUP itteration.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Standardize within itteration and year</span>
fit_raneff_data &lt;-<span class="st"> </span>fit_raneff_data %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(itt, Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">aggression_sy  =</span> (aggression  -<span class="st"> </span><span class="kw">mean</span>(aggression, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))  /
<span class="st">      </span><span class="kw">sd</span>(aggression, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">activity_sy    =</span> (activity    -<span class="st"> </span><span class="kw">mean</span>(activity, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))    /
<span class="st">      </span><span class="kw">sd</span>(activity, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">docility_sy    =</span> (docility    -<span class="st"> </span><span class="kw">mean</span>(docility, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))    /
<span class="st">      </span><span class="kw">sd</span>(docility, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">competition_sy =</span> (competition -<span class="st"> </span><span class="kw">mean</span>(competition, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) /
<span class="st">      </span><span class="kw">sd</span>(competition, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
      )
<span class="co"># Standardize within itteration</span>
fit_raneff_data &lt;-<span class="st"> </span>fit_raneff_data %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(itt, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">aggression_s  =</span> (aggression  -<span class="st"> </span><span class="kw">mean</span>(aggression, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))  /
<span class="st">      </span><span class="kw">sd</span>(aggression, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">activity_s    =</span> (activity    -<span class="st"> </span><span class="kw">mean</span>(activity, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))    /
<span class="st">      </span><span class="kw">sd</span>(activity, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">docility_s    =</span> (docility    -<span class="st"> </span><span class="kw">mean</span>(docility, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))    /
<span class="st">      </span><span class="kw">sd</span>(docility, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">competition_s =</span> (competition -<span class="st"> </span><span class="kw">mean</span>(competition, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) /
<span class="st">      </span><span class="kw">sd</span>(competition, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
      )</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">fit_raneff_data %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(itt, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">v_agg =</span> <span class="kw">var</span>(aggression_s, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">v_act =</span> <span class="kw">var</span>(activity_s, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">v_doc =</span> <span class="kw">var</span>(docility_s, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
    ) %&gt;%
<span class="st">  </span><span class="kw">head</span>(.,<span class="dt">n=</span><span class="dv">10</span>) %&gt;%
<span class="st">  </span><span class="kw">pandoc.table</span>(.)</code></pre>
<table>
<col width="8%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<thead>
<tr class="header">
<th align="right">itt</th>
<th align="right">v_agg</th>
<th align="right">v_act</th>
<th align="right">v_doc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r">fit_raneff_data %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(itt, Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">v_agg =</span> <span class="kw">var</span>(aggression_sy, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">v_act =</span> <span class="kw">var</span>(activity_sy, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">v_doc =</span> <span class="kw">var</span>(docility_sy, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
    ) %&gt;%
<span class="st">  </span><span class="kw">head</span>(.,<span class="dt">n=</span><span class="dv">10</span>) %&gt;%
<span class="st">  </span><span class="kw">pandoc.table</span>(.)</code></pre>
<table>
<col width="8%" />
<col width="9%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<thead>
<tr class="header">
<th align="center">itt</th>
<th align="center">Year</th>
<th align="center">v_agg</th>
<th align="center">v_act</th>
<th align="center">v_doc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">2003</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">2004</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0</td>
<td align="center">2005</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">2006</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0</td>
<td align="center">2007</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">2008</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0</td>
<td align="center">2009</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">2010</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">2003</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">2004</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<h2 id="sample-sizes">Sample Sizes</h2>
<pre class="sourceCode r"><code class="sourceCode r">fit_raneff_data %&gt;%
<span class="st">  </span><span class="kw">filter</span>(itt ==<span class="st"> &quot;1&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Grid, Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="kw">n</span>()) %&gt;%
<span class="st">  </span><span class="kw">pandoc.table</span>(.)</code></pre>
<table>
<col width="9%" />
<col width="9%" />
<col width="9%" />
<thead>
<tr class="header">
<th align="center">Grid</th>
<th align="center">Year</th>
<th align="center">n()</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">KL</td>
<td align="center">2003</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">KL</td>
<td align="center">2004</td>
<td align="center">6</td>
</tr>
<tr class="odd">
<td align="center">KL</td>
<td align="center">2005</td>
<td align="center">15</td>
</tr>
<tr class="even">
<td align="center">KL</td>
<td align="center">2006</td>
<td align="center">19</td>
</tr>
<tr class="odd">
<td align="center">KL</td>
<td align="center">2007</td>
<td align="center">20</td>
</tr>
<tr class="even">
<td align="center">KL</td>
<td align="center">2008</td>
<td align="center">28</td>
</tr>
<tr class="odd">
<td align="center">KL</td>
<td align="center">2009</td>
<td align="center">24</td>
</tr>
<tr class="even">
<td align="center">KL</td>
<td align="center">2010</td>
<td align="center">16</td>
</tr>
<tr class="odd">
<td align="center">SU</td>
<td align="center">2003</td>
<td align="center">10</td>
</tr>
<tr class="even">
<td align="center">SU</td>
<td align="center">2004</td>
<td align="center">15</td>
</tr>
<tr class="odd">
<td align="center">SU</td>
<td align="center">2005</td>
<td align="center">26</td>
</tr>
<tr class="even">
<td align="center">SU</td>
<td align="center">2006</td>
<td align="center">21</td>
</tr>
<tr class="odd">
<td align="center">SU</td>
<td align="center">2007</td>
<td align="center">14</td>
</tr>
<tr class="even">
<td align="center">SU</td>
<td align="center">2008</td>
<td align="center">9</td>
</tr>
<tr class="odd">
<td align="center">SU</td>
<td align="center">2009</td>
<td align="center">9</td>
</tr>
<tr class="even">
<td align="center">SU</td>
<td align="center">2010</td>
<td align="center">2</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r">fit_raneff_data %&gt;%
<span class="kw">filter</span>(itt ==<span class="st"> &quot;1&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="kw">n</span>()) %&gt;%
<span class="st">  </span><span class="kw">pandoc.table</span>(.)</code></pre>
<table>
<col width="9%" />
<col width="9%" />
<thead>
<tr class="header">
<th align="center">Year</th>
<th align="center">n()</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">2003</td>
<td align="center">13</td>
</tr>
<tr class="even">
<td align="center">2004</td>
<td align="center">21</td>
</tr>
<tr class="odd">
<td align="center">2005</td>
<td align="center">41</td>
</tr>
<tr class="even">
<td align="center">2006</td>
<td align="center">40</td>
</tr>
<tr class="odd">
<td align="center">2007</td>
<td align="center">34</td>
</tr>
<tr class="even">
<td align="center">2008</td>
<td align="center">37</td>
</tr>
<tr class="odd">
<td align="center">2009</td>
<td align="center">33</td>
</tr>
<tr class="even">
<td align="center">2010</td>
<td align="center">18</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(fit_raneff_data, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/fit_raneff_data.RData&quot;</span>)</code></pre>
<!--pandoc
t: html
default-image-extension: png
template: templates/html.template
toc-depth: 4
toc:

t: latex
s:
S:
latex-engine: xelatex
template: templates/latex.template
default-image-extension: pdf
toc-depth: 4
toc:
-->


<h1 id="temporal-selection-gradients">Temporal Selection Gradients</h1>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MASS) <span class="co"># MASS clashes with dplyr... so always load first</span>
<span class="kw">library</span>(pander) <span class="co"># pander clashes with dplyr... so always load first</span></code></pre>
<pre><code>## 
## Attaching package: &#39;pander&#39;
## 
## The following object is masked from &#39;package:knitr&#39;:
## 
##     pandoc</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.alignment</span>(<span class="st">&#39;right&#39;</span>, <span class="dt">row.names =</span> <span class="st">&#39;left&#39;</span>)
<span class="kw">library</span>(MCMCglmm)</code></pre>
<pre><code>## Loading required package: Matrix
## Loading required package: coda
## Loading required package: lattice
## Loading required package: ape</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(arm)</code></pre>
<pre><code>## Loading required package: lme4
## Loading required package: Rcpp
## 
## arm (Version 1.7-07, built: 2014-8-27)
## 
## Working directory is /home/ryan/projects/2014-female-selection
## 
## 
## Attaching package: &#39;arm&#39;
## 
## The following object is masked from &#39;package:ape&#39;:
## 
##     balance
## 
## The following object is masked from &#39;package:coda&#39;:
## 
##     traceplot</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)</code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;
## 
## The following object is masked from &#39;package:MASS&#39;:
## 
##     select
## 
## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag
## 
## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(grid)

<span class="co"># Load Data</span>
<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/fit_raneff_data.RData&quot;</span>)
fit_raneff_data$Year &lt;-<span class="st"> </span><span class="kw">as.character</span>(fit_raneff_data$Year)</code></pre>
<h2 id="does-year-significantly-improve-models-of-selection">Does 'Year' significantly improve models of selection?</h2>
<p>The significance of interaction terms between Year and the behavioral traits on fitness.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># GLMMs to test whether selection fluctuates across years.</span>
<span class="kw">library</span>(lme4)
<span class="co"># Models with interactions between year and the behavioral traits</span>
fit_raneff_data_blup &lt;-<span class="st"> </span><span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>)

fit_raneff_data_blup %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Grid, Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="kw">n</span>(), <span class="kw">var</span>(ars_all))</code></pre>
<pre><code>## Source: local data frame [16 x 4]
## Groups: Grid
## 
##    Grid Year n() var(ars_all)
## 1    KL 2003   4       0.0000
## 2    KL 2004   8       0.7857
## 3    KL 2005  19       1.6550
## 4    KL 2006  24       0.4275
## 5    KL 2007  21       1.1000
## 6    KL 2008  29       0.5369
## 7    KL 2009  24       0.7373
## 8    KL 2010  22       1.2121
## 9    SU 2003  14       1.3022
## 10   SU 2004  18       0.8007
## 11   SU 2005  31       1.9828
## 12   SU 2006  24       0.3025
## 13   SU 2007  19       1.0526
## 14   SU 2008  16       0.0000
## 15   SU 2009  11       0.8727
## 16   SU 2010  12       2.4470</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># grid_years with no variation in fitness need to be removed</span>
fit_raneff_data_blup &lt;-<span class="st"> </span><span class="kw">filter</span>(fit_raneff_data_blup,
  !(grid_year %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;KL2003&quot;</span>, <span class="st">&quot;SU2008&quot;</span>)))

<span class="co"># Need to also remove Grid Years with very low sample sizes.</span>
fit_raneff_data_blup %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Grid, Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="kw">n</span>(), <span class="kw">var</span>(ars_all))</code></pre>
<pre><code>## Source: local data frame [14 x 4]
## Groups: Grid
## 
##    Grid Year n() var(ars_all)
## 1    KL 2004   8       0.7857
## 2    KL 2005  19       1.6550
## 3    KL 2006  24       0.4275
## 4    KL 2007  21       1.1000
## 5    KL 2008  29       0.5369
## 6    KL 2009  24       0.7373
## 7    KL 2010  22       1.2121
## 8    SU 2003  14       1.3022
## 9    SU 2004  18       0.8007
## 10   SU 2005  31       1.9828
## 11   SU 2006  24       0.3025
## 12   SU 2007  19       1.0526
## 13   SU 2009  11       0.8727
## 14   SU 2010  12       2.4470</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">fit_raneff_data_blup &lt;-<span class="st"> </span><span class="kw">filter</span>(fit_raneff_data_blup,
  !(grid_year %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;KL2004&quot;</span>)))

fit_raneff_data_blup$oID &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="kw">nrow</span>(fit_raneff_data_blup)
fit_raneff_data_blup &lt;-<span class="st"> </span><span class="kw">droplevels</span>(fit_raneff_data_blup)

ars_year &lt;-<span class="st"> </span><span class="kw">glmer</span>(ars_all ~<span class="st"> </span>Year +<span class="st"> </span>Grid +<span class="st"> </span>activity_s +<span class="st"> </span>activity_s:Year +
<span class="st">  </span>aggression_s +<span class="st"> </span>aggression_s:Year +<span class="st"> </span>docility_s +<span class="st"> </span>docility_s:Year +
<span class="st">  </span>(<span class="dv">1</span>|ID) +<span class="st"> </span>(<span class="dv">1</span>|oID), <span class="dt">data =</span> fit_raneff_data_blup, <span class="dt">family =</span> poisson, 
  <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))</code></pre>
<pre><code>## Warning: maxfun &lt; 10 * length(par)^2 is not recommended.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(ars_year, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/ars_year.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/ars_year.RData&quot;</span>)
<span class="co"># Test fit of models. Does the addition of year:traits improve the fit?</span>
<span class="kw">library</span>(car)</code></pre>
<pre><code>## 
## Attaching package: &#39;car&#39;
## 
## The following object is masked from &#39;package:arm&#39;:
## 
##     logit</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lme4)
aod &lt;-<span class="st"> </span><span class="kw">Anova</span>(ars_year, <span class="dt">type =</span> <span class="dv">2</span>)
aod &lt;-<span class="st"> </span><span class="kw">data.frame</span>(aod)
aod$Chisq &lt;-<span class="st"> </span><span class="kw">round</span>(aod$Chisq ,<span class="dt">digits =</span> <span class="dv">2</span>)

<span class="co"># Function to convert small p-values into &#39;P &lt; X&#39;</span>
p.format &lt;-<span class="st"> </span>function(x){ 
    out &lt;-<span class="st"> </span><span class="kw">signif</span>(x, <span class="dt">digits =</span> <span class="dv">2</span>)
  out[x &lt;<span class="st"> </span><span class="fl">0.005</span>]  &lt;-<span class="st"> &quot;&lt; 0.005&quot;</span>
    out[x &lt;<span class="st"> </span><span class="fl">0.001</span>]  &lt;-<span class="st"> &quot;&lt; 0.001&quot;</span>
    out[x &lt;<span class="st"> </span><span class="fl">0.0001</span>] &lt;-<span class="st"> &quot;&lt; 0.0001&quot;</span>
    <span class="kw">return</span>(out)
}
<span class="co"># Format p values</span>
aod[ ,<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">p.format</span>(aod[ ,<span class="dv">3</span>])
<span class="kw">row.names</span>(aod) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Grid&quot;</span>, <span class="st">&quot;Activity&quot;</span>, <span class="st">&quot;Aggression&quot;</span>, <span class="st">&quot;Docility&quot;</span>,
  <span class="st">&quot;Year x Activity&quot;</span>, <span class="st">&quot;Year x Aggression&quot;</span>, <span class="st">&quot;Year x Docility&quot;</span>)
<span class="kw">pandoc.table</span>(aod, <span class="dt">caption =</span> 
  <span class="st">&quot;The effect of year on selection for female behavioral traits through annual</span>
<span class="st">reproductive success. Significance was calculated with Wald chisq tests from</span>
<span class="st">a type II analysis of deviance. GLMMs were fitted with identity as a random</span>
<span class="st">effect and assumed a Poisson error distribution.&quot;</span>)</code></pre>
<table>
<caption>The effect of year on selection for female behavioral traits through annual reproductive success. Significance was calculated with Wald chisq tests from a type II analysis of deviance. GLMMs were fitted with identity as a random effect and assumed a Poisson error distribution.</caption>
<col width="33%" />
<col width="11%" />
<col width="6%" />
<col width="16%" />
<thead>
<tr class="header">
<th align="left"> </th>
<th align="right">Chisq</th>
<th align="right">Df</th>
<th align="right">Pr..Chisq.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Year</strong></td>
<td align="right">38.1</td>
<td align="right">7</td>
<td align="right">&lt; 0.0001</td>
</tr>
<tr class="even">
<td align="left"><strong>Grid</strong></td>
<td align="right">1.07</td>
<td align="right">1</td>
<td align="right">0.3</td>
</tr>
<tr class="odd">
<td align="left"><strong>Activity</strong></td>
<td align="right">0.34</td>
<td align="right">1</td>
<td align="right">0.56</td>
</tr>
<tr class="even">
<td align="left"><strong>Aggression</strong></td>
<td align="right">0.34</td>
<td align="right">1</td>
<td align="right">0.56</td>
</tr>
<tr class="odd">
<td align="left"><strong>Docility</strong></td>
<td align="right">0.98</td>
<td align="right">1</td>
<td align="right">0.32</td>
</tr>
<tr class="even">
<td align="left"><strong>Year x Activity</strong></td>
<td align="right">22.92</td>
<td align="right">7</td>
<td align="right">&lt; 0.005</td>
</tr>
<tr class="odd">
<td align="left"><strong>Year x Aggression</strong></td>
<td align="right">22.84</td>
<td align="right">7</td>
<td align="right">&lt; 0.005</td>
</tr>
<tr class="even">
<td align="left"><strong>Year x Docility</strong></td>
<td align="right">10.33</td>
<td align="right">7</td>
<td align="right">0.17</td>
</tr>
</tbody>
</table>
<h2 id="accounting-for-random-effect-uncertainty">Accounting for random effect uncertainty</h2>
<h3 id="calculate-selection-gradients">Calculate selection gradients</h3>
<p>Calculate selection coefficients for each of the 1000 samples of the posterior distribution of random effects.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Function to get posterior distribution of selection gradients</span>
x &lt;-<span class="st"> </span>fit_raneff_data %&gt;%<span class="st"> </span><span class="kw">filter</span>(type ==<span class="st"> &quot;raneff&quot;</span> &amp;<span class="st"> </span>Year ==<span class="st"> </span><span class="dv">2003</span> &amp;<span class="st"> </span>itt ==<span class="st"> </span><span class="dv">1</span>)
seCoefMCMC &lt;-<span class="st"> </span>function(x){
  mod &lt;-<span class="st"> </span><span class="kw">lm</span>(rel_ars ~<span class="st"> </span>aggression +<span class="st"> </span>activity +<span class="st"> </span>docility, <span class="dt">data =</span> x)
  mod_sd &lt;-<span class="st">  </span><span class="kw">lm</span>(rel_ars ~<span class="st"> </span>aggression_sy +<span class="st"> </span>activity_sy +<span class="st"> </span>docility_sy, <span class="dt">data =</span> x)
  res &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">as.list</span>(<span class="kw">coef</span>(mod)[-<span class="dv">1</span>]), <span class="kw">as.list</span>(<span class="kw">coef</span>(mod_sd)[-<span class="dv">1</span>]))
  res$Year &lt;-<span class="st"> </span>x$Year[<span class="dv">1</span>]
  res$itt &lt;-<span class="st"> </span>x$itt[<span class="dv">1</span>]
  <span class="kw">return</span>(<span class="kw">data.frame</span>(res, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>))
}

start_time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
sel_grads_mcmc_post &lt;-<span class="st"> </span>fit_raneff_data %&gt;%
<span class="st">  </span><span class="kw">filter</span>(type ==<span class="st"> &quot;raneff&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(itt, Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">do</span>(<span class="kw">seCoefMCMC</span>(.))
<span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Approx. run time: &quot;</span>, <span class="kw">format</span>(<span class="kw">Sys.time</span>() -<span class="st"> </span>start_time)))</code></pre>
<pre><code>## [1] &quot;Approx. run time:  57.5 secs&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(sel_grads_mcmc_post,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/sel_grads_mcmc_post.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_mcmc_post.RData&quot;</span>)
x &lt;-<span class="st"> </span>sel_grads_mcmc_post %&gt;%<span class="st"> </span><span class="kw">filter</span>(Year ==<span class="st"> &quot;2003&quot;</span>)
getCred &lt;-<span class="st"> </span>function(x, <span class="dt">sig =</span> <span class="fl">0.05</span>){
  <span class="kw">require</span>(MCMCglmm)
  mcmc_data &lt;-<span class="st"> </span>x %&gt;%<span class="st"> </span><span class="kw">ungroup</span>() %&gt;%<span class="st"> </span><span class="kw">select</span>(aggression, activity, docility, aggression_sy, activity_sy, docility_sy) %&gt;%<span class="st"> </span><span class="kw">mcmc</span>(.)
  pm  &lt;-<span class="st"> </span><span class="kw">posterior.mode</span>(mcmc_data)
  int &lt;-<span class="st"> </span><span class="kw">HPDinterval</span>(mcmc_data, <span class="dt">prob =</span> <span class="dv">1</span> -<span class="st"> </span>sig)
  <span class="kw">tbl_df</span>(<span class="kw">data.frame</span>(
    <span class="dt">Year      =</span> x$Year[<span class="dv">1</span>],
    <span class="dt">variable  =</span> <span class="kw">c</span>(<span class="st">&quot;Aggression&quot;</span>, <span class="st">&quot;Activity&quot;</span>, <span class="st">&quot;Docility&quot;</span>, <span class="st">&quot;Aggression&quot;</span>, 
    <span class="st">&quot;Activity&quot;</span>, <span class="st">&quot;Docility&quot;</span>),
     <span class="dt">standardization =</span> <span class="kw">c</span>(<span class="st">&quot;None&quot;</span>, <span class="st">&quot;None&quot;</span>, <span class="st">&quot;None&quot;</span>, <span class="st">&quot;SD&quot;</span>, <span class="st">&quot;SD&quot;</span>, <span class="st">&quot;SD&quot;</span>),
    <span class="dt">post_mode =</span> pm,
    <span class="dt">lower     =</span> int[ ,<span class="st">&quot;lower&quot;</span>],
    <span class="dt">upper     =</span> int[ ,<span class="st">&quot;upper&quot;</span>],
    <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>
    ))
}

<span class="kw">getCred</span>(sel_grads_mcmc_post %&gt;%<span class="st"> </span><span class="kw">filter</span>(Year ==<span class="st"> &quot;2004&quot;</span>))</code></pre>
<pre><code>## Source: local data frame [6 x 6]
## 
##               Year   variable standardization post_mode    lower   upper
## aggression    2004 Aggression            None  -0.30391 -0.76486 0.14086
## activity      2004   Activity            None   0.03346 -0.31909 0.66905
## docility      2004   Docility            None   0.05488 -0.06433 0.11222
## aggression_sy 2004 Aggression              SD  -0.24452 -0.80615 0.07615
## activity_sy   2004   Activity              SD   0.01654 -0.35851 0.62341
## docility_sy   2004   Docility              SD   0.20932 -0.25839 0.51523</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">sel_grads_mcmc &lt;-<span class="st"> </span>sel_grads_mcmc_post %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">do</span>(<span class="kw">getCred</span>(<span class="dt">x =</span> ., <span class="dt">sig =</span> <span class="fl">0.05</span>))

sel_grads_mcmc$upper_sig_star &lt;-<span class="st"> &quot;&quot;</span>
sel_grads_mcmc$lower_sig_star &lt;-<span class="st"> &quot;&quot;</span>
sel_grads_mcmc$upper_sig_star[sel_grads_mcmc$post_mode &gt;<span class="st"> </span><span class="dv">0</span> &amp;
<span class="st">  </span>sel_grads_mcmc$lower &gt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;*&quot;</span>
sel_grads_mcmc$lower_sig_star[sel_grads_mcmc$post_mode &lt;<span class="st"> </span><span class="dv">0</span> &amp;
<span class="st">  </span>sel_grads_mcmc$upper &lt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;*&quot;</span>

<span class="kw">save</span>(sel_grads_mcmc, sel_grads_mcmc_post, getCred,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/sel_grads_mcmc.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_mcmc.RData&quot;</span>)

N &lt;-<span class="st"> </span>fit_raneff_data %&gt;%
<span class="st">  </span><span class="kw">filter</span>(type ==<span class="st"> &quot;blup&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="kw">n</span>(), <span class="dt">doc_mean =</span> <span class="kw">mean</span>(docility, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))

<span class="co"># Format for table</span>
sgt &lt;-<span class="st"> </span>sel_grads_mcmc
sgt$sig_star &lt;-<span class="st"> &quot;&quot;</span>
sgt$sig_star[sgt$post_mode &gt;<span class="st"> </span><span class="dv">0</span> &amp;<span class="st"> </span>sgt$lower &gt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;*&quot;</span>
sgt$sig_star[sgt$post_mode &lt;<span class="st"> </span><span class="dv">0</span> &amp;<span class="st"> </span>sgt$upper &lt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;*&quot;</span>
sgt$post_mode &lt;-<span class="st"> </span><span class="kw">format</span>(<span class="kw">round</span>(sgt$post_mode, <span class="dt">digits =</span> <span class="dv">2</span>), <span class="dt">digits =</span> <span class="dv">1</span>,
  <span class="dt">nsmall =</span> <span class="dv">2</span>)
sgt$lower     &lt;-<span class="st"> </span><span class="kw">format</span>(<span class="kw">round</span>(sgt$lower,     <span class="dt">digits =</span> <span class="dv">2</span>), <span class="dt">digits =</span> <span class="dv">1</span>,
  <span class="dt">nsmall =</span> <span class="dv">2</span>)
sgt$upper     &lt;-<span class="st"> </span><span class="kw">format</span>(<span class="kw">round</span>(sgt$upper,     <span class="dt">digits =</span> <span class="dv">2</span>), <span class="dt">digits =</span> <span class="dv">1</span>,
  <span class="dt">nsmall =</span> <span class="dv">2</span>)
sgt$coef      &lt;-<span class="st"> </span><span class="kw">paste</span>(sgt$post_mode, <span class="st">&quot; (&quot;</span>, sgt$lower, <span class="st">&quot; to &quot;</span>, sgt$upper,<span class="st">&quot;)&quot;</span>,
  sgt$sig_star, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)

sgt_agg &lt;-<span class="st"> </span><span class="kw">filter</span>(sgt, variable ==<span class="st"> &quot;Aggression&quot;</span>, standardization ==<span class="st"> &quot;None&quot;</span>)
sgt_act &lt;-<span class="st"> </span><span class="kw">filter</span>(sgt, variable ==<span class="st"> &quot;Activity&quot;</span>,   standardization ==<span class="st"> &quot;None&quot;</span>)
sgt_doc &lt;-<span class="st"> </span><span class="kw">filter</span>(sgt, variable ==<span class="st"> &quot;Docility&quot;</span>,   standardization ==<span class="st"> &quot;None&quot;</span>)

sgt_agg_sd &lt;-<span class="st"> </span><span class="kw">filter</span>(sgt, variable ==<span class="st"> &quot;Aggression&quot;</span>, standardization ==<span class="st"> &quot;SD&quot;</span>)
sgt_act_sd &lt;-<span class="st"> </span><span class="kw">filter</span>(sgt, variable ==<span class="st"> &quot;Activity&quot;</span>,   standardization ==<span class="st"> &quot;SD&quot;</span>)
sgt_doc_sd &lt;-<span class="st"> </span><span class="kw">filter</span>(sgt, variable ==<span class="st"> &quot;Docility&quot;</span>,   standardization ==<span class="st"> &quot;SD&quot;</span>)


doc_post_mode &lt;-<span class="st"> </span>sel_grads_mcmc %&gt;%<span class="st"> </span><span class="kw">filter</span>(standardization ==<span class="st"> &quot;None&quot;</span> &amp;<span class="st"> </span>variable ==<span class="st"> &quot;Docility&quot;</span>) 
doc_post_mode$post_mode_m &lt;-<span class="st"> </span>doc_post_mode$post_mode *<span class="st"> </span>N$doc_mean
doc_post_mode$post_mode_m &lt;-<span class="st"> </span><span class="kw">format</span>(<span class="kw">round</span>(doc_post_mode$post_mode_m, <span class="dt">digits =</span> <span class="dv">2</span>), <span class="dt">digits =</span> <span class="dv">1</span>, <span class="dt">nsmall =</span> <span class="dv">2</span>)

<span class="kw">pandoc.table</span>(
  <span class="kw">data.frame</span>(<span class="dt">Year =</span> N$Year, <span class="dt">N =</span> N[ ,<span class="dv">2</span>], <span class="dt">Aggression =</span> sgt_agg$coef,
    <span class="dt">Acitivity =</span> sgt_act$coef, <span class="dt">Docility =</span> sgt_doc$coef
  ),
  <span class="dt">caption =</span> <span class="st">&quot;Non-standardized selection gradients (accounting for behavioural uncertainty).&quot;</span>
  )</code></pre>
<table>
<caption>Non-standardized selection gradients (accounting for behavioural uncertainty). (continued below)</caption>
<col width="9%" />
<col width="5%" />
<col width="30%" />
<col width="31%" />
<thead>
<tr class="header">
<th align="right">Year</th>
<th align="right">N</th>
<th align="right">Aggression</th>
<th align="right">Acitivity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2003</td>
<td align="right">18</td>
<td align="right">0.03 (-0.92 to 0.84)</td>
<td align="right">0.45 (-0.17 to 1.32)</td>
</tr>
<tr class="even">
<td align="right">2004</td>
<td align="right">26</td>
<td align="right">-0.30 (-0.76 to 0.14)</td>
<td align="right">0.03 (-0.32 to 0.67)</td>
</tr>
<tr class="odd">
<td align="right">2005</td>
<td align="right">50</td>
<td align="right">-0.18 (-0.45 to 0.10)</td>
<td align="right">0.13 (-0.16 to 0.40)</td>
</tr>
<tr class="even">
<td align="right">2006</td>
<td align="right">48</td>
<td align="right">0.39 (-0.04 to 0.79)</td>
<td align="right">0.08 (-0.39 to 0.45)</td>
</tr>
<tr class="odd">
<td align="right">2007</td>
<td align="right">40</td>
<td align="right">0.00 (-0.35 to 0.36)</td>
<td align="right">0.11 (-0.22 to 0.42)</td>
</tr>
<tr class="even">
<td align="right">2008</td>
<td align="right">45</td>
<td align="right">0.44 (-0.12 to 0.95)</td>
<td align="right">-0.26 (-0.75 to 0.40)</td>
</tr>
<tr class="odd">
<td align="right">2009</td>
<td align="right">35</td>
<td align="right">0.12 (-0.33 to 0.58)</td>
<td align="right">-0.58 (-0.93 to -0.02)*</td>
</tr>
<tr class="even">
<td align="right">2010</td>
<td align="right">34</td>
<td align="right">0.06 (-0.30 to 0.35)</td>
<td align="right">0.03 (-0.26 to 0.30)</td>
</tr>
</tbody>
</table>
<table>
<col width="31%" />
<thead>
<tr class="header">
<th align="right">Docility</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-0.08 (-0.26 to 0.06)</td>
</tr>
<tr class="even">
<td align="right">0.05 (-0.06 to 0.11)</td>
</tr>
<tr class="odd">
<td align="right">0.03 (-0.02 to 0.07)</td>
</tr>
<tr class="even">
<td align="right">-0.04 (-0.12 to 0.00)</td>
</tr>
<tr class="odd">
<td align="right">0.00 (-0.05 to 0.05)</td>
</tr>
<tr class="even">
<td align="right">-0.02 (-0.08 to 0.05)</td>
</tr>
<tr class="odd">
<td align="right">-0.06 (-0.11 to -0.01)*</td>
</tr>
<tr class="even">
<td align="right">-0.05 (-0.08 to -0.02)*</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pandoc.table</span>(
  <span class="kw">data.frame</span>(<span class="dt">Year =</span> N$Year, <span class="dt">N =</span> N[ ,<span class="dv">2</span>], <span class="dt">Aggression =</span> sgt_agg_sd$coef,
    <span class="dt">Acitivity =</span> sgt_act_sd$coef, <span class="dt">Docility =</span> sgt_doc_sd$coef
  ),
  <span class="dt">caption =</span> <span class="st">&quot;SD-standardized selection gradients (accounting for behavioural uncertainty).&quot;</span>
  )</code></pre>
<table>
<caption>SD-standardized selection gradients (accounting for behavioural uncertainty). (continued below)</caption>
<col width="9%" />
<col width="5%" />
<col width="30%" />
<col width="30%" />
<thead>
<tr class="header">
<th align="center">Year</th>
<th align="center">N</th>
<th align="center">Aggression</th>
<th align="center">Acitivity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">2003</td>
<td align="center">18</td>
<td align="center">0.03 (-0.76 to 0.71)</td>
<td align="center">0.79 (-0.24 to 1.38)</td>
</tr>
<tr class="even">
<td align="center">2004</td>
<td align="center">26</td>
<td align="center">-0.24 (-0.81 to 0.08)</td>
<td align="center">0.02 (-0.36 to 0.62)</td>
</tr>
<tr class="odd">
<td align="center">2005</td>
<td align="center">50</td>
<td align="center">-0.19 (-0.47 to 0.07)</td>
<td align="center">0.16 (-0.12 to 0.41)</td>
</tr>
<tr class="even">
<td align="center">2006</td>
<td align="center">48</td>
<td align="center">0.39 (-0.04 to 0.72)</td>
<td align="center">0.08 (-0.37 to 0.44)</td>
</tr>
<tr class="odd">
<td align="center">2007</td>
<td align="center">40</td>
<td align="center">-0.01 (-0.32 to 0.34)</td>
<td align="center">0.09 (-0.23 to 0.42)</td>
</tr>
<tr class="even">
<td align="center">2008</td>
<td align="center">45</td>
<td align="center">0.46 (-0.06 to 0.95)</td>
<td align="center">-0.18 (-0.72 to 0.40)</td>
</tr>
<tr class="odd">
<td align="center">2009</td>
<td align="center">35</td>
<td align="center">0.16 (-0.29 to 0.59)</td>
<td align="center">-0.55 (-0.92 to 0.01)</td>
</tr>
<tr class="even">
<td align="center">2010</td>
<td align="center">34</td>
<td align="center">-0.04 (-0.27 to 0.32)</td>
<td align="center">0.04 (-0.25 to 0.30)</td>
</tr>
</tbody>
</table>
<table>
<col width="31%" />
<thead>
<tr class="header">
<th align="center">Docility</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">-0.38 (-1.12 to 0.31)</td>
</tr>
<tr class="even">
<td align="center">0.21 (-0.26 to 0.52)</td>
</tr>
<tr class="odd">
<td align="center">0.10 (-0.09 to 0.34)</td>
</tr>
<tr class="even">
<td align="center">-0.25 (-0.58 to -0.03)*</td>
</tr>
<tr class="odd">
<td align="center">0.01 (-0.23 to 0.23)</td>
</tr>
<tr class="even">
<td align="center">-0.08 (-0.37 to 0.25)</td>
</tr>
<tr class="odd">
<td align="center">-0.30 (-0.53 to -0.05)*</td>
</tr>
<tr class="even">
<td align="center">-0.23 (-0.35 to -0.10)*</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pandoc.table</span>(
  <span class="kw">data.frame</span>(<span class="dt">Year =</span> N$Year, <span class="dt">N =</span> N[ ,<span class="dv">2</span>], <span class="dt">mean_trait =</span> N$doc_mean, <span class="dt">Docility =</span> doc_post_mode$post_mode_m
  ),
  <span class="dt">caption =</span> <span class="st">&quot;Mean standardized selection gradients (accounting for behavioural uncertainty).&quot;</span>
  )</code></pre>
<table>
<caption>Mean standardized selection gradients (accounting for behavioural uncertainty).</caption>
<col width="9%" />
<col width="5%" />
<col width="18%" />
<col width="13%" />
<thead>
<tr class="header">
<th align="center">Year</th>
<th align="center">N</th>
<th align="center">mean_trait</th>
<th align="center">Docility</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">2003</td>
<td align="center">18</td>
<td align="center">17.29</td>
<td align="center">-1.46</td>
</tr>
<tr class="even">
<td align="center">2004</td>
<td align="center">26</td>
<td align="center">17.31</td>
<td align="center">0.95</td>
</tr>
<tr class="odd">
<td align="center">2005</td>
<td align="center">50</td>
<td align="center">17.25</td>
<td align="center">0.55</td>
</tr>
<tr class="even">
<td align="center">2006</td>
<td align="center">48</td>
<td align="center">16.77</td>
<td align="center">-0.70</td>
</tr>
<tr class="odd">
<td align="center">2007</td>
<td align="center">40</td>
<td align="center">16.77</td>
<td align="center">0.05</td>
</tr>
<tr class="even">
<td align="center">2008</td>
<td align="center">45</td>
<td align="center">16.9</td>
<td align="center">-0.27</td>
</tr>
<tr class="odd">
<td align="center">2009</td>
<td align="center">35</td>
<td align="center">16.79</td>
<td align="center">-0.97</td>
</tr>
<tr class="even">
<td align="center">2010</td>
<td align="center">34</td>
<td align="center">17.19</td>
<td align="center">-0.87</td>
</tr>
</tbody>
</table>
<h3 id="plots">Plots</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_mcmc_post.RData&quot;</span>)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(dplyr)

sel_grads_mcmc &lt;-<span class="st"> </span>sel_grads_mcmc_post %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%<span class="st"> </span><span class="kw">do</span>(<span class="kw">getCred</span>(<span class="dt">x =</span> ., <span class="dt">sig =</span> <span class="fl">0.05</span>))

sel_grads_mcmc$upper_sig_star &lt;-<span class="st"> &quot;&quot;</span>
sel_grads_mcmc$lower_sig_star &lt;-<span class="st"> &quot;&quot;</span>
sel_grads_mcmc$upper_sig_star[sel_grads_mcmc$post_mode &gt;<span class="st"> </span><span class="dv">0</span> &amp;
<span class="st">  </span>sel_grads_mcmc$lower &gt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;*&quot;</span>
sel_grads_mcmc$lower_sig_star[sel_grads_mcmc$post_mode &lt;<span class="st"> </span><span class="dv">0</span> &amp;
<span class="st">  </span>sel_grads_mcmc$upper &lt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;*&quot;</span>

p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sel_grads_mcmc, standardization ==<span class="st"> &quot;SD&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> post_mode, <span class="dt">group =</span> variable))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">size =</span> <span class="fl">0.25</span>) <span class="co"># Line at y = 0</span>
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymax =</span> upper, <span class="dt">ymin =</span> lower),
  <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>), <span class="dt">width =</span> <span class="fl">0.4</span>, <span class="dt">size =</span> <span class="fl">0.4</span>)
<span class="co"># Houle data percentiles</span>
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">c</span>(<span class="fl">0.2975</span>, -<span class="fl">0.2975</span>), <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">0.4</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> variable, <span class="dt">fill =</span> variable),
  <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>), <span class="dt">size =</span> <span class="dv">3</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_shape_manual</span>(<span class="dt">name =</span> <span class="st">&quot;B&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">24</span>, <span class="dv">21</span>, <span class="dv">22</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="dt">name =</span> <span class="st">&quot;B&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;white&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_color_manual</span>(<span class="dt">name =</span> <span class="st">&quot;B&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) 
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Posterior Mode ± 0.95 Credible Interval&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.92</span>, <span class="fl">0.86</span>),
  <span class="dt">legend.background =</span> <span class="kw">element_blank</span>(), <span class="dt">legend.key.size =</span> <span class="kw">unit</span>(<span class="fl">0.4</span>, <span class="st">&quot;cm&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Helvetica&quot;</span>,
                                 <span class="dt">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="dt">size =</span> <span class="dv">18</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.key =</span> <span class="kw">element_blank</span>())
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">strip.background =</span> <span class="kw">element_blank</span>())
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>())
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.border =</span> <span class="kw">element_blank</span>())
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> upper, <span class="dt">group =</span> variable,
  <span class="dt">label =</span> upper_sig_star), <span class="dt">vjust =</span> -<span class="fl">0.3</span>,
  <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>), <span class="dt">size =</span> <span class="dv">5</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> lower, <span class="dt">group =</span> variable,
  <span class="dt">label =</span> lower_sig_star), <span class="dt">vjust =</span> <span class="fl">1.3</span>,
  <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>), <span class="dt">size =</span> <span class="dv">5</span>)
p_sel_grad_MCMC &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylim</span>(<span class="kw">c</span>(-<span class="fl">1.1</span>,<span class="fl">1.4</span>))

<span class="kw">pdf</span>(<span class="dt">file =</span> <span class="st">&quot;figure/04_sg_mcmc_SD_print.pdf&quot;</span>, <span class="dt">width =</span> <span class="fl">4.33</span>, <span class="dt">height =</span> <span class="dv">3</span>)
p_sel_grad_MCMC</code></pre>
<pre><code>## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead</code></pre>
<pre><code>## Warning: Removed 4 rows containing missing values (geom_path).
## Warning: Removed 1 rows containing missing values (geom_text).</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dev.off</span>()</code></pre>
<pre><code>## pdf 
##   2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">p_sel_grad_MCMC</code></pre>
<pre><code>## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead</code></pre>
<pre><code>## Warning: Removed 4 rows containing missing values (geom_path).
## Warning: Removed 1 rows containing missing values (geom_text).</code></pre>
<div class="figure">
<img src="figure/04_sg_mcmc_SD.png" alt="SD Standardized Selection Gradients" /><p class="caption">SD Standardized Selection Gradients</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_mcmc_post.RData&quot;</span>)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(dplyr)

sel_grads_mcmc &lt;-<span class="st"> </span>sel_grads_mcmc_post %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%<span class="st"> </span><span class="kw">do</span>(<span class="kw">getCred</span>(<span class="dt">x =</span> ., <span class="dt">sig =</span> <span class="fl">0.05</span>))

sel_grads_mcmc$upper_sig_star &lt;-<span class="st"> &quot;&quot;</span>
sel_grads_mcmc$lower_sig_star &lt;-<span class="st"> &quot;&quot;</span>
sel_grads_mcmc$upper_sig_star[sel_grads_mcmc$post_mode &gt;<span class="st"> </span><span class="dv">0</span> &amp;
<span class="st">  </span>sel_grads_mcmc$lower &gt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;*&quot;</span>
sel_grads_mcmc$lower_sig_star[sel_grads_mcmc$post_mode &lt;<span class="st"> </span><span class="dv">0</span> &amp;
<span class="st">  </span>sel_grads_mcmc$upper &lt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;*&quot;</span>

p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sel_grads_mcmc, standardization ==<span class="st"> &quot;None&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> post_mode, <span class="dt">group =</span> variable)
)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">size =</span> <span class="fl">0.25</span>) <span class="co"># Line at y = 0</span>
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymax =</span> upper, <span class="dt">ymin =</span> lower),
  <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>), <span class="dt">width =</span> <span class="fl">0.4</span>, <span class="dt">size =</span> <span class="fl">0.4</span>)
<span class="co"># Houle data percentiles</span>
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">c</span>(<span class="fl">0.2975</span>, -<span class="fl">0.2975</span>), <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">0.4</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> variable, <span class="dt">fill =</span> variable),
  <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>), <span class="dt">size =</span> <span class="dv">3</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_shape_manual</span>(<span class="dt">name =</span> <span class="st">&quot;B&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">24</span>, <span class="dv">21</span>, <span class="dv">22</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="dt">name =</span> <span class="st">&quot;B&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;white&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_color_manual</span>(<span class="dt">name =</span> <span class="st">&quot;B&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) 
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Posterior Mode ± 0.95 Credible Interval&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.92</span>, <span class="fl">0.86</span>),
  <span class="dt">legend.background =</span> <span class="kw">element_blank</span>(), <span class="dt">legend.key.size =</span> <span class="kw">unit</span>(<span class="fl">0.4</span>, <span class="st">&quot;cm&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Helvetica&quot;</span>,
                                 <span class="dt">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="dt">size =</span> <span class="dv">18</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.key =</span> <span class="kw">element_blank</span>())
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">strip.background =</span> <span class="kw">element_blank</span>())
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>())
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.border =</span> <span class="kw">element_blank</span>())
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> upper, <span class="dt">group =</span> variable,
  <span class="dt">label =</span> upper_sig_star), <span class="dt">vjust =</span> -<span class="fl">0.3</span>,
  <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>), <span class="dt">size =</span> <span class="dv">5</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> lower, <span class="dt">group =</span> variable,
  <span class="dt">label =</span> lower_sig_star), <span class="dt">vjust =</span> <span class="fl">1.3</span>,
  <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>), <span class="dt">size =</span> <span class="dv">5</span>)
p_sel_grad_MCMC &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylim</span>(<span class="kw">c</span>(-<span class="fl">1.1</span>,<span class="fl">1.4</span>))

<span class="kw">pdf</span>(<span class="dt">file =</span> <span class="st">&quot;figure/04_sg_mcmc_NS_print.pdf&quot;</span>, <span class="dt">width =</span> <span class="fl">4.33</span>, <span class="dt">height =</span> <span class="dv">3</span>)
p_sel_grad_MCMC</code></pre>
<pre><code>## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dev.off</span>()</code></pre>
<pre><code>## pdf 
##   2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">p_sel_grad_MCMC</code></pre>
<pre><code>## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead</code></pre>
<div class="figure">
<img src="figure/04_sg_mcmc_NS.png" alt="Non-standardized Selection Gradients" /><p class="caption">Non-standardized Selection Gradients</p>
</div>
<h3 id="correlations">Correlations</h3>
<pre class="sourceCode r"><code class="sourceCode r">sel_grads_mcmc_flat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">Aggression =</span> <span class="kw">filter</span>(sel_grads_mcmc, standardization ==<span class="st"> &quot;SD&quot;</span>,
   variable ==<span class="st"> &quot;Aggression&quot;</span>)$post_mode,
  <span class="dt">Agg_upper  =</span> <span class="kw">filter</span>(sel_grads_mcmc, standardization ==<span class="st"> &quot;SD&quot;</span>,
   variable ==<span class="st"> &quot;Aggression&quot;</span>)$upper,
  <span class="dt">Agg_lower  =</span> <span class="kw">filter</span>(sel_grads_mcmc, standardization ==<span class="st"> &quot;SD&quot;</span>,
   variable ==<span class="st"> &quot;Aggression&quot;</span>)$lower,
  <span class="dt">Activity   =</span> <span class="kw">filter</span>(sel_grads_mcmc, standardization ==<span class="st"> &quot;SD&quot;</span>,
   variable ==<span class="st"> &quot;Activity&quot;</span>)$post_mode,
  <span class="dt">Act_upper  =</span> <span class="kw">filter</span>(sel_grads_mcmc, standardization ==<span class="st"> &quot;SD&quot;</span>,
   variable ==<span class="st"> &quot;Activity&quot;</span>)$upper,
  <span class="dt">Act_lower  =</span> <span class="kw">filter</span>(sel_grads_mcmc, standardization ==<span class="st"> &quot;SD&quot;</span>,
   variable ==<span class="st"> &quot;Activity&quot;</span>)$lower,
  <span class="dt">Docility   =</span> <span class="kw">filter</span>(sel_grads_mcmc, standardization ==<span class="st"> &quot;SD&quot;</span>,
   variable ==<span class="st"> &quot;Docility&quot;</span>)$post_mode,
  <span class="dt">Doc_upper  =</span> <span class="kw">filter</span>(sel_grads_mcmc, standardization ==<span class="st"> &quot;SD&quot;</span>,
   variable ==<span class="st"> &quot;Docility&quot;</span>)$upper,
  <span class="dt">Doc_lower  =</span> <span class="kw">filter</span>(sel_grads_mcmc, standardization ==<span class="st"> &quot;SD&quot;</span>,
   variable ==<span class="st"> &quot;Docility&quot;</span>)$lower
)

cor.behav &lt;-<span class="st"> </span>function(x, y){
  ct &lt;-<span class="st"> </span><span class="kw">cor.test</span>(x, y)
  out &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">est =</span> ct$estimate, <span class="dt">lower =</span> ct$conf.int[<span class="dv">1</span>],
    <span class="dt">upper =</span> ct$conf.int[<span class="dv">2</span>], <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
  out &lt;-<span class="st"> </span><span class="kw">round</span>(out, <span class="dt">digits =</span> <span class="dv">2</span>)
  out$print &lt;-<span class="st"> </span><span class="kw">paste</span>(out$est, <span class="st">&quot; (&quot;</span>, out$lower, <span class="st">&quot;, &quot;</span>, out$upper, <span class="st">&quot;)&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
}

cor_agg_act &lt;-<span class="st"> </span><span class="kw">cor.behav</span>(sel_grads_mcmc_flat$Aggression, 
  sel_grads_mcmc_flat$Activity)
cor_agg_doc &lt;-<span class="st"> </span><span class="kw">cor.behav</span>(sel_grads_mcmc_flat$Aggression, 
  sel_grads_mcmc_flat$Docility)
cor_doc_act &lt;-<span class="st"> </span><span class="kw">cor.behav</span>(sel_grads_mcmc_flat$Docility, 
  sel_grads_mcmc_flat$Activity)</code></pre>
<h4 id="aggression-and-activity">Aggression and Activity</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> sel_grads_mcmc_flat, <span class="kw">aes</span>(<span class="dt">x =</span> Activity, <span class="dt">y =</span> Aggression))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Aggression&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Activity&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> Act_lower, <span class="dt">xmax =</span> Act_upper),
  <span class="dt">height =</span> <span class="fl">0.07</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Agg_lower, <span class="dt">ymax =</span> Agg_upper),
  <span class="dt">width =</span> <span class="fl">0.07</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">x =</span> <span class="fl">0.25</span>, <span class="dt">y =</span> <span class="fl">1.2</span>,
  <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;r = &quot;</span>, cor_agg_act, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>))
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/04_agg_act_mcmc.png" />
</div>
<h4 id="aggression-and-docility">Aggression and Docility</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> sel_grads_mcmc_flat, <span class="kw">aes</span>(<span class="dt">y =</span> Aggression, <span class="dt">x =</span> Docility))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Aggression&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Docility&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> Doc_lower, <span class="dt">xmax =</span> Doc_upper),
  <span class="dt">height =</span> <span class="fl">0.07</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Agg_lower, <span class="dt">ymax =</span> Agg_upper),
  <span class="dt">width =</span> <span class="fl">0.03</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">x =</span> -<span class="fl">0.3</span>, <span class="dt">y =</span> <span class="fl">1.2</span>,
  <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;r = &quot;</span>, cor_agg_doc, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>))
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/04_agg_doc_mcmc.png" />
</div>
<h4 id="activity-and-docility">Activity and Docility</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> sel_grads_mcmc_flat, <span class="kw">aes</span>(<span class="dt">x =</span> Activity, <span class="dt">y =</span> Docility))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Activity&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Docility&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Doc_lower, <span class="dt">ymax =</span> Doc_upper),
  <span class="dt">width =</span> <span class="fl">0.07</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> Act_lower, <span class="dt">xmax =</span> Act_upper),
  <span class="dt">height =</span> <span class="fl">0.03</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="fl">0.6</span>,
  <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;r = &quot;</span>, cor_doc_act, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>))
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/04_act_doc_mcmc.png" />
</div>
<h3 id="summary-stats">Summary Stats</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
sign_change &lt;-<span class="st"> </span>function(x){
  <span class="co"># sign changes calculated as the number of changes in direction between </span>
  <span class="co"># successive years relative to n−1</span>
  s &lt;-<span class="st"> </span><span class="kw">sign</span>(x)
  <span class="kw">sum</span>(s[<span class="dv">1</span>:(<span class="kw">length</span>(s)-<span class="dv">1</span>)] !=<span class="st"> </span>s[-<span class="dv">1</span>])/(<span class="kw">length</span>(s)-<span class="dv">1</span>)
}
se &lt;-<span class="st"> </span>function(lower, upper){
  (upper -<span class="st"> </span>lower) /<span class="st"> </span><span class="fl">3.92</span>
}

sum_stats_mcmc &lt;-<span class="st"> </span>sel_grads_mcmc %&gt;%
<span class="kw">filter</span>(standardization ==<span class="st"> &quot;SD&quot;</span>) %&gt;%
<span class="kw">group_by</span>(variable, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="kw">summarise</span>(
  <span class="dt">mean_abs_b =</span> <span class="kw">mean</span>(<span class="kw">abs</span>(post_mode)),
  <span class="dt">abs_mean_b =</span> <span class="kw">abs</span>(<span class="kw">mean</span>(post_mode)),
  <span class="dt">sd_b =</span> <span class="kw">sd</span>(post_mode),
  <span class="dt">mean_se_b =</span> <span class="kw">mean</span>(<span class="kw">se</span>(lower, upper)),
  <span class="dt">freq_sign =</span> <span class="kw">sign_change</span>(post_mode),
  <span class="dt">mean_cv =</span> <span class="kw">mean</span>(<span class="kw">se</span>(lower, upper) /<span class="st"> </span><span class="kw">abs</span>(post_mode))
  )
sum_stats_mcmc[ ,<span class="dv">2</span>:<span class="dv">6</span>] &lt;-<span class="st"> </span><span class="kw">round</span>(sum_stats_mcmc[ ,<span class="dv">2</span>:<span class="dv">6</span>], <span class="dv">2</span>)
<span class="kw">pandoc.table</span>(sum_stats_mcmc)</code></pre>
<table>
<caption>Table continues below</caption>
<col width="15%" />
<col width="18%" />
<col width="18%" />
<col width="9%" />
<col width="15%" />
<thead>
<tr class="header">
<th align="center">variable</th>
<th align="center">mean_abs_b</th>
<th align="center">abs_mean_b</th>
<th align="center">sd_b</th>
<th align="center">mean_se_b</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Activity</td>
<td align="center">0.24</td>
<td align="center">0.05</td>
<td align="center">0.37</td>
<td align="center">0.23</td>
</tr>
<tr class="even">
<td align="center">Aggression</td>
<td align="center">0.19</td>
<td align="center">0.07</td>
<td align="center">0.25</td>
<td align="center">0.22</td>
</tr>
<tr class="odd">
<td align="center">Docility</td>
<td align="center">0.2</td>
<td align="center">0.12</td>
<td align="center">0.21</td>
<td align="center">0.16</td>
</tr>
</tbody>
</table>
<table>
<col width="16%" />
<col width="12%" />
<thead>
<tr class="header">
<th align="center">freq_sign</th>
<th align="center">mean_cv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">0.29</td>
<td align="center">3.307</td>
</tr>
<tr class="even">
<td align="center">0.71</td>
<td align="center">4.002</td>
</tr>
<tr class="odd">
<td align="center">0.57</td>
<td align="center">1.845</td>
</tr>
</tbody>
</table>
<h2 id="ignoring-random-effect-uncertainty">Ignoring random effect uncertainty</h2>
<p>Calculate selection gradients from BLUPs, estimate SE using jackknifing.</p>
<h3 id="calculate-selection-gradients-1">Calculate selection gradients</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Calculate standardized selection gradients</span>
seCoeffLmer &lt;-<span class="st"> </span>function(x){
  model &lt;-<span class="st"> </span><span class="kw">lm</span>(rel_ars ~<span class="st"> </span>aggression +<span class="st"> </span>activity +<span class="st"> </span>docility, <span class="dt">data =</span> x)
  model_sy &lt;-<span class="st"> </span><span class="kw">lm</span>(rel_ars ~<span class="st"> </span>aggression_sy +<span class="st"> </span>activity_sy +<span class="st"> </span>docility_sy, <span class="dt">data =</span> x)
  mod_coefs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">coef</span>(model)[-<span class="dv">1</span>], <span class="kw">coef</span>(model_sy)[-<span class="dv">1</span>])
  sim_coefs &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">coef</span>(<span class="kw">sim</span>(model))[ ,-<span class="dv">1</span>], <span class="kw">coef</span>(<span class="kw">sim</span>(model_sy))[ ,-<span class="dv">1</span>]) ## Simulated coefficients for calculating uncertainty.
  <span class="kw">names</span>(sim_coefs) &lt;-<span class="st"> </span><span class="kw">names</span>(mod_coefs)
  sim_CI &lt;-<span class="st"> </span><span class="kw">apply</span>(sim_coefs, <span class="dv">2</span>, quantile, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)) <span class="co">#0.95 conf. int.</span>
  
docil_mean_coef &lt;-<span class="st"> </span>mod_coefs[<span class="st">&quot;docility&quot;</span>] *<span class="st"> </span><span class="kw">mean</span>(x$docility, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
  out &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
    <span class="dt">standardization =</span> <span class="kw">c</span>(<span class="st">&quot;None&quot;</span>,<span class="st">&quot;None&quot;</span>,<span class="st">&quot;None&quot;</span>,<span class="st">&quot;SD&quot;</span>,<span class="st">&quot;SD&quot;</span>,<span class="st">&quot;SD&quot;</span>,<span class="st">&quot;Mean&quot;</span>),
    <span class="dt">Year =</span> <span class="kw">as.numeric</span>(<span class="kw">rep</span>(<span class="kw">as.character</span>(x$Year[<span class="dv">1</span>]), <span class="dv">7</span>)),
    <span class="dt">variable =</span> <span class="kw">c</span>(<span class="st">&quot;Aggression&quot;</span>, <span class="st">&quot;Activity&quot;</span>, <span class="st">&quot;Docility&quot;</span>, <span class="st">&quot;Aggression&quot;</span>, 
      <span class="st">&quot;Activity&quot;</span>, <span class="st">&quot;Docility&quot;</span>, <span class="st">&quot;Docility&quot;</span>),
    <span class="dt">coefficients =</span> <span class="kw">c</span>(mod_coefs, docil_mean_coef),
    <span class="dt">lower =</span> <span class="kw">c</span>(sim_CI[<span class="dv">1</span>, ], <span class="dv">0</span>),
    <span class="dt">upper =</span> <span class="kw">c</span>(sim_CI[<span class="dv">2</span>, ],<span class="dv">0</span>)
    )
    <span class="kw">return</span>(out)
}

sel_grads_blup &lt;-<span class="st"> </span>fit_raneff_data %&gt;%
<span class="st">  </span><span class="kw">filter</span>(type ==<span class="st"> &quot;blup&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">do</span>(<span class="kw">seCoeffLmer</span>(.))
sel_grads_blup$variable &lt;-<span class="st"> </span><span class="kw">as.character</span>(sel_grads_blup$variable)
sel_grads_blup$Year &lt;-<span class="st"> </span><span class="kw">as.character</span>(sel_grads_blup$Year)
sel_grads_blup &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(sel_grads_blup)
<span class="kw">save</span>(sel_grads_blup, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/sel_grads_blup.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_blup.RData&quot;</span>)
<span class="co"># Format for table</span>
sgt &lt;-<span class="st"> </span>sel_grads_blup
sgt$sig_star &lt;-<span class="st"> &quot;&quot;</span>
sgt$sig_star[sgt$coefficients &gt;<span class="st"> </span><span class="dv">0</span> &amp;<span class="st"> </span>sgt$lower &gt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;*&quot;</span>
sgt$sig_star[sgt$coefficients &lt;<span class="st"> </span><span class="dv">0</span> &amp;<span class="st"> </span>sgt$upper &lt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;*&quot;</span>
sgt$coefficients &lt;-<span class="st"> </span><span class="kw">format</span>(<span class="kw">round</span>(sgt$coefficients, <span class="dt">digits =</span> <span class="dv">2</span>),
  <span class="dt">digits =</span> <span class="dv">1</span>, <span class="dt">nsmall =</span> <span class="dv">2</span>)
sgt$lower &lt;-<span class="st"> </span><span class="kw">format</span>(<span class="kw">round</span>(sgt$lower, <span class="dt">digits =</span> <span class="dv">2</span>),
  <span class="dt">digits =</span> <span class="dv">1</span>, <span class="dt">nsmall =</span> <span class="dv">2</span>)
sgt$upper &lt;-<span class="st"> </span><span class="kw">format</span>(<span class="kw">round</span>(sgt$upper, <span class="dt">digits =</span> <span class="dv">2</span>),
  <span class="dt">digits =</span> <span class="dv">1</span>, <span class="dt">nsmall =</span> <span class="dv">2</span>)
sgt$prb &lt;-<span class="st"> </span><span class="ot">NA</span>
sgt$coef &lt;-<span class="st"> </span><span class="kw">paste</span>(sgt$coefficients,
  <span class="st">&quot; (&quot;</span>, sgt$lower, <span class="st">&quot; to &quot;</span>, sgt$upper,<span class="st">&quot;)&quot;</span>, sgt$sig_star, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)

sgt_agg &lt;-<span class="st"> </span><span class="kw">filter</span>(sgt, standardization ==<span class="st"> &quot;None&quot;</span> &amp;<span class="st"> </span>variable ==<span class="st"> &quot;Aggression&quot;</span>)
sgt_act &lt;-<span class="st"> </span><span class="kw">filter</span>(sgt, standardization ==<span class="st"> &quot;None&quot;</span> &amp;<span class="st"> </span>variable ==<span class="st"> &quot;Activity&quot;</span>)
sgt_doc &lt;-<span class="st"> </span><span class="kw">filter</span>(sgt, standardization ==<span class="st"> &quot;None&quot;</span> &amp;<span class="st"> </span>variable ==<span class="st"> &quot;Docility&quot;</span>)

sgt_agg_sd &lt;-<span class="st"> </span><span class="kw">filter</span>(sgt, standardization ==<span class="st"> &quot;SD&quot;</span> &amp;<span class="st">  </span>variable ==<span class="st"> &quot;Aggression&quot;</span>)
sgt_act_sd &lt;-<span class="st"> </span><span class="kw">filter</span>(sgt, standardization ==<span class="st"> &quot;SD&quot;</span> &amp;<span class="st">  </span>variable ==<span class="st"> &quot;Activity&quot;</span>)
sgt_doc_sd &lt;-<span class="st"> </span><span class="kw">filter</span>(sgt, standardization ==<span class="st"> &quot;SD&quot;</span> &amp;<span class="st">  </span>variable ==<span class="st"> &quot;Docility&quot;</span>)

sgt_doc_ms &lt;-<span class="st"> </span><span class="kw">filter</span>(sgt, standardization ==<span class="st"> &quot;Mean&quot;</span> &amp;<span class="st">  </span>variable ==<span class="st"> &quot;Docility&quot;</span>)

N &lt;-<span class="st"> </span>fit_raneff_data %&gt;%
<span class="st">  </span><span class="kw">filter</span>(type ==<span class="st"> &quot;blup&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>(), <span class="dt">t_kprod =</span> <span class="kw">sum</span>(kprod), <span class="dt">t_ars =</span> <span class="kw">sum</span>(ars_all), <span class="dt">mean_docil =</span> <span class="kw">mean</span>(docility, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))

<span class="kw">pandoc.table</span>(
  <span class="kw">data.frame</span>(
    <span class="dt">Year =</span> N$Year,
    <span class="dt">Aggression =</span> sgt_agg$coef,
    <span class="dt">Activity =</span> sgt_act$coef,
    <span class="dt">Docility =</span> sgt_doc$coef
  ),
  <span class="dt">caption =</span><span class="st">&quot;Traditional selection gradients (ignoring behavioural uncertainty). Not standardized.&quot;</span>
)</code></pre>
<table>
<caption>Traditional selection gradients (ignoring behavioural uncertainty). Not standardized. (continued below)</caption>
<col width="9%" />
<col width="33%" />
<col width="33%" />
<thead>
<tr class="header">
<th align="center">Year</th>
<th align="center">Aggression</th>
<th align="center">Activity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">2003</td>
<td align="center">-0.26 (-1.66 to 0.61)</td>
<td align="center">0.90 (-0.25 to 1.76)</td>
</tr>
<tr class="even">
<td align="center">2004</td>
<td align="center">-0.75 (-1.36 to -0.05)*</td>
<td align="center">0.57 (-0.18 to 1.35)</td>
</tr>
<tr class="odd">
<td align="center">2005</td>
<td align="center">-0.56 (-1.02 to -0.06)*</td>
<td align="center">0.46 (-0.08 to 0.98)</td>
</tr>
<tr class="even">
<td align="center">2006</td>
<td align="center">0.98 ( 0.20 to 1.86)*</td>
<td align="center">-0.33 (-1.11 to 0.48)</td>
</tr>
<tr class="odd">
<td align="center">2007</td>
<td align="center">-0.09 (-0.92 to 0.49)</td>
<td align="center">0.19 (-0.53 to 0.88)</td>
</tr>
<tr class="even">
<td align="center">2008</td>
<td align="center">1.11 (-0.36 to 2.30)</td>
<td align="center">-0.60 (-1.46 to 0.94)</td>
</tr>
<tr class="odd">
<td align="center">2009</td>
<td align="center">0.75 (-0.09 to 1.39)</td>
<td align="center">-1.38 (-2.11 to -0.60)*</td>
</tr>
<tr class="even">
<td align="center">2010</td>
<td align="center">-0.03 (-0.74 to 0.67)</td>
<td align="center">0.12 (-0.54 to 0.77)</td>
</tr>
</tbody>
</table>
<table>
<col width="30%" />
<thead>
<tr class="header">
<th align="center">Docility</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">-0.11 (-0.36 to 0.10)</td>
</tr>
<tr class="even">
<td align="center">0.07 (-0.13 to 0.24)</td>
</tr>
<tr class="odd">
<td align="center">0.05 (-0.04 to 0.16)</td>
</tr>
<tr class="even">
<td align="center">-0.10 (-0.22 to 0.04)</td>
</tr>
<tr class="odd">
<td align="center">0.01 (-0.11 to 0.13)</td>
</tr>
<tr class="even">
<td align="center">-0.04 (-0.21 to 0.13)</td>
</tr>
<tr class="odd">
<td align="center">-0.12 (-0.23 to 0.00)*</td>
</tr>
<tr class="even">
<td align="center">-0.05 (-0.12 to 0.04)</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pandoc.table</span>(
  <span class="kw">data.frame</span>(
    <span class="dt">Year =</span> N$Year,
    <span class="dt">Aggression =</span> sgt_agg_sd$coef,
    <span class="dt">Activity =</span> sgt_act_sd$coef,
    <span class="dt">Docility =</span> sgt_doc_sd$coef
  ),
  <span class="dt">caption =</span><span class="st">&quot;Traditional selection gradients (ignoring behavioural uncertainty). SD-standardized.&quot;</span>
)</code></pre>
<table>
<caption>Traditional selection gradients (ignoring behavioural uncertainty). SD-standardized. (continued below)</caption>
<col width="9%" />
<col width="33%" />
<col width="33%" />
<thead>
<tr class="header">
<th align="center">Year</th>
<th align="center">Aggression</th>
<th align="center">Activity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">2003</td>
<td align="center">-0.17 (-1.25 to 0.57)</td>
<td align="center">0.86 (-0.20 to 1.96)</td>
</tr>
<tr class="even">
<td align="center">2004</td>
<td align="center">-0.62 (-1.17 to 0.22)</td>
<td align="center">0.49 (-0.37 to 1.29)</td>
</tr>
<tr class="odd">
<td align="center">2005</td>
<td align="center">-0.41 (-0.71 to -0.04)*</td>
<td align="center">0.34 (-0.10 to 0.76)</td>
</tr>
<tr class="even">
<td align="center">2006</td>
<td align="center">0.66 ( 0.13 to 1.19)*</td>
<td align="center">-0.23 (-0.96 to 0.35)</td>
</tr>
<tr class="odd">
<td align="center">2007</td>
<td align="center">-0.07 (-0.57 to 0.48)</td>
<td align="center">0.15 (-0.44 to 0.63)</td>
</tr>
<tr class="even">
<td align="center">2008</td>
<td align="center">0.78 ( 0.20 to 1.54)*</td>
<td align="center">-0.44 (-1.64 to 0.39)</td>
</tr>
<tr class="odd">
<td align="center">2009</td>
<td align="center">0.56 ( 0.05 to 1.20)*</td>
<td align="center">-1.01 (-1.84 to -0.47)*</td>
</tr>
<tr class="even">
<td align="center">2010</td>
<td align="center">-0.02 (-0.43 to 0.56)</td>
<td align="center">0.10 (-0.34 to 0.50)</td>
</tr>
</tbody>
</table>
<table>
<col width="31%" />
<thead>
<tr class="header">
<th align="center">Docility</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">-0.40 (-1.22 to 0.61)</td>
</tr>
<tr class="even">
<td align="center">0.26 (-0.29 to 1.01)</td>
</tr>
<tr class="odd">
<td align="center">0.19 (-0.11 to 0.54)</td>
</tr>
<tr class="even">
<td align="center">-0.41 (-0.92 to 0.17)</td>
</tr>
<tr class="odd">
<td align="center">0.03 (-0.47 to 0.52)</td>
</tr>
<tr class="even">
<td align="center">-0.17 (-0.81 to 0.45)</td>
</tr>
<tr class="odd">
<td align="center">-0.56 (-1.07 to -0.06)*</td>
</tr>
<tr class="even">
<td align="center">-0.21 (-0.47 to 0.16)</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pandoc.table</span>(
  <span class="kw">data.frame</span>(
    <span class="dt">Year =</span> N$Year,
    <span class="dt">Docility =</span> sgt_doc_ms$coefficients,
    <span class="dt">mean =</span> N$mean_docil
  ),
  <span class="dt">caption =</span><span class="st">&quot;Traditional selection gradients (ignoring behavioural uncertainty). Mean-standardized.&quot;</span>
)</code></pre>
<table>
<caption>Traditional selection gradients (ignoring behavioural uncertainty). Mean-standardized.</caption>
<col width="9%" />
<col width="15%" />
<col width="8%" />
<thead>
<tr class="header">
<th align="center">Year</th>
<th align="center">Docility</th>
<th align="center">mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">2003</td>
<td align="center">-1.86</td>
<td align="center">17.29</td>
</tr>
<tr class="even">
<td align="center">2004</td>
<td align="center">1.25</td>
<td align="center">17.31</td>
</tr>
<tr class="odd">
<td align="center">2005</td>
<td align="center">0.88</td>
<td align="center">17.25</td>
</tr>
<tr class="even">
<td align="center">2006</td>
<td align="center">-1.72</td>
<td align="center">16.77</td>
</tr>
<tr class="odd">
<td align="center">2007</td>
<td align="center">0.12</td>
<td align="center">16.77</td>
</tr>
<tr class="even">
<td align="center">2008</td>
<td align="center">-0.63</td>
<td align="center">16.9</td>
</tr>
<tr class="odd">
<td align="center">2009</td>
<td align="center">-2.04</td>
<td align="center">16.79</td>
</tr>
<tr class="even">
<td align="center">2010</td>
<td align="center">-0.79</td>
<td align="center">17.19</td>
</tr>
</tbody>
</table>
<h3 id="plot">Plot</h3>
<p><strong>Female Linear Selection Gradients ARS</strong><br />Linear selection gradients ± 95% credible intervals for female behavioral traits on annual reproductive success.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_blup.RData&quot;</span>)
sel_grads_blup$post_mode &lt;-<span class="st"> </span>sel_grads_blup$coefficients
sel_grads_blup$upper_sig_star &lt;-<span class="st"> &quot;&quot;</span>
sel_grads_blup$lower_sig_star &lt;-<span class="st"> &quot;&quot;</span>
sel_grads_blup$upper_sig_star[sel_grads_blup$coefficients &gt;<span class="st"> </span><span class="dv">0</span> &amp;<span class="st"> </span>
<span class="st">  </span>sel_grads_blup$lower &gt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;*&quot;</span>
sel_grads_blup$lower_sig_star[sel_grads_blup$coefficients &lt;<span class="st"> </span><span class="dv">0</span> &amp;
<span class="st">  </span>sel_grads_blup$upper &lt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;*&quot;</span>
sel_grads_blup$upper_sig_01_star &lt;-<span class="st"> &quot;&quot;</span>
sel_grads_blup$lower_sig_01_star &lt;-<span class="st"> &quot;&quot;</span>
sel_grads_blup$upper_sig_01_star[sel_grads_blup$coefficients &gt;<span class="st"> </span><span class="dv">0</span>
  &amp;<span class="st"> </span>sel_grads_blup$lower_1 &gt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;.&quot;</span>
sel_grads_blup$lower_sig_01_star[sel_grads_blup$coefficients &lt;<span class="st"> </span><span class="dv">0</span>
  &amp;<span class="st"> </span>sel_grads_blup$upper_1 &lt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;.&quot;</span>
sel_grads_blup$upper_sig_01_star[sel_grads_blup$coefficients &gt;<span class="st"> </span><span class="dv">0</span>
  &amp;<span class="st"> </span>sel_grads_blup$lower &gt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;&quot;</span>
sel_grads_blup$lower_sig_01_star[sel_grads_blup$coefficients &lt;<span class="st"> </span><span class="dv">0</span>
  &amp;<span class="st"> </span>sel_grads_blup$upper &lt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> &quot;&quot;</span>

<span class="kw">pdf</span>(<span class="dt">file =</span> <span class="st">&quot;figure/04_sg_blup_SD_print.pdf&quot;</span>, <span class="dt">width =</span> <span class="fl">4.33</span>, <span class="dt">height =</span> <span class="dv">3</span>)
p &lt;-<span class="st"> </span>p_sel_grad_MCMC %+%<span class="st"> </span><span class="kw">filter</span>(sel_grads_blup, standardization ==<span class="st"> &quot;SD&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Coefficient ± 0.95 Confidence Interval&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> upper, <span class="dt">group =</span> variable,
  <span class="dt">label =</span> upper_sig_01_star), <span class="dt">vjust =</span> -<span class="fl">0.3</span>,
  <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>), <span class="dt">size =</span> <span class="dv">7</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> lower, <span class="dt">group =</span> variable,
  <span class="dt">label =</span> lower_sig_01_star), <span class="dt">vjust =</span>  <span class="fl">0.5</span>,
  <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>), <span class="dt">size =</span> <span class="dv">7</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> upper, <span class="dt">group =</span> variable,
  <span class="dt">label =</span> upper_sig_star), <span class="dt">vjust =</span> -<span class="fl">0.3</span>,
  <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>), <span class="dt">size =</span> <span class="dv">5</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> lower, <span class="dt">group =</span> variable,
  <span class="dt">label =</span> lower_sig_star), <span class="dt">vjust =</span>  <span class="fl">1.3</span>,
  <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>), <span class="dt">size =</span> <span class="dv">5</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylim</span>(<span class="kw">c</span>(-<span class="dv">2</span>, <span class="dv">2</span>))</code></pre>
<pre><code>## Scale for &#39;y&#39; is already present. Adding another scale for &#39;y&#39;, which will replace the existing scale.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_shape_manual</span>(<span class="dt">name =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">24</span>, <span class="dv">21</span>, <span class="dv">22</span>))</code></pre>
<pre><code>## Scale for &#39;shape&#39; is already present. Adding another scale for &#39;shape&#39;, which will replace the existing scale.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="dt">name =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;white&quot;</span>))</code></pre>
<pre><code>## Scale for &#39;fill&#39; is already present. Adding another scale for &#39;fill&#39;, which will replace the existing scale.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_color_manual</span>(<span class="dt">name =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>))</code></pre>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;, which will replace the existing scale.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">p</code></pre>
<pre><code>## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dev.off</span>()</code></pre>
<pre><code>## pdf 
##   2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">p</code></pre>
<pre><code>## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead
## ymax not defined: adjusting position using y instead</code></pre>
<div class="figure">
<img src="figure/04_sg_blup_SD.png" />
</div>
<h3 id="correlations-1">Correlations</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_blup.RData&quot;</span>)
sel_grads_blup_flat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">Aggression =</span> <span class="kw">filter</span>(sel_grads_blup, standardization ==<span class="st"> &quot;SD&quot;</span> &amp;
<span class="st">   </span>variable ==<span class="st"> &quot;Aggression&quot;</span>)$coefficients,
  <span class="dt">Agg_upper  =</span> <span class="kw">filter</span>(sel_grads_blup, standardization ==<span class="st"> &quot;SD&quot;</span> &amp;
<span class="st">   </span>variable ==<span class="st"> &quot;Aggression&quot;</span>)$upper,
  <span class="dt">Agg_lower  =</span> <span class="kw">filter</span>(sel_grads_blup, standardization ==<span class="st"> &quot;SD&quot;</span> &amp;
<span class="st">   </span>variable ==<span class="st"> &quot;Aggression&quot;</span>)$lower,
  <span class="dt">Activity   =</span> <span class="kw">filter</span>(sel_grads_blup, standardization ==<span class="st"> &quot;SD&quot;</span> &amp;
<span class="st">   </span>variable ==<span class="st"> &quot;Activity&quot;</span>)$coefficients,
  <span class="dt">Act_upper  =</span> <span class="kw">filter</span>(sel_grads_blup, standardization ==<span class="st"> &quot;SD&quot;</span> &amp;
<span class="st">   </span>variable ==<span class="st"> &quot;Activity&quot;</span>)$upper,
  <span class="dt">Act_lower  =</span> <span class="kw">filter</span>(sel_grads_blup, standardization ==<span class="st"> &quot;SD&quot;</span> &amp;
<span class="st">   </span>variable ==<span class="st"> &quot;Activity&quot;</span>)$lower,
  <span class="dt">Docility   =</span> <span class="kw">filter</span>(sel_grads_blup, standardization ==<span class="st"> &quot;SD&quot;</span> &amp;
<span class="st">   </span>variable ==<span class="st"> &quot;Docility&quot;</span>)$coefficients,
  <span class="dt">Doc_upper  =</span> <span class="kw">filter</span>(sel_grads_blup, standardization ==<span class="st"> &quot;SD&quot;</span> &amp;
<span class="st">   </span>variable ==<span class="st"> &quot;Docility&quot;</span>)$upper,
  <span class="dt">Doc_lower  =</span> <span class="kw">filter</span>(sel_grads_blup, standardization ==<span class="st"> &quot;SD&quot;</span> &amp;
<span class="st">   </span>variable ==<span class="st"> &quot;Docility&quot;</span>)$lower
)

cor.behav &lt;-<span class="st"> </span>function(x, y){
  ct &lt;-<span class="st"> </span><span class="kw">cor.test</span>(x, y)
  out &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">est =</span> ct$estimate, <span class="dt">lower =</span> ct$conf.int[<span class="dv">1</span>],
    <span class="dt">upper =</span> ct$conf.int[<span class="dv">2</span>], <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
  out &lt;-<span class="st"> </span><span class="kw">round</span>(out, <span class="dt">digits =</span> <span class="dv">2</span>)
  out$print &lt;-<span class="st"> </span><span class="kw">paste</span>(out$est, <span class="st">&quot; (&quot;</span>, out$lower, <span class="st">&quot;, &quot;</span>, out$upper, <span class="st">&quot;)&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
}

cor_blup_agg_act &lt;-<span class="st"> </span><span class="kw">cor.behav</span>(sel_grads_blup_flat$Aggression,
  sel_grads_blup_flat$Activity)
cor_blup_agg_doc &lt;-<span class="st"> </span><span class="kw">cor.behav</span>(sel_grads_blup_flat$Aggression,
  sel_grads_blup_flat$Docility)
cor_blup_doc_act &lt;-<span class="st"> </span><span class="kw">cor.behav</span>(sel_grads_blup_flat$Docility,
  sel_grads_blup_flat$Activity)</code></pre>
<h4 id="aggression-and-activity-1">Aggression and Activity</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> sel_grads_blup_flat, <span class="kw">aes</span>(<span class="dt">x =</span> Activity, <span class="dt">y =</span> Aggression))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Aggression&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Activity&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> Act_lower, <span class="dt">xmax =</span> Act_upper),
  <span class="dt">height =</span> <span class="fl">0.07</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Agg_lower, <span class="dt">ymax =</span> Agg_upper),
  <span class="dt">width =</span> <span class="fl">0.07</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">x =</span> <span class="fl">0.1</span>, <span class="dt">y =</span> <span class="fl">1.7</span>,
  <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;r = &quot;</span>, cor_blup_agg_act, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>))
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/04_agg_act_blup.png" />
</div>
<h4 id="aggression-and-docility-1">Aggression and Docility</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> sel_grads_blup_flat, <span class="kw">aes</span>(<span class="dt">y =</span> Aggression, <span class="dt">x =</span> Docility))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Aggression&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Docility&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> Doc_lower, <span class="dt">xmax =</span> Doc_upper),
  <span class="dt">height =</span> <span class="fl">0.07</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Agg_lower, <span class="dt">ymax =</span> Agg_upper),
  <span class="dt">width =</span> <span class="fl">0.03</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">x =</span> -<span class="fl">0.1</span>, <span class="dt">y =</span> <span class="fl">1.7</span>,
  <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;r = &quot;</span>, cor_blup_agg_doc, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>))
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/04_agg_doc_blup.png" />
</div>
<h4 id="activity-and-docility-1">Activity and Docility</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> sel_grads_blup_flat, <span class="kw">aes</span>(<span class="dt">x =</span> Activity, <span class="dt">y =</span> Docility))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Activity&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Docility&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Doc_lower, <span class="dt">ymax =</span> Doc_upper),
  <span class="dt">width =</span> <span class="fl">0.07</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> Act_lower, <span class="dt">xmax =</span> Act_upper),
  <span class="dt">height =</span> <span class="fl">0.03</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="fl">1.2</span>,
  <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;r = &quot;</span>, cor_blup_doc_act, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>))
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/04_act_doc_blup.png" />
</div>
<h3 id="summary-statistics">Summary Statistics</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
sign_change &lt;-<span class="st"> </span>function(x){
  <span class="co"># sign changes calculated as the number of changes in direction between </span>
  <span class="co"># successive years relative to n−1</span>
  s &lt;-<span class="st"> </span><span class="kw">sign</span>(x)
  <span class="kw">sum</span>(s[<span class="dv">1</span>:(<span class="kw">length</span>(s)-<span class="dv">1</span>)] !=<span class="st"> </span>s[-<span class="dv">1</span>])/(<span class="kw">length</span>(s)-<span class="dv">1</span>)
}
se &lt;-<span class="st"> </span>function(lower, upper){
  (upper -<span class="st"> </span>lower) /<span class="st"> </span><span class="fl">3.92</span>
}

sum_stats_blup &lt;-<span class="st"> </span>sel_grads_blup %&gt;%
<span class="kw">filter</span>(standardization ==<span class="st"> &quot;SD&quot;</span>) %&gt;%
<span class="kw">group_by</span>(variable, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="kw">summarise</span>(
  <span class="dt">mean_abs_b =</span> <span class="kw">mean</span>(<span class="kw">abs</span>(coefficients)),
  <span class="dt">abs_mean_b =</span> <span class="kw">abs</span>(<span class="kw">mean</span>(coefficients)),
  <span class="dt">sd_b =</span> <span class="kw">sd</span>(coefficients),
  <span class="dt">mean_se_b =</span> <span class="kw">mean</span>(<span class="kw">se</span>(lower, upper)),
  <span class="dt">freq_sign =</span> <span class="kw">sign_change</span>(coefficients),
  <span class="dt">mean_cv =</span> <span class="kw">mean</span>(<span class="kw">se</span>(lower, upper) /<span class="st"> </span><span class="kw">abs</span>(coefficients))
  )
sum_stats_blup[ ,<span class="dv">2</span>:<span class="dv">6</span>] &lt;-<span class="st"> </span><span class="kw">round</span>(sum_stats_blup[ ,<span class="dv">2</span>:<span class="dv">6</span>], <span class="dv">2</span>)
<span class="kw">pandoc.table</span>(sum_stats_blup)</code></pre>
<table>
<caption>Table continues below</caption>
<col width="15%" />
<col width="18%" />
<col width="18%" />
<col width="9%" />
<col width="15%" />
<thead>
<tr class="header">
<th align="right">variable</th>
<th align="right">mean_abs_b</th>
<th align="right">abs_mean_b</th>
<th align="right">sd_b</th>
<th align="right">mean_se_b</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">Activity</td>
<td align="right">0.45</td>
<td align="right">0.03</td>
<td align="right">0.58</td>
<td align="right">0.36</td>
</tr>
<tr class="even">
<td align="right">Aggression</td>
<td align="right">0.41</td>
<td align="right">0.09</td>
<td align="right">0.52</td>
<td align="right">0.3</td>
</tr>
<tr class="odd">
<td align="right">Docility</td>
<td align="right">0.28</td>
<td align="right">0.16</td>
<td align="right">0.3</td>
<td align="right">0.28</td>
</tr>
</tbody>
</table>
<table>
<col width="16%" />
<col width="12%" />
<thead>
<tr class="header">
<th align="right">freq_sign</th>
<th align="right">mean_cv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.57</td>
<td align="right">1.138</td>
</tr>
<tr class="even">
<td align="right">0.57</td>
<td align="right">2.701</td>
</tr>
<tr class="odd">
<td align="right">0.57</td>
<td align="right">1.912</td>
</tr>
</tbody>
</table>
<h2 id="compare-analytical-frameworks">Compare Analytical Frameworks</h2>
<h3 id="table">Table</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_blup.RData&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_mcmc.RData&quot;</span>)

sg_blups &lt;-<span class="st"> </span>sel_grads_blup %&gt;%<span class="st"> </span><span class="kw">filter</span>(standardization ==<span class="st"> &quot;SD&quot;</span>)
sg_mcmc &lt;-<span class="st"> </span>sel_grads_mcmc %&gt;%<span class="st"> </span><span class="kw">filter</span>(standardization ==<span class="st"> &quot;SD&quot;</span>)

compare_grads &lt;-<span class="st"> </span><span class="kw">left_join</span>(<span class="kw">select</span>(sg_blups, Year, variable,
  <span class="dt">blup_coef =</span> coefficients, <span class="dt">blup_upper =</span> upper, <span class="dt">blup_lower =</span> lower),
  <span class="kw">select</span>(sg_mcmc, Year, variable, <span class="dt">mcmc_pm =</span> post_mode,
    <span class="dt">mcmc_upper =</span> upper, <span class="dt">mcmc_lower =</span> lower), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;Year&quot;</span>))

ct_print &lt;-<span class="st"> </span>function(x,y){
  ct &lt;-<span class="st"> </span><span class="kw">cor.test</span>(x,y)
  est &lt;-<span class="st"> </span><span class="kw">format</span>(ct$estimate, <span class="dt">digits =</span> <span class="dv">2</span>)
  ci &lt;-<span class="st"> </span><span class="kw">format</span>(ct$conf.int, <span class="dt">digits =</span> <span class="dv">2</span>)
  ct &lt;-<span class="st"> </span><span class="kw">format</span>(ct, <span class="dt">digits =</span> <span class="dv">2</span>)
  <span class="kw">paste</span>(est, <span class="st">&quot; (&quot;</span>, ci[<span class="dv">1</span>], <span class="st">&quot;, &quot;</span>, ci[<span class="dv">2</span>] ,<span class="st">&quot;)&quot;</span>, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)  
}

c_table &lt;-<span class="st"> </span>compare_grads %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(variable) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">cor =</span> <span class="kw">cor</span>(blup_coef, mcmc_pm),
    <span class="dt">abs_diff =</span> <span class="kw">mean</span>((<span class="kw">abs</span>(blup_coef -<span class="st"> </span>mcmc_pm))),
    <span class="dt">mean_mcmc =</span> <span class="kw">mean</span>(<span class="kw">abs</span>(mcmc_pm)), <span class="dt">mean_blup =</span> <span class="kw">mean</span>(<span class="kw">abs</span>(blup_coef)),
    <span class="dt">prop_diff =</span> mean_blup /<span class="st"> </span>mean_mcmc, <span class="dt">cor_test =</span> <span class="kw">ct_print</span>(blup_coef, mcmc_pm),
    <span class="dt">lmerGreater =</span> <span class="kw">sum</span>(<span class="kw">abs</span>(blup_coef) &gt;<span class="st"> </span><span class="kw">abs</span>(mcmc_pm))
  )
<span class="kw">pandoc.table</span>(c_table)</code></pre>
<table>
<caption>Table continues below</caption>
<col width="15%" />
<col width="9%" />
<col width="15%" />
<col width="16%" />
<col width="16%" />
<thead>
<tr class="header">
<th align="center">variable</th>
<th align="center">cor</th>
<th align="center">abs_diff</th>
<th align="center">mean_mcmc</th>
<th align="center">mean_blup</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Activity</td>
<td align="center">0.8931</td>
<td align="center">0.2345</td>
<td align="center">0.2374</td>
<td align="center">0.4527</td>
</tr>
<tr class="even">
<td align="center">Aggression</td>
<td align="center">0.9599</td>
<td align="center">0.2312</td>
<td align="center">0.1904</td>
<td align="center">0.4096</td>
</tr>
<tr class="odd">
<td align="center">Docility</td>
<td align="center">0.9489</td>
<td align="center">0.08657</td>
<td align="center">0.1957</td>
<td align="center">0.2766</td>
</tr>
</tbody>
</table>
<table>
<col width="16%" />
<col width="25%" />
<col width="18%" />
<thead>
<tr class="header">
<th align="center">prop_diff</th>
<th align="center">cor_test</th>
<th align="center">lmerGreater</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1.907</td>
<td align="center">0.89 (0.51, 0.98)</td>
<td align="center">8</td>
</tr>
<tr class="even">
<td align="center">2.152</td>
<td align="center">0.96 (0.79, 0.99)</td>
<td align="center">7</td>
</tr>
<tr class="odd">
<td align="center">1.413</td>
<td align="center">0.95 (0.74, 0.99)</td>
<td align="center">7</td>
</tr>
</tbody>
</table>
<h3 id="aggression-plot">Aggression plot</h3>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">filter</span>(compare_grads, variable ==<span class="st"> &quot;Aggression&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> blup_coef, <span class="dt">y =</span> mcmc_pm))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> blup_lower, <span class="dt">xmax =</span> blup_upper),
  <span class="dt">height =</span> <span class="fl">0.04</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> mcmc_lower, <span class="dt">ymax =</span> mcmc_upper),
  <span class="dt">width =</span> <span class="fl">0.07</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),
  <span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.text =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">x =</span> <span class="fl">0.1</span>, <span class="dt">y =</span> <span class="fl">1.1</span>,
  <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;r = &quot;</span>, <span class="kw">filter</span>(c_table, variable ==<span class="st"> &quot;Aggression&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(cor_test), <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Posterior Modes&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Selection Gradients&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Aggression&quot;</span>)
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/04_compare_agg.png" />
</div>
<h3 id="activity-plot">Activity Plot</h3>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">filter</span>(compare_grads, variable ==<span class="st"> &quot;Activity&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> blup_coef, <span class="dt">y =</span> mcmc_pm))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> blup_lower, <span class="dt">xmax =</span> blup_upper),
  <span class="dt">height =</span> <span class="fl">0.04</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> mcmc_lower, <span class="dt">ymax =</span> mcmc_upper),
  <span class="dt">width =</span> <span class="fl">0.07</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),
  <span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.text =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="fl">1.5</span>,
  <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;r = &quot;</span>, <span class="kw">filter</span>(c_table, variable ==<span class="st"> &quot;Activity&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(cor_test), <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Posterior Modes&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Selection Gradients&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Activity&quot;</span>)
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/04_compare_act.png" />
</div>
<h3 id="docility-plot">Docility Plot</h3>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">filter</span>(compare_grads, variable ==<span class="st"> &quot;Docility&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> blup_coef, <span class="dt">y =</span> mcmc_pm))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> blup_lower, <span class="dt">xmax =</span> blup_upper),
  <span class="dt">height =</span> <span class="fl">0.04</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> mcmc_lower, <span class="dt">ymax =</span> mcmc_upper),
  <span class="dt">width =</span> <span class="fl">0.07</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),
  <span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.text =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Posterior Modes&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Selection Gradients&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="fl">0.7</span>,
  <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;r = &quot;</span>, <span class="kw">filter</span>(c_table, variable ==<span class="st"> &quot;Docility&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(cor_test), <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Docility&quot;</span>)
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/04_compare_doc.png" />
</div>
<!--pandoc
t: html
default-image-extension: png
template: templates/html.template
toc-depth: 4
toc:

t: latex
s:
S:
latex-engine: xelatex
template: templates/latex.template
default-image-extension: pdf
toc-depth: 4
toc:
-->



<h1 id="competition-and-selection">Competition and Selection</h1>
<h2 id="accounting-for-behavioral-measurement-uncertainty">Accounting for behavioral measurement uncertainty</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MASS) <span class="co"># MASS clashes with dplyr... so always load first</span>
<span class="kw">library</span>(pander) <span class="co"># pander clashes with dplyr... so always load first</span>
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(grid)
<span class="kw">library</span>(dplyr)
<span class="kw">set.alignment</span>(<span class="st">&#39;right&#39;</span>, <span class="dt">row.names =</span> <span class="st">&#39;left&#39;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_mcmc.RData&quot;</span>)
fitness &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file =</span> <span class="st">&quot;data/fitness+competition.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&#39;,&#39;</span>,
  <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/fit_raneff_data.RData&quot;</span>)</code></pre>
<p>We will examine the effect of competition on selection in two general steps.</p>
<ol style="list-style-type: decimal">
<li>Is there an interaction between competition and behavior on fitness?</li>
<li>Are there nonlinear effects of behavior on fitness?</li>
</ol>
<h3 id="correlations-between-selection-gradients-and-competition">Correlations between selection gradients and competition</h3>
<p>First a plot of the relationship between selection gradients and competition. The two study areas were pooled to calculate selection gradients for each year. Therefore we need to calculate competition for the combined study areas. Competition is the number of offspring produced during the year divided by the number of offspring that survived to spring (i.e. recruited into the population).</p>
<pre class="sourceCode r"><code class="sourceCode r">competition_year &lt;-<span class="st"> </span>fitness %&gt;%
<span class="st">  </span><span class="kw">filter</span>(grid_year !=<span class="st"> &quot;SU2008&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(Year, competition) %&gt;%
<span class="st">  </span><span class="kw">unique</span>() %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_competition =</span> <span class="kw">mean</span>(competition))
  
n_year &lt;-<span class="st"> </span><span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%<span class="st"> </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())
competition_year &lt;-<span class="st"> </span><span class="kw">left_join</span>(competition_year, n_year, <span class="dt">by =</span> <span class="st">&quot;Year&quot;</span>)
competition_year$Year &lt;-<span class="st"> </span><span class="kw">as.character</span>(competition_year$Year)

<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_mcmc.RData&quot;</span>)
sel_grads_mcmc_comp &lt;-<span class="st"> </span><span class="kw">left_join</span>(
  <span class="kw">filter</span>(sel_grads_mcmc, standardization ==<span class="st"> &quot;SD&quot;</span>), competition_year,
  <span class="dt">by =</span> <span class="st">&quot;Year&quot;</span>)
<span class="kw">save</span>(sel_grads_mcmc_comp, competition_year,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/sel_grads_mcmc_comp.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_mcmc_comp.RData&quot;</span>)

cor_sgrad_comp &lt;-<span class="st"> </span>function(x){
  v &lt;-<span class="st"> </span>x$variable[<span class="dv">1</span>]
  ct &lt;-<span class="st"> </span><span class="kw">cor.test</span>(x$post_mode, x$mean_competition)
  <span class="kw">data.frame</span>(<span class="dt">variable =</span> v, <span class="dt">est =</span> ct$estimate, <span class="dt">lower =</span> ct$conf.int[<span class="dv">1</span>],
    <span class="dt">upper =</span> ct$conf.int[<span class="dv">2</span>], <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
}

mcmc_cor &lt;-<span class="st"> </span>sel_grads_mcmc_comp %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(variable, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">do</span>(<span class="kw">cor_sgrad_comp</span>(.))
mcmc_cor[ ,<span class="dv">2</span>:<span class="dv">4</span>] &lt;-<span class="st"> </span><span class="kw">round</span>(mcmc_cor[ ,<span class="dv">2</span>:<span class="dv">4</span>], <span class="dt">digits =</span> <span class="dv">2</span>)
mcmc_cor$print &lt;-<span class="st"> </span><span class="kw">paste</span>(mcmc_cor$est,
  <span class="st">&quot; (&quot;</span>, mcmc_cor$lower, <span class="st">&quot;, &quot;</span>, mcmc_cor$upper, <span class="st">&quot;)&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</code></pre>
<h4 id="aggression-and-competition">Aggression and Competition</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sel_grads_mcmc_comp, variable ==<span class="st"> &quot;Aggression&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> mean_competition, <span class="dt">y =</span> post_mode))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Selection Gradient&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Aggression&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Juvenile Competition&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>),
  <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mcmc_cor, variable ==<span class="st"> &quot;Aggression&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> <span class="fl">6.5</span>, <span class="dt">y =</span> <span class="fl">1.1</span>, <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;Correlation = &quot;</span>, print, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)),
  <span class="dt">size =</span> <span class="fl">2.5</span>)
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/05_agg_comp_mcmc.png" />
</div>
<h4 id="activity-and-competition">Activity and Competition</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sel_grads_mcmc_comp, variable ==<span class="st"> &quot;Activity&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> mean_competition, <span class="dt">y =</span> post_mode))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Selection Gradient&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Activity&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Juvenile Competition&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>),
  <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylim</span>(<span class="kw">c</span>(-<span class="dv">1</span>, <span class="fl">1.5</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mcmc_cor, variable ==<span class="st"> &quot;Activity&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> <span class="fl">6.1</span>, <span class="dt">y =</span> <span class="fl">1.5</span>, <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;Correlation = &quot;</span>, print, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)),
  <span class="dt">size =</span> <span class="fl">2.5</span>)
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/05_act_comp_mcmc.png" />
</div>
<h4 id="docility-and-competition">Docility and Competition</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sel_grads_mcmc_comp, variable ==<span class="st"> &quot;Docility&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> mean_competition, <span class="dt">y =</span> post_mode))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Selection Gradient&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Docility&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Juvenile Competition&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>),
  <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mcmc_cor, variable ==<span class="st"> &quot;Docility&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> <span class="fl">6.1</span>, <span class="dt">y =</span> <span class="fl">0.65</span>, <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;Correlation = &quot;</span>, print, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)),
  <span class="dt">size =</span> <span class="fl">2.5</span>)
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/05_doc_comp_mcmc.png" />
</div>
<h3 id="effect-of-competition-on-linear-selection-glmms">Effect of competition on linear selection (glmms)</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/fit_raneff_data.RData&quot;</span>)
<span class="kw">library</span>(dplyr)
fit_raneff_data &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(fit_raneff_data)
<span class="kw">library</span>(lme4)

<span class="co"># Model with interactions between competition and the behavioral traits. </span>
<span class="co"># grid_year and ID are random effects.</span>
arsLinearCompetition &lt;-<span class="st"> </span>function(dat){
  ars_linear_comp &lt;-<span class="st"> </span><span class="kw">glmer</span>(
    ars_all ~<span class="st"> </span>
<span class="st">    </span>competition_s +<span class="st"> </span>
<span class="st">    </span>aggression_s +<span class="st"> </span>
<span class="st">    </span>competition_s:aggression_s +<span class="st"> </span>
<span class="st">    </span>activity_s +<span class="st"> </span>
<span class="st">    </span>competition_s:activity_s +<span class="st"> </span>
<span class="st">    </span>docility_s +
<span class="st">    </span>competition_s:docility_s +
<span class="st">    </span>(<span class="dv">1</span>|Grid) +<span class="st"> </span>(<span class="dv">1</span>|ID),
    <span class="dt">data =</span> dat, <span class="dt">family =</span> poisson, <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>)
    )
  random_effect_variances &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(ars_linear_comp)
  <span class="kw">data.frame</span>(<span class="kw">t</span>(<span class="kw">summary</span>(ars_linear_comp)$coefficients[ ,<span class="st">&quot;Estimate&quot;</span>]),
  <span class="dt">ID =</span> random_effect_variances$ID[<span class="dv">1</span>], <span class="dt">Grid =</span> random_effect_variances$Grid[<span class="dv">1</span>])
}

<span class="kw">library</span>(foreach)</code></pre>
<pre><code>## foreach: simple, scalable parallel programming from Revolution Analytics
## Use Revolution R for scalability, fault tolerance and more.
## http://www.revolutionanalytics.com</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(doMC)</code></pre>
<pre><code>## Loading required package: iterators
## Loading required package: parallel</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ncores =<span class="st"> </span><span class="dv">12</span>
<span class="kw">registerDoMC</span>(<span class="dt">cores =</span> ncores)

batches &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">start =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">1000</span>, <span class="kw">round</span>(<span class="dv">1000</span>/ncores))[<span class="dv">1</span>:ncores])
batches$stop &lt;-<span class="st"> </span><span class="kw">c</span>(batches$start[<span class="dv">2</span>:<span class="kw">length</span>(batches$start)] -<span class="st"> </span><span class="dv">1</span>, <span class="dv">1000</span>)

start_time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
ars_linear_comp_posterior &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span>:ncores, <span class="dt">.combine =</span> rbind) %dopar%<span class="st"> </span>{
  results &lt;-<span class="st"> </span>fit_raneff_data %&gt;%
<span class="st">    </span><span class="kw">filter</span>(type ==<span class="st"> &quot;raneff&quot;</span>, itt %in%<span class="st"> </span>batches$start[i]:batches$stop[i]) %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(itt, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">    </span><span class="kw">do</span>(<span class="kw">arsLinearCompetition</span>(.))
}
run_time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>() -<span class="st"> </span>start_time
<span class="kw">print</span>(run_time)</code></pre>
<pre><code>## Time difference of 2.539 mins</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(ars_linear_comp_posterior,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/ars_linear_comp_posterior.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/ars_linear_comp_posterior.RData&quot;</span>)
<span class="kw">library</span>(MCMCglmm)
<span class="kw">library</span>(lme4)
<span class="kw">library</span>(data.table)</code></pre>
<pre><code>## data.table 1.9.2  For help type: help(&quot;data.table&quot;)
## 
## Attaching package: &#39;data.table&#39;
## 
## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     between, last</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">getPosteriorParams &lt;-<span class="st"> </span>function(x){
  <span class="kw">require</span>(MCMCglmm)
  dat_mcmc &lt;-<span class="st"> </span><span class="kw">mcmc</span>(x)
  pm &lt;-<span class="st"> </span><span class="kw">posterior.mode</span>(dat_mcmc)
  hpd &lt;-<span class="st"> </span><span class="kw">HPDinterval</span>(dat_mcmc, <span class="dt">prob =</span> <span class="fl">0.9</span>)
  pm_table &lt;-<span class="st">  </span><span class="kw">format</span>(<span class="kw">round</span>(pm , <span class="dt">digits =</span> <span class="dv">2</span>), <span class="dt">digits =</span> <span class="dv">1</span>, <span class="dt">nsmall =</span> <span class="dv">2</span>,
    <span class="dt">scientific =</span> <span class="ot">FALSE</span>)
  hpd_table &lt;-<span class="st"> </span><span class="kw">format</span>(<span class="kw">round</span>(hpd, <span class="dt">digits =</span> <span class="dv">2</span>), <span class="dt">digits =</span> <span class="dv">1</span>, <span class="dt">nsmall =</span> <span class="dv">2</span>,
    <span class="dt">scientific =</span> <span class="ot">FALSE</span>)
  pm_hpd_table &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">cbind</span>(pm_table, hpd_table))
  pm_hpd_table$pm_hpd &lt;-<span class="st"> </span><span class="kw">paste</span>(
    pm_table, <span class="st">&quot; (&quot;</span>, hpd_table[ ,<span class="dv">1</span>], <span class="st">&quot;, &quot;</span>, hpd_table[ ,<span class="dv">2</span>], <span class="st">&quot;)&quot;</span>, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>
    )
  pm_hpd_table$sig[<span class="kw">sign</span>(hpd[ ,<span class="dv">1</span>]) ==<span class="st"> </span><span class="kw">sign</span>(hpd[ ,<span class="dv">2</span>])] &lt;-<span class="st"> &quot;*&quot;</span>
  pm_hpd_table$sig[<span class="kw">sign</span>(hpd[ ,<span class="dv">1</span>]) !=<span class="st"> </span><span class="kw">sign</span>(hpd[ ,<span class="dv">2</span>])] &lt;-<span class="st"> &quot; &quot;</span>
  pm_hpd_table$space[<span class="kw">sign</span>(hpd[ ,<span class="dv">1</span>]) ==<span class="st"> </span><span class="kw">sign</span>(hpd[ ,<span class="dv">2</span>])] &lt;-<span class="st"> &quot;*&quot;</span>
  pm_hpd_table$space[<span class="kw">sign</span>(hpd[ ,<span class="dv">1</span>]) !=<span class="st"> </span><span class="kw">sign</span>(hpd[ ,<span class="dv">2</span>])] &lt;-<span class="st"> &quot;&amp;nbsp;&quot;</span>
  pm_hpd_table$pm_hpd &lt;-<span class="st"> </span><span class="kw">paste</span>(pm_hpd_table$pm_hpd, pm_hpd_table$sig, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
  <span class="kw">return</span>(pm_hpd_table)
}

linear_hpd_ars &lt;-<span class="st"> </span><span class="kw">getPosteriorParams</span>(ars_linear_comp_posterior %&gt;%
<span class="st">  </span><span class="kw">ungroup</span>() %&gt;%
<span class="st">  </span><span class="kw">select</span>(<span class="dt">Intercept =</span> X.Intercept., <span class="dt">Competition =</span> competition_s,
    <span class="dt">Aggression =</span> aggression_s, <span class="dt">Activity =</span> activity_s, <span class="dt">docility =</span> docility_s,
    <span class="st">&quot;Competition x Aggression&quot;</span> =<span class="st"> </span>competition_s.aggression_s,
    <span class="st">&quot;Competition x Activity&quot;</span> =<span class="st"> </span>competition_s.activity_s,
    <span class="st">&quot;Competition x Docility&quot;</span> =<span class="st"> </span>competition_s.docility_s)
    )</code></pre>
<h4 id="interaction-between-competition-and-linear-selection-results">Interaction between competition and linear selection results</h4>
<p>The effect of competition on linear selection on female behavioral traits for annual reproductive success. Posterior modes are given with highest posterior density intervals in parentheses.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pandoc.table</span>(linear_hpd_ars %&gt;%<span class="st"> </span><span class="kw">select</span>(pm_hpd), <span class="dt">justify=</span><span class="st">&quot;right&quot;</span>)</code></pre>
<table>
<col width="43%" />
<col width="29%" />
<thead>
<tr class="header">
<th align="right"> </th>
<th align="right">pm_hpd</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><strong>Intercept</strong></td>
<td align="right">-1.01 (-1.11, -0.93)*</td>
</tr>
<tr class="even">
<td align="right"><strong>Competition</strong></td>
<td align="right">-3.27 (-3.65, -3.09)*</td>
</tr>
<tr class="odd">
<td align="right"><strong>Aggression</strong></td>
<td align="right">0.36 ( 0.13, 0.63)*</td>
</tr>
<tr class="even">
<td align="right"><strong>Activity</strong></td>
<td align="right">-0.12 (-0.37, 0.15)</td>
</tr>
<tr class="odd">
<td align="right"><strong>docility</strong></td>
<td align="right">-0.18 (-0.38, -0.06)*</td>
</tr>
<tr class="even">
<td align="right"><strong>Competition x Aggression</strong></td>
<td align="right">1.30 ( 0.50, 1.99)*</td>
</tr>
<tr class="odd">
<td align="right"><strong>Competition x Activity</strong></td>
<td align="right">-0.45 (-1.26, 0.32)</td>
</tr>
<tr class="even">
<td align="right"><strong>Competition x Docility</strong></td>
<td align="right">-0.54 (-1.13, -0.09)*</td>
</tr>
</tbody>
</table>
<h3 id="competition-and-nonlinear-selection-glmms">Competition and nonlinear selection (glmms)</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/fit_raneff_data.RData&quot;</span>)
<span class="kw">library</span>(lme4)

arsNonlinearResults &lt;-<span class="st"> </span>function(dat){
  ars_model  &lt;-<span class="st"> </span><span class="kw">glmer</span>(ars_all ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">    </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +
<span class="st">    </span>aggression_s*activity_s*competition_s +<span class="st"> </span><span class="kw">I</span>(aggression_s^<span class="dv">2</span>)*competition_s +
<span class="st">    </span><span class="kw">I</span>(activity_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span><span class="kw">I</span>(docility_s^<span class="dv">2</span>)*competition_s +
<span class="st">    </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID), <span class="dt">data =</span> dat, <span class="dt">family =</span> poisson,
    <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))
  kpd_model  &lt;-<span class="st"> </span><span class="kw">glmer</span>(kprod   ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">    </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +
<span class="st">    </span>aggression_s*activity_s*competition_s +<span class="st"> </span><span class="kw">I</span>(aggression_s^<span class="dv">2</span>)*competition_s +
<span class="st">    </span><span class="kw">I</span>(activity_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span><span class="kw">I</span>(docility_s^<span class="dv">2</span>)*competition_s +
<span class="st">    </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID), <span class="dt">data =</span> dat, <span class="dt">family =</span> poisson,
    <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))
  ows_model  &lt;-<span class="st"> </span><span class="kw">glmer</span>(prop    ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">    </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +
<span class="st">    </span>aggression_s*activity_s*competition_s +<span class="st"> </span><span class="kw">I</span>(aggression_s^<span class="dv">2</span>)*competition_s +
<span class="st">    </span><span class="kw">I</span>(activity_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span><span class="kw">I</span>(docility_s^<span class="dv">2</span>)*competition_s +
<span class="st">    </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID), <span class="dt">data =</span> dat, <span class="dt">weights =</span> kprod, <span class="dt">family =</span> binomial,
    <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))

  ars_vc &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(ars_model)
  ars_t &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">fitness =</span> <span class="st">&quot;ars&quot;</span>,
    <span class="kw">t</span>(<span class="kw">summary</span>(ars_model)$coefficients[ ,<span class="st">&quot;Estimate&quot;</span>]), <span class="dt">ID =</span> ars_vc$ID[<span class="dv">1</span>],
    <span class="dt">grid_year =</span> ars_vc$grid_year[<span class="dv">1</span>])
  kpd_vc &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(kpd_model)
  kpd_t &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">fitness =</span> <span class="st">&quot;kpd&quot;</span>,
    <span class="kw">t</span>(<span class="kw">summary</span>(kpd_model)$coefficients[ ,<span class="st">&quot;Estimate&quot;</span>]), <span class="dt">ID =</span> kpd_vc$ID[<span class="dv">1</span>],
    <span class="dt">grid_year =</span> kpd_vc$grid_year[<span class="dv">1</span>])
  ows_vc &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(ows_model)
  ows_t &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">fitness =</span> <span class="st">&quot;ows&quot;</span>,
    <span class="kw">t</span>(<span class="kw">summary</span>(ows_model)$coefficients[ ,<span class="st">&quot;Estimate&quot;</span>]), <span class="dt">ID =</span> ows_vc$ID[<span class="dv">1</span>],
    <span class="dt">grid_year =</span> ows_vc$grid_year[<span class="dv">1</span>])
  <span class="kw">rbind</span>(<span class="kw">rbind</span>(ars_t, kpd_t), ows_t)
}


<span class="kw">library</span>(foreach)
<span class="kw">library</span>(doMC)
ncores =<span class="st"> </span><span class="dv">12</span>
<span class="kw">registerDoMC</span>(<span class="dt">cores =</span> ncores)

batches &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">start =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">1000</span>, <span class="kw">round</span>(<span class="dv">1000</span>/ncores))[<span class="dv">1</span>:ncores])
batches$stop &lt;-<span class="st"> </span><span class="kw">c</span>(batches$start[<span class="dv">2</span>:<span class="kw">length</span>(batches$start)] -<span class="st"> </span><span class="dv">1</span>, <span class="dv">1000</span>)

start_time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
nonlinear_mcmc &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span>:ncores, <span class="dt">.combine =</span> rbind) %dopar%<span class="st"> </span>{
  results &lt;-<span class="st"> </span>fit_raneff_data %&gt;%
<span class="st">    </span><span class="kw">filter</span>(type ==<span class="st"> &quot;raneff&quot;</span>, itt %in%<span class="st"> </span>batches$start[i]:batches$stop[i]) %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(itt, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">    </span><span class="kw">do</span>(<span class="kw">arsNonlinearResults</span>(.))
}
run_time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>() -<span class="st"> </span>start_time
<span class="kw">print</span>(run_time)</code></pre>
<pre><code>## Time difference of 20.4 mins</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(nonlinear_mcmc, <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/nonlinear_mcmc_models.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/nonlinear_mcmc_models.RData&quot;</span>)

pm_hpd_ars &lt;-<span class="st"> </span><span class="kw">getPosteriorParams</span>(
  nonlinear_mcmc[nonlinear_mcmc$fitness ==<span class="st">&quot;ars&quot;</span>, <span class="dv">3</span>:<span class="dv">18</span>])
pm_hpd_ows &lt;-<span class="st"> </span><span class="kw">getPosteriorParams</span>(
  nonlinear_mcmc[nonlinear_mcmc$fitness ==<span class="st">&quot;ows&quot;</span>, <span class="dv">3</span>:<span class="dv">18</span>])
pm_hpd_kpd &lt;-<span class="st"> </span><span class="kw">getPosteriorParams</span>(
  nonlinear_mcmc[nonlinear_mcmc$fitness ==<span class="st">&quot;kpd&quot;</span>, <span class="dv">3</span>:<span class="dv">18</span>])

nonlinear_results_mcmc &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">ARS =</span> pm_hpd_ars$pm_hpd,
  <span class="dt">OWS =</span> pm_hpd_ows$pm_hpd, <span class="dt">Fecundity =</span> pm_hpd_kpd$pm_hpd)
  
<span class="kw">row.names</span>(nonlinear_results_mcmc) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;Aggression&quot;</span>,
 <span class="st">&quot;Competition&quot;</span>, <span class="st">&quot;Activity&quot;</span>, <span class="st">&quot;Docility&quot;</span>, <span class="st">&quot;Aggression^2&quot;</span>, <span class="st">&quot;Activity^2&quot;</span>,
 <span class="st">&quot;Docility^2&quot;</span>, <span class="st">&quot;Aggression x Competition&quot;</span>, <span class="st">&quot;Activity x Competition&quot;</span>,
 <span class="st">&quot;Docility x Competition&quot;</span>, <span class="st">&quot;Aggression x Activity&quot;</span>,
 <span class="st">&quot;Aggression^2 x Competition&quot;</span>, <span class="st">&quot;Activity^2 x Competition&quot;</span>,
 <span class="st">&quot;Docility^2 x Competition&quot;</span>, <span class="st">&quot;Agg. x Act. x Competition&quot;</span>
 )</code></pre>
<h3 id="nonlinear-results">Nonlinear results</h3>
<p>The effect of competition on linear and nonlinear selection on female behavioral traits for annual reproductive success. Posterior modes are given with highest posterior density intervals in parentheses.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pandoc.table</span>(nonlinear_results_mcmc[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>:<span class="dv">16</span>), ], 
  <span class="dt">split.tables =</span> <span class="dv">160</span>)</code></pre>
<table>
<col width="33%" />
<col width="23%" />
<col width="23%" />
<col width="20%" />
<thead>
<tr class="header">
<th align="left"> </th>
<th align="right">ARS</th>
<th align="right">OWS</th>
<th align="right">Fecundity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Intercept</strong></td>
<td align="right">-0.76 (-1.18, -0.42)*</td>
<td align="right">-1.84 (-2.35, -1.42)*</td>
<td align="right">1.34 ( 1.28, 1.41)*</td>
</tr>
<tr class="even">
<td align="left"><strong>Competition</strong></td>
<td align="right">-2.58 (-3.98, -1.72)*</td>
<td align="right">-2.41 (-4.21, -1.27)*</td>
<td align="right">-0.06 (-0.19, 0.09)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Aggression</strong></td>
<td align="right">0.45 ( 0.08, 0.82)*</td>
<td align="right">0.59 ( 0.17, 1.13)*</td>
<td align="right">-0.04 (-0.09, 0.02)</td>
</tr>
<tr class="even">
<td align="left"><strong>Activity</strong></td>
<td align="right">-0.17 (-0.53, 0.17)</td>
<td align="right">-0.06 (-0.68, 0.24)</td>
<td align="right">0.03 (-0.05, 0.06)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Docility</strong></td>
<td align="right">-0.29 (-0.55, -0.13)*</td>
<td align="right">-0.29 (-0.54, -0.03)*</td>
<td align="right">0.04 ( 0.00, 0.07)*</td>
</tr>
<tr class="even">
<td align="left"><strong>Aggression^2</strong></td>
<td align="right">-0.12 (-0.51, 0.15)</td>
<td align="right">-0.28 (-0.70, 0.16)</td>
<td align="right">0.02 (-0.05, 0.05)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Activity^2</strong></td>
<td align="right">0.00 (-0.36, 0.23)</td>
<td align="right">-0.07 (-0.42, 0.31)</td>
<td align="right">-0.02 (-0.07, 0.02)</td>
</tr>
<tr class="even">
<td align="left"><strong>Docility^2</strong></td>
<td align="right">-0.15 (-0.33, 0.04)</td>
<td align="right">-0.20 (-0.41, 0.05)</td>
<td align="right">0.01 (-0.03, 0.04)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Aggression x Competition</strong></td>
<td align="right">1.71 ( 0.48, 2.66)*</td>
<td align="right">2.16 ( 0.55, 3.53)*</td>
<td align="right">-0.03 (-0.16, 0.09)</td>
</tr>
<tr class="even">
<td align="left"><strong>Activity x Competition</strong></td>
<td align="right">-0.72 (-1.77, 0.35)</td>
<td align="right">-0.24 (-1.70, 1.10)</td>
<td align="right">-0.03 (-0.15, 0.08)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Docility x Competition</strong></td>
<td align="right">-0.70 (-1.55, -0.26)*</td>
<td align="right">-0.45 (-1.13, 0.49)</td>
<td align="right">-0.04 (-0.14, 0.02)</td>
</tr>
<tr class="even">
<td align="left"><strong>Aggression x Activity</strong></td>
<td align="right">0.14 (-0.22, 0.67)</td>
<td align="right">0.21 (-0.29, 0.84)</td>
<td align="right">0.02 (-0.06, 0.08)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Aggression^2 x Competition</strong></td>
<td align="right">-0.27 (-1.36, 0.56)</td>
<td align="right">-0.35 (-1.98, 0.70)</td>
<td align="right">0.03 (-0.11, 0.14)</td>
</tr>
<tr class="even">
<td align="left"><strong>Activity^2 x Competition</strong></td>
<td align="right">-0.06 (-1.07, 0.68)</td>
<td align="right">-0.11 (-1.32, 1.00)</td>
<td align="right">0.00 (-0.11, 0.11)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Docility^2 x Competition</strong></td>
<td align="right">-0.51 (-1.05, 0.15)</td>
<td align="right">-0.34 (-1.29, 0.19)</td>
<td align="right">-0.02 (-0.11, 0.05)</td>
</tr>
<tr class="even">
<td align="left"><strong>Agg. x Act. x Competition</strong></td>
<td align="right">0.44 (-0.75, 1.92)</td>
<td align="right">0.52 (-1.08, 2.57)</td>
<td align="right">0.01 (-0.20, 0.16)</td>
</tr>
</tbody>
</table>
<h2 id="ignoring-behavioural-uncertainty">Ignoring behavioural uncertainty</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_blup.RData&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/fit_raneff_data.RData&quot;</span>)</code></pre>
<h3 id="correlations-between-selection-gradients-and-competition-1">Correlations between selection gradients and competition</h3>
<pre class="sourceCode r"><code class="sourceCode r">competition_year &lt;-<span class="st"> </span>fitness %&gt;%
<span class="st">  </span><span class="kw">filter</span>(grid_year !=<span class="st"> &quot;SU2008&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(Year, competition) %&gt;%
<span class="st">  </span><span class="kw">unique</span>() %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_competition =</span> <span class="kw">mean</span>(competition))
  
n_year &lt;-<span class="st"> </span><span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Year, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())
competition_year &lt;-<span class="st"> </span><span class="kw">left_join</span>(competition_year, n_year, <span class="dt">by =</span> <span class="st">&quot;Year&quot;</span>)
competition_year$Year &lt;-<span class="st"> </span><span class="kw">as.character</span>(competition_year$Year)

<span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_blup.RData&quot;</span>)
sel_grads_blup_competition &lt;-<span class="st"> </span><span class="kw">left_join</span>(
  <span class="kw">filter</span>(sel_grads_blup, standardization ==<span class="st"> &quot;SD&quot;</span>), competition_year,
  <span class="dt">by =</span> <span class="st">&quot;Year&quot;</span>)
<span class="kw">save</span>(sel_grads_blup_competition, competition_year,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/sel_grads_blup_competition.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/sel_grads_blup_competition.RData&quot;</span>)

cor_sgrad_comp &lt;-<span class="st"> </span>function(x){
  v &lt;-<span class="st"> </span>x$variable[<span class="dv">1</span>]
  ct &lt;-<span class="st"> </span><span class="kw">cor.test</span>(x$coefficients, x$mean_competition)
  <span class="kw">data.frame</span>(<span class="dt">variable =</span> v, <span class="dt">est =</span> ct$estimate, <span class="dt">lower =</span> ct$conf.int[<span class="dv">1</span>],
    <span class="dt">upper =</span> ct$conf.int[<span class="dv">2</span>], <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
}

sg.comp &lt;-<span class="st"> </span>sel_grads_blup_competition %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(variable, <span class="dt">add =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">do</span>(<span class="kw">cor_sgrad_comp</span>(<span class="dt">x=</span>.))
sg.comp[ ,<span class="dv">2</span>:<span class="dv">4</span>] &lt;-<span class="st"> </span><span class="kw">round</span>(sg.comp[ ,<span class="dv">2</span>:<span class="dv">4</span>], <span class="dt">digits =</span> <span class="dv">2</span>)
sg.comp$print &lt;-<span class="st"> </span><span class="kw">paste</span>(sg.comp$est, <span class="st">&quot; (&quot;</span>, sg.comp$lower, <span class="st">&quot;, &quot;</span>,
  sg.comp$upper, <span class="st">&quot;)&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</code></pre>
<h4 id="aggression-and-competition-1">Aggression and Competition</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sel_grads_blup_competition,
  variable ==<span class="st"> &quot;Aggression&quot;</span>), <span class="kw">aes</span>(<span class="dt">x =</span> mean_competition, <span class="dt">y =</span> coefficients))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Selection Gradient&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Aggression&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Juvenile Competition&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>), <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>), <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sg.comp, variable ==<span class="st"> &quot;Aggression&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">6</span>, <span class="dt">y =</span> <span class="fl">1.5</span>, <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;r = &quot;</span>, print, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)), <span class="dt">size =</span> <span class="fl">2.5</span>)
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/05_agg_comp_blup.png" />
</div>
<h4 id="activity-and-competition-1">Activity and Competition</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sel_grads_blup_competition, variable ==<span class="st"> &quot;Activity&quot;</span>), 
  <span class="kw">aes</span>(<span class="dt">x =</span> mean_competition, <span class="dt">y =</span> coefficients))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Selection Gradient&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Activity&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Juvenile Competition&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>),
  <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sg.comp, variable ==<span class="st"> &quot;Activity&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">6</span>, <span class="dt">y =</span> <span class="fl">2.2</span>, <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;r = &quot;</span>, print, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)), <span class="dt">size =</span> <span class="fl">2.5</span>)
  <span class="kw">pdf</span>(<span class="dt">file =</span> <span class="st">&quot;test.pdf&quot;</span>, <span class="dt">width =</span> <span class="fl">2.17</span>, <span class="dt">height =</span> <span class="fl">2.03</span>)
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<h4 id="docility-and-competition-1">Docility and Competition</h4>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sel_grads_blup_competition, variable ==<span class="st"> &quot;Docility&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> mean_competition, <span class="dt">y =</span> coefficients))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.2</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_point</span>()
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Selection Gradient&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Docility&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Juvenile Competition&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
  <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),
  <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>),
  <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sg.comp, variable ==<span class="st"> &quot;Docility&quot;</span>),
  <span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">6</span>, <span class="dt">y =</span> <span class="dv">1</span>, <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;r = &quot;</span>, print, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)), <span class="dt">size =</span> <span class="fl">2.5</span>)
p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/05_doc_comp_blup.png" />
</div>
<h3 id="effect-of-competition-on-linear-selection">Effect of competition on linear selection</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/fit_raneff_data.RData&quot;</span>)
<span class="kw">library</span>(dplyr)
fit_raneff_data &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(fit_raneff_data)
<span class="kw">library</span>(lme4)
fit_raneff_data$oID &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="kw">nrow</span>(fit_raneff_data)

ars_linear_model  &lt;-<span class="st"> </span><span class="kw">glmer</span>(ars_all ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +
<span class="st">  </span>(<span class="dv">1</span>|ID) +<span class="st"> </span>(<span class="dv">1</span>|oID), <span class="dt">data =</span> <span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>),
  <span class="dt">family =</span> poisson, <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))
kpd_linear_model  &lt;-<span class="st"> </span><span class="kw">glmer</span>(kprod ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +
<span class="st">  </span>(<span class="dv">1</span>|ID) +<span class="st"> </span>(<span class="dv">1</span>|oID), <span class="dt">data =</span> <span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>),
  <span class="dt">family =</span> poisson, <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))
ows_linear_model  &lt;-<span class="st"> </span><span class="kw">glmer</span>(prop ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +
<span class="st">  </span>(<span class="dv">1</span>|ID) +<span class="st"> </span>(<span class="dv">1</span>|oID), <span class="dt">data =</span> <span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>),
  <span class="dt">weights =</span> kprod, <span class="dt">family =</span> binomial, <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))

<span class="kw">save</span>(ars_linear_model, kpd_linear_model, ows_linear_model,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/ars_linear_blup_models.RData&quot;</span>)</code></pre>
<p>Models with observation level random effect.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/fit_raneff_data.RData&quot;</span>)
<span class="kw">library</span>(dplyr)
fit_raneff_data &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(fit_raneff_data)
<span class="kw">library</span>(lme4)

fit_raneff_data$oID &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="kw">nrow</span>(fit_raneff_data)

ars_linear_model_  &lt;-<span class="st"> </span><span class="kw">glmer</span>(ars_all ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>(<span class="dv">1</span> |<span class="st"> </span>oID) +
<span class="st">  </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID), <span class="dt">data =</span> <span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>),
  <span class="dt">family =</span> poisson, <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))
kpd_linear_model_  &lt;-<span class="st"> </span><span class="kw">glmer</span>(kprod   ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>(<span class="dv">1</span> |<span class="st"> </span>oID) +
<span class="st">  </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID), <span class="dt">data =</span> <span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>), 
  <span class="dt">family =</span> poisson, <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))
ows_linear_model_  &lt;-<span class="st"> </span><span class="kw">glmer</span>(prop    ~<span class="st"> </span>aggression_s*competition_s +
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>(<span class="dv">1</span> |<span class="st"> </span>oID) +
<span class="st">  </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID), <span class="dt">data =</span> <span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>), 
  <span class="dt">weights =</span> kprod, <span class="dt">family =</span> binomial, <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))

<span class="kw">save</span>(ars_linear_model, kpd_linear_model, ows_linear_model,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/ars_linear_blup_models.RData&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/ars_linear_blup_models.RData&quot;</span>)
<span class="kw">library</span>(lme4)

getLmerParams &lt;-<span class="st"> </span>function(x){
  coefs &lt;-<span class="st"> </span><span class="kw">summary</span>(x)$coefficients
  coef.table &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">format</span>(coefs[ ,<span class="dv">1</span>:<span class="dv">3</span>], <span class="dt">digits =</span> <span class="dv">1</span>, <span class="dt">nsmall =</span> <span class="dv">2</span>, 
    <span class="dt">scientific =</span> <span class="ot">FALSE</span>))
  coef.table$pval[coefs[ ,<span class="dv">4</span>] &gt;<span class="st"> </span><span class="fl">0.001</span>] &lt;-<span class="st"> </span><span class="kw">format</span>(coefs[coefs[ ,<span class="dv">4</span>] &gt;<span class="st"> </span><span class="fl">0.001</span>, <span class="dv">4</span>], 
    <span class="dt">digits =</span> <span class="dv">1</span>, <span class="dt">nsmall =</span> <span class="dv">2</span>)
  coef.table$pval[coefs[ ,<span class="dv">4</span>] &lt;<span class="st"> </span><span class="fl">0.001</span>] &lt;-<span class="st"> &quot;&lt; 0.001&quot;</span>
  coef.table$coefs &lt;-<span class="st"> </span><span class="kw">paste</span>(coef.table$Estimate, <span class="st">&quot; ±&quot;</span>, coef.table$Std..Error, 
    <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)
  <span class="kw">return</span>(coef.table)
}

ars_linear_blup_results &lt;-<span class="st"> </span><span class="kw">getLmerParams</span>(ars_linear_model)
<span class="kw">row.names</span>(ars_linear_blup_results) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;Aggression&quot;</span>,
  <span class="st">&quot;Competition&quot;</span>, <span class="st">&quot;Activity&quot;</span>, <span class="st">&quot;Docility&quot;</span>, <span class="st">&quot;Aggression x Competition&quot;</span>,
  <span class="st">&quot;Activity x Competition&quot;</span>, <span class="st">&quot;Docility x Competition&quot;</span>)
<span class="kw">names</span>(ars_linear_blup_results) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Estimate&quot;</span>, <span class="st">&quot;SE&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;P&quot;</span>, <span class="st">&quot;Est ± se&quot;</span>)</code></pre>
<h4 id="interaction-between-competition-and-linear-selection-results-1">Interaction between competition and linear selection results</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pandoc.table</span>(ars_linear_blup_results[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>:<span class="dv">8</span>), <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">3</span>)],
  <span class="dt">justify =</span> <span class="st">&quot;right&quot;</span>, <span class="dt">split.tables =</span> <span class="dv">160</span>)</code></pre>
<table>
<col width="43%" />
<col width="18%" />
<col width="11%" />
<col width="6%" />
<thead>
<tr class="header">
<th align="right"> </th>
<th align="right">Est ± se</th>
<th align="right">P</th>
<th align="right">Z</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><strong>Intercept</strong></td>
<td align="right">-1.10 ± 0.22</td>
<td align="right">&lt; 0.001</td>
<td align="right">-5.09</td>
</tr>
<tr class="even">
<td align="right"><strong>Competition</strong></td>
<td align="right">-3.62 ± 0.64</td>
<td align="right">&lt; 0.001</td>
<td align="right">-5.64</td>
</tr>
<tr class="odd">
<td align="right"><strong>Aggression</strong></td>
<td align="right">0.74 ± 0.21</td>
<td align="right">&lt; 0.001</td>
<td align="right">3.49</td>
</tr>
<tr class="even">
<td align="right"><strong>Activity</strong></td>
<td align="right">-0.32 ± 0.20</td>
<td align="right">0.11</td>
<td align="right">-1.61</td>
</tr>
<tr class="odd">
<td align="right"><strong>Docility</strong></td>
<td align="right">-0.27 ± 0.16</td>
<td align="right">0.10</td>
<td align="right">-1.67</td>
</tr>
<tr class="even">
<td align="right"><strong>Aggression x Competition</strong></td>
<td align="right">2.62 ± 0.64</td>
<td align="right">&lt; 0.001</td>
<td align="right">4.07</td>
</tr>
<tr class="odd">
<td align="right"><strong>Activity x Competition</strong></td>
<td align="right">-1.36 ± 0.61</td>
<td align="right">0.03</td>
<td align="right">-2.21</td>
</tr>
<tr class="even">
<td align="right"><strong>Docility x Competition</strong></td>
<td align="right">-0.77 ± 0.49</td>
<td align="right">0.11</td>
<td align="right">-1.58</td>
</tr>
</tbody>
</table>
<h3 id="competition-and-nonlinear-selection">Competition and nonlinear selection</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/fit_raneff_data.RData&quot;</span>)
<span class="kw">library</span>(lme4)
fit_blups_data &lt;-<span class="st"> </span><span class="kw">filter</span>(fit_raneff_data, type ==<span class="st"> &quot;blup&quot;</span>)
fit_blups_data$oID &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="kw">nrow</span>(fit_blups_data)

ars_nl_model &lt;-<span class="st"> </span><span class="kw">glmer</span>(ars_all ~<span class="st"> </span>aggression_s*competition_s +<span class="st"> </span>
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>
<span class="st">  </span>aggression_s*activity_s*competition_s +<span class="st"> </span><span class="kw">I</span>(aggression_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span>
<span class="st">  </span><span class="kw">I</span>(activity_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span><span class="kw">I</span>(docility_s^<span class="dv">2</span>)*competition_s +
<span class="st">  </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID) +<span class="st"> </span>(<span class="dv">1</span>|oID),
  <span class="dt">data =</span> fit_blups_data, <span class="dt">family =</span> poisson,
  <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))

ars_nl_model &lt;-<span class="st"> </span><span class="kw">glmer</span>(ars_all ~<span class="st"> </span>aggression_s*competition_s +<span class="st"> </span>
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>
<span class="st">  </span>aggression_s*activity_s*competition_s +<span class="st"> </span><span class="kw">I</span>(aggression_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span>
<span class="st">  </span><span class="kw">I</span>(activity_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span><span class="kw">I</span>(docility_s^<span class="dv">2</span>)*competition_s +
<span class="st">  </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID),
  <span class="dt">data =</span> fit_blups_data, <span class="dt">family =</span> poisson,
  <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))
  
kpd_nl_model &lt;-<span class="st"> </span><span class="kw">glmer</span>(kprod ~<span class="st"> </span>aggression_s*competition_s +<span class="st"> </span>
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>
<span class="st">  </span>aggression_s*activity_s*competition_s +<span class="st"> </span><span class="kw">I</span>(aggression_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span>
<span class="st">  </span><span class="kw">I</span>(activity_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span><span class="kw">I</span>(docility_s^<span class="dv">2</span>)*competition_s +
<span class="st">  </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID) +<span class="st"> </span>(<span class="dv">1</span>|oID),
  <span class="dt">data =</span> fit_blups_data, <span class="dt">family =</span> poisson,
  <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))
  
ows_nl_model &lt;-<span class="st"> </span><span class="kw">glmer</span>(prop ~<span class="st"> </span>aggression_s*competition_s +<span class="st"> </span>
<span class="st">  </span>activity_s*competition_s +<span class="st"> </span>docility_s*competition_s +<span class="st"> </span>
<span class="st">  </span>aggression_s*activity_s*competition_s +<span class="st"> </span><span class="kw">I</span>(aggression_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span>
<span class="st">  </span><span class="kw">I</span>(activity_s^<span class="dv">2</span>)*competition_s +<span class="st"> </span><span class="kw">I</span>(docility_s^<span class="dv">2</span>)*competition_s +
<span class="st">  </span>(<span class="dv">1</span> |<span class="st"> </span>grid_year) +<span class="st"> </span>(<span class="dv">1</span>|ID) +<span class="st"> </span>(<span class="dv">1</span>|oID),
  <span class="dt">data =</span> fit_blups_data, <span class="dt">weights =</span> kprod,
  <span class="dt">family =</span> binomial,
  <span class="dt">control=</span><span class="kw">glmerControl</span>(<span class="dt">optimizer=</span><span class="st">&quot;bobyqa&quot;</span>))

<span class="kw">save</span>(ars_nl_model,kpd_nl_model, ows_nl_model,
  <span class="dt">file =</span> <span class="st">&quot;data/analyses_data/nl.blup_models.RData&quot;</span>)

fit_raneff_data %&gt;%
<span class="st">  </span><span class="kw">ungroup</span>() %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">mean_ars =</span> <span class="kw">mean</span>(ars_all, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">var_ars =</span> <span class="kw">var</span>(ars_all, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">mean_kpd =</span> <span class="kw">mean</span>(kprod, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">var_kpd =</span> <span class="kw">var</span>(kprod, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
    )</code></pre>
<pre><code>## Source: local data frame [1 x 4]
## 
##   mean_ars var_ars mean_kpd var_kpd
## 1   0.8784   1.255    3.902   4.372</code></pre>
<h4 id="format-results-of-nonlinear-selection-for-table">Format results of nonlinear selection for table</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;data/analyses_data/nl.blup_models.RData&quot;</span>)

coef_p_ars &lt;-<span class="st"> </span><span class="kw">getLmerParams</span>(ars_nl_model)
coef_p_ows &lt;-<span class="st"> </span><span class="kw">getLmerParams</span>(ows_nl_model)
coef_p_kpd &lt;-<span class="st"> </span><span class="kw">getLmerParams</span>(kpd_nl_model)

term_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;Aggression&quot;</span>,
 <span class="st">&quot;Competition&quot;</span>, <span class="st">&quot;Activity&quot;</span>, <span class="st">&quot;Docility&quot;</span>, <span class="st">&quot;Aggression^2&quot;</span>, <span class="st">&quot;Activity^2&quot;</span>,
 <span class="st">&quot;Docility^2&quot;</span>, <span class="st">&quot;Aggression x Competition&quot;</span>, <span class="st">&quot;Activity x Competition&quot;</span>,
 <span class="st">&quot;Docility x Competition&quot;</span>, <span class="st">&quot;Aggression x Activity&quot;</span>,
 <span class="st">&quot;Aggression^2 x Competition&quot;</span>, <span class="st">&quot;Activity^2 x Competition&quot;</span>,
 <span class="st">&quot;Docility^2 x Competition&quot;</span>, <span class="st">&quot;Agg. x Act. x Competition&quot;</span>
 )

<span class="kw">row.names</span>(coef_p_ars) &lt;-<span class="st"> </span>term_names
<span class="kw">row.names</span>(coef_p_ows) &lt;-<span class="st"> </span>term_names
<span class="kw">row.names</span>(coef_p_kpd) &lt;-<span class="st"> </span>term_names

<span class="kw">names</span>(coef_p_ars) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Estimate&quot;</span>, <span class="st">&quot;SE&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;P&quot;</span>, <span class="st">&quot;Est ± se&quot;</span>)
<span class="kw">names</span>(coef_p_ows) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Estimate&quot;</span>, <span class="st">&quot;SE&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;P&quot;</span>, <span class="st">&quot;Est ± se&quot;</span>)
<span class="kw">names</span>(coef_p_kpd) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Estimate&quot;</span>, <span class="st">&quot;SE&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;P&quot;</span>, <span class="st">&quot;Est ± se&quot;</span>)</code></pre>
<h3 id="nonlinear-results-1">Nonlinear results</h3>
<p>The effect of competition on linear and nonlinear selection on female behavioral traits for annual reproductive success. Posterior modes are given with highest posterior density intervals in parentheses.</p>
<h4 id="ars">ARS</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pandoc.table</span>(coef_p_ars[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>:<span class="dv">16</span>), <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">4</span>)],
 <span class="dt">split.tables =</span> <span class="dv">160</span>)</code></pre>
<table>
<col width="44%" />
<col width="18%" />
<col width="8%" />
<col width="9%" />
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Est ± se</th>
<th align="center">Z</th>
<th align="center">P</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>Intercept</strong></td>
<td align="center">-0.68 ± 0.31</td>
<td align="center">-2.23</td>
<td align="center">0.025</td>
</tr>
<tr class="even">
<td align="center"><strong>Competition</strong></td>
<td align="center">-2.24 ± 0.91</td>
<td align="center">-2.46</td>
<td align="center">0.014</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression</strong></td>
<td align="center">0.96 ± 0.31</td>
<td align="center">3.06</td>
<td align="center">0.002</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity</strong></td>
<td align="center">-0.66 ± 0.28</td>
<td align="center">-2.35</td>
<td align="center">0.019</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility</strong></td>
<td align="center">-0.51 ± 0.23</td>
<td align="center">-2.18</td>
<td align="center">0.029</td>
</tr>
<tr class="even">
<td align="center"><strong>Aggression^2</strong></td>
<td align="center">-0.65 ± 0.32</td>
<td align="center">-2.07</td>
<td align="center">0.039</td>
</tr>
<tr class="odd">
<td align="center"><strong>Activity^2</strong></td>
<td align="center">-0.30 ± 0.26</td>
<td align="center">-1.16</td>
<td align="center">0.247</td>
</tr>
<tr class="even">
<td align="center"><strong>Docility^2</strong></td>
<td align="center">-0.18 ± 0.12</td>
<td align="center">-1.48</td>
<td align="center">0.139</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression x Competition</strong></td>
<td align="center">3.40 ± 0.92</td>
<td align="center">3.68</td>
<td align="center">&lt; 0.001</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity x Competition</strong></td>
<td align="center">-2.45 ± 0.84</td>
<td align="center">-2.90</td>
<td align="center">0.004</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility x Competition</strong></td>
<td align="center">-1.41 ± 0.69</td>
<td align="center">-2.04</td>
<td align="center">0.041</td>
</tr>
<tr class="even">
<td align="center"><strong>Aggression x Activity</strong></td>
<td align="center">1.01 ± 0.43</td>
<td align="center">2.35</td>
<td align="center">0.019</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression^2 x Competition</strong></td>
<td align="center">-1.86 ± 0.96</td>
<td align="center">-1.93</td>
<td align="center">0.053</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity^2 x Competition</strong></td>
<td align="center">-0.81 ± 0.77</td>
<td align="center">-1.05</td>
<td align="center">0.295</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility^2 x Competition</strong></td>
<td align="center">-0.63 ± 0.39</td>
<td align="center">-1.61</td>
<td align="center">0.107</td>
</tr>
<tr class="even">
<td align="center"><strong>Agg. x Act. x Competition</strong></td>
<td align="center">2.62 ± 1.32</td>
<td align="center">1.99</td>
<td align="center">0.046</td>
</tr>
</tbody>
</table>
<h4 id="ows">OWS</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pandoc.table</span>(coef_p_ows[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>:<span class="dv">16</span>), <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">4</span>)],
 <span class="dt">split.tables =</span> <span class="dv">160</span>)</code></pre>
<table>
<col width="44%" />
<col width="18%" />
<col width="8%" />
<col width="9%" />
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Est ± se</th>
<th align="center">Z</th>
<th align="center">P</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>Intercept</strong></td>
<td align="center">-1.92 ± 0.39</td>
<td align="center">-4.87</td>
<td align="center">&lt; 0.001</td>
</tr>
<tr class="even">
<td align="center"><strong>Competition</strong></td>
<td align="center">-2.48 ± 1.18</td>
<td align="center">-2.11</td>
<td align="center">0.035</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression</strong></td>
<td align="center">1.33 ± 0.42</td>
<td align="center">3.17</td>
<td align="center">0.001</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity</strong></td>
<td align="center">-0.82 ± 0.38</td>
<td align="center">-2.14</td>
<td align="center">0.032</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility</strong></td>
<td align="center">-0.49 ± 0.29</td>
<td align="center">-1.70</td>
<td align="center">0.088</td>
</tr>
<tr class="even">
<td align="center"><strong>Aggression^2</strong></td>
<td align="center">-1.02 ± 0.43</td>
<td align="center">-2.36</td>
<td align="center">0.018</td>
</tr>
<tr class="odd">
<td align="center"><strong>Activity^2</strong></td>
<td align="center">-0.37 ± 0.36</td>
<td align="center">-1.03</td>
<td align="center">0.304</td>
</tr>
<tr class="even">
<td align="center"><strong>Docility^2</strong></td>
<td align="center">-0.18 ± 0.15</td>
<td align="center">-1.17</td>
<td align="center">0.242</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression x Competition</strong></td>
<td align="center">4.75 ± 1.28</td>
<td align="center">3.70</td>
<td align="center">&lt; 0.001</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity x Competition</strong></td>
<td align="center">-2.89 ± 1.20</td>
<td align="center">-2.40</td>
<td align="center">0.016</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility x Competition</strong></td>
<td align="center">-0.78 ± 0.90</td>
<td align="center">-0.86</td>
<td align="center">0.388</td>
</tr>
<tr class="even">
<td align="center"><strong>Aggression x Activity</strong></td>
<td align="center">1.40 ± 0.60</td>
<td align="center">2.35</td>
<td align="center">0.019</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression^2 x Competition</strong></td>
<td align="center">-3.11 ± 1.36</td>
<td align="center">-2.29</td>
<td align="center">0.022</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity^2 x Competition</strong></td>
<td align="center">-1.17 ± 1.10</td>
<td align="center">-1.06</td>
<td align="center">0.291</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility^2 x Competition</strong></td>
<td align="center">-0.50 ± 0.50</td>
<td align="center">-0.98</td>
<td align="center">0.325</td>
</tr>
<tr class="even">
<td align="center"><strong>Agg. x Act. x Competition</strong></td>
<td align="center">3.95 ± 1.86</td>
<td align="center">2.13</td>
<td align="center">0.034</td>
</tr>
</tbody>
</table>
<h4 id="fecundity">Fecundity</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pandoc.table</span>(coef_p_kpd[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>:<span class="dv">16</span>), <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">4</span>)],
 <span class="dt">split.tables =</span> <span class="dv">160</span>)</code></pre>
<table>
<col width="44%" />
<col width="20%" />
<col width="9%" />
<col width="9%" />
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Est ± se</th>
<th align="center">Z</th>
<th align="center">P</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>Intercept</strong></td>
<td align="center">1.362 ± 0.091</td>
<td align="center">14.937</td>
<td align="center">&lt; 0.001</td>
</tr>
<tr class="even">
<td align="center"><strong>Competition</strong></td>
<td align="center">-0.017 ± 0.161</td>
<td align="center">-0.106</td>
<td align="center">0.92</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression</strong></td>
<td align="center">-0.058 ± 0.049</td>
<td align="center">-1.176</td>
<td align="center">0.24</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity</strong></td>
<td align="center">0.030 ± 0.050</td>
<td align="center">0.594</td>
<td align="center">0.55</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility</strong></td>
<td align="center">0.030 ± 0.041</td>
<td align="center">0.724</td>
<td align="center">0.47</td>
</tr>
<tr class="even">
<td align="center"><strong>Aggression^2</strong></td>
<td align="center">0.036 ± 0.053</td>
<td align="center">0.672</td>
<td align="center">0.50</td>
</tr>
<tr class="odd">
<td align="center"><strong>Activity^2</strong></td>
<td align="center">-0.064 ± 0.051</td>
<td align="center">-1.248</td>
<td align="center">0.21</td>
</tr>
<tr class="even">
<td align="center"><strong>Docility^2</strong></td>
<td align="center">0.005 ± 0.026</td>
<td align="center">0.209</td>
<td align="center">0.83</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression x Competition</strong></td>
<td align="center">-0.067 ± 0.117</td>
<td align="center">-0.579</td>
<td align="center">0.56</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity x Competition</strong></td>
<td align="center">0.008 ± 0.088</td>
<td align="center">0.086</td>
<td align="center">0.93</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility x Competition</strong></td>
<td align="center">-0.116 ± 0.087</td>
<td align="center">-1.325</td>
<td align="center">0.19</td>
</tr>
<tr class="even">
<td align="center"><strong>Aggression x Activity</strong></td>
<td align="center">0.024 ± 0.075</td>
<td align="center">0.319</td>
<td align="center">0.75</td>
</tr>
<tr class="odd">
<td align="center"><strong>Aggression^2 x Competition</strong></td>
<td align="center">0.153 ± 0.149</td>
<td align="center">1.029</td>
<td align="center">0.30</td>
</tr>
<tr class="even">
<td align="center"><strong>Activity^2 x Competition</strong></td>
<td align="center">0.079 ± 0.145</td>
<td align="center">0.545</td>
<td align="center">0.59</td>
</tr>
<tr class="odd">
<td align="center"><strong>Docility^2 x Competition</strong></td>
<td align="center">-0.067 ± 0.055</td>
<td align="center">-1.218</td>
<td align="center">0.22</td>
</tr>
<tr class="even">
<td align="center"><strong>Agg. x Act. x Competition</strong></td>
<td align="center">-0.252 ± 0.240</td>
<td align="center">-1.051</td>
<td align="center">0.29</td>
</tr>
</tbody>
</table>
<h4 id="plot-of-quadratic-interaction">Plot of quadratic interaction</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(effects)</code></pre>
<pre><code>## Loading required package: colorspace
## 
## Attaching package: &#39;effects&#39;
## 
## The following object is masked from &#39;package:car&#39;:
## 
##     Prestige</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)

g.ows &lt;-<span class="st"> </span><span class="kw">glm</span>(prop ~<span class="st"> </span>aggression_s *<span class="st"> </span>competition_s +<span class="st"> </span>activity_s *<span class="st"> </span>
<span class="st">    </span>competition_s +<span class="st"> </span>docility_s *<span class="st"> </span>competition_s +<span class="st"> </span>aggression_s:activity_s *<span class="st"> </span>
<span class="st">    </span>competition_s +<span class="st"> </span><span class="kw">I</span>(aggression_s^<span class="dv">2</span>) *<span class="st"> </span>competition_s, <span class="dt">data =</span> <span class="kw">filter</span>(fit_raneff_data, 
    type ==<span class="st"> &quot;blup&quot;</span>), <span class="dt">weights =</span> kprod, <span class="dt">family =</span> binomial)</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">e.ows &lt;-<span class="st"> </span><span class="kw">effect</span>(<span class="dt">term =</span> <span class="st">&quot;aggression_s:competition_s:activity_s&quot;</span>, 
    <span class="dt">mod =</span> g.ows)

e &lt;-<span class="st"> </span><span class="kw">Effect</span>(<span class="kw">c</span>(<span class="st">&quot;aggression_s&quot;</span>, <span class="st">&quot;activity_s&quot;</span>, <span class="st">&quot;competition_s&quot;</span>), 
    g.ows, <span class="dt">xlevels =</span> <span class="kw">list</span>(<span class="dt">aggression_s =</span> <span class="dv">100</span>, <span class="dt">activity_s =</span> <span class="dv">2</span>, 
        <span class="dt">competition_s =</span> <span class="dv">2</span>))

s &lt;-<span class="st"> </span><span class="kw">summary</span>(e, <span class="dt">type =</span> <span class="st">&quot;link&quot;</span>)
se &lt;-<span class="st"> </span>s$effect
su &lt;-<span class="st"> </span>s$upper
sl &lt;-<span class="st"> </span>s$lower
d &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(se)
du &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(su)
dl &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(sl)
<span class="kw">names</span>(d) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;la.lc&quot;</span>, <span class="st">&quot;ha.lc&quot;</span>, <span class="st">&quot;la.hc&quot;</span>, <span class="st">&quot;ha.hc&quot;</span>)
<span class="kw">names</span>(du) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;la.lc&quot;</span>, <span class="st">&quot;ha.lc&quot;</span>, <span class="st">&quot;la.hc&quot;</span>, <span class="st">&quot;ha.hc&quot;</span>)
<span class="kw">names</span>(dl) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;la.lc&quot;</span>, <span class="st">&quot;ha.lc&quot;</span>, <span class="st">&quot;la.hc&quot;</span>, <span class="st">&quot;ha.hc&quot;</span>)

plot_d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Aggression =</span> <span class="kw">as.numeric</span>(<span class="kw">rep</span>(<span class="kw">row.names</span>(s$effect), 
    <span class="dv">12</span>)), <span class="dt">OWS =</span> <span class="kw">c</span>(d$la.lc, d$ha.lc, d$la.hc, d$ha.hc, du$la.lc, 
    du$ha.lc, du$la.hc, du$ha.hc, dl$la.lc, dl$ha.lc, dl$la.hc, 
    dl$ha.hc), <span class="dt">Competition =</span> <span class="kw">rep</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;Low</span><span class="ch">\n</span><span class="st">Competition&quot;</span>, <span class="st">&quot;High</span><span class="ch">\n</span><span class="st">Competition&quot;</span>), 
    <span class="dt">each =</span> <span class="dv">200</span>), <span class="dv">3</span>), <span class="dt">Activity =</span> <span class="kw">rep</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;High&quot;</span>), <span class="dt">each =</span> <span class="dv">100</span>), 
    <span class="dv">6</span>), <span class="dt">type =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;main&quot;</span>, <span class="st">&quot;upper&quot;</span>, <span class="st">&quot;lower&quot;</span>), <span class="dt">each =</span> <span class="dv">400</span>))
plot_d$env &lt;-<span class="st"> </span><span class="kw">paste</span>(plot_d$Competition, plot_d$Activity, <span class="dt">sep =</span> <span class="st">&quot;.&quot;</span>)

quad_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(plot_d, <span class="kw">aes</span>(<span class="dt">x =</span> Aggression, <span class="dt">y =</span> OWS)) +<span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">alpha =</span> Activity, 
    <span class="dt">linetype =</span> type, <span class="dt">size =</span> type)) +<span class="st"> </span><span class="kw">facet_wrap</span>(~Competition) +<span class="st"> </span>
<span class="st">    </span><span class="kw">scale_alpha_discrete</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.3</span>)) +<span class="st"> </span><span class="kw">scale_linetype_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">2</span>, 
    <span class="dv">1</span>, <span class="dv">2</span>)) +<span class="st"> </span><span class="kw">scale_size_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="fl">0.3</span>, <span class="dv">1</span>, <span class="fl">0.3</span>)) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Offspring</span><span class="ch">\n</span><span class="st">Overwinter Survival&quot;</span>) +<span class="st"> </span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Aggression&quot;</span>) +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>) +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(), 
    <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(), 
    <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>), 
    <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>), 
    <span class="dt">legend.key =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.background =</span> <span class="kw">element_blank</span>()) +<span class="st"> </span>
<span class="st">    </span><span class="kw">guides</span>(<span class="dt">linetype =</span> <span class="ot">FALSE</span>, <span class="dt">size =</span> <span class="ot">FALSE</span>, <span class="dt">alpha =</span> <span class="kw">guide_legend</span>(<span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">1</span>))) +<span class="st"> </span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.75</span>, <span class="fl">0.25</span>), <span class="dt">legend.background =</span> <span class="kw">element_blank</span>(), 
        <span class="dt">legend.key.size =</span> <span class="kw">unit</span>(<span class="fl">0.4</span>, <span class="st">&quot;cm&quot;</span>)) +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, 
    <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>)) +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>(), 
    <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>())

<span class="kw">pdf</span>(<span class="st">&quot;figure/05_quad_print.pdf&quot;</span>, <span class="dt">width =</span> <span class="fl">3.14</span>, <span class="dt">height =</span> <span class="dv">2</span>)
quad_plot
<span class="kw">dev.off</span>()</code></pre>
<pre><code>## pdf 
##   2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">quad_plot</code></pre>
<div class="figure">
<img src="figure/05_quad.png" />
</div>
<h4 id="tile-plot-of-interaction">Tile plot of interaction</h4>
<pre class="sourceCode r"><code class="sourceCode r">n =<span class="st"> </span><span class="dv">12</span>
e &lt;-<span class="st"> </span><span class="kw">Effect</span>(<span class="kw">c</span>(<span class="st">&quot;aggression_s&quot;</span>, <span class="st">&quot;activity_s&quot;</span>, <span class="st">&quot;competition_s&quot;</span>), 
    g.ows, <span class="dt">xlevels =</span> <span class="kw">list</span>(<span class="dt">aggression_s =</span> n, <span class="dt">activity_s =</span> n, <span class="dt">competition_s =</span> <span class="dv">2</span>))
s &lt;-<span class="st"> </span><span class="kw">summary</span>(e, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)
de &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(s$effect)
de_lc &lt;-<span class="st"> </span>de[, <span class="dv">1</span>:n]
de_hc &lt;-<span class="st"> </span>de[, (n +<span class="st"> </span><span class="dv">1</span>):(<span class="dv">2</span> *<span class="st"> </span>n)]

fix.names &lt;-<span class="st"> </span>function(x) {
    a &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(<span class="kw">strsplit</span>(<span class="kw">names</span>(x), <span class="dt">split =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>), <span class="st">&quot;[[&quot;</span>, 
        <span class="dv">1</span>))
    b &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(<span class="kw">strsplit</span>(<span class="kw">names</span>(x), <span class="dt">split =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>), <span class="st">&quot;[[&quot;</span>, 
        <span class="dv">2</span>))
    out &lt;-<span class="st"> </span><span class="kw">paste</span>(a, b, <span class="dt">sep =</span> <span class="st">&quot;.&quot;</span>)
    <span class="kw">return</span>(out)
}

d_hc &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Aggression =</span> <span class="kw">rep</span>(<span class="kw">row.names</span>(de_hc), n), <span class="dt">Activity =</span> <span class="kw">rep</span>(<span class="kw">fix.names</span>(de_hc), 
    <span class="dt">each =</span> n), <span class="dt">OWS =</span> <span class="kw">as.vector</span>(<span class="kw">as.matrix</span>(de_hc)))
d_hc$Aggression &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(d_hc$Aggression))
d_hc$Activity &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(d_hc$Activity))

d_lc &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Aggression =</span> <span class="kw">rep</span>(<span class="kw">row.names</span>(de_lc), n), <span class="dt">Activity =</span> <span class="kw">rep</span>(<span class="kw">fix.names</span>(de_lc), 
    <span class="dt">each =</span> n), <span class="dt">OWS =</span> <span class="kw">as.vector</span>(<span class="kw">as.matrix</span>(de_lc)))
d_lc$Aggression &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(d_lc$Aggression))
d_lc$Activity &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(d_lc$Activity))

tile_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(d_lc, <span class="kw">aes</span>(<span class="dt">x =</span> Aggression, <span class="dt">y =</span> Activity, <span class="dt">z =</span> OWS)) +<span class="st"> </span>
<span class="st">    </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">alpha =</span> OWS), <span class="dt">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="dv">0</span>) +<span class="st"> </span><span class="kw">scale_alpha_continuous</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">1</span>, 
    <span class="dv">0</span>)) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Activity&quot;</span>) +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Aggression&quot;</span>) +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>) +<span class="st"> </span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), 
        <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">linetype =</span> <span class="st">&quot;solid&quot;</span>, 
            <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>), <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), 
        <span class="dt">legend.key =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.background =</span> <span class="kw">element_blank</span>()) +<span class="st"> </span>
<span class="st">    </span><span class="kw">guides</span>(<span class="dt">linetype =</span> <span class="ot">FALSE</span>, <span class="dt">size =</span> <span class="ot">FALSE</span>, <span class="dt">alpha =</span> <span class="ot">FALSE</span>) +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, 
    <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;cm&quot;</span>))

<span class="kw">pdf</span>(<span class="st">&quot;figure/05_tile_print.pdf&quot;</span>, <span class="dt">width =</span> <span class="fl">3.14</span>, <span class="dt">height =</span> <span class="fl">3.14</span>)
tile_plot
<span class="kw">dev.off</span>()</code></pre>
<pre><code>## pdf 
##   2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tile_plot</code></pre>
<div class="figure">
<img src="figure/05_tile.png" />
</div>
</body>
</html>